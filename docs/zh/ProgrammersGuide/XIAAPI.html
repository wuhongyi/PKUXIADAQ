

<!DOCTYPE html>
<html class="writer-html5" lang="zh-CN" >
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>XIA API &mdash; GDDAQ beta 文档</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/graphviz.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/translations.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜索" href="../search.html" />
    <link rel="next" title="PKU Code" href="PKUCode.html" />
    <link rel="prev" title="开发者指南" href="README.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> GDDAQ
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="在文档中搜索" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">简介</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../README.html">简介</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">程序安装</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../INSTALL.html">程序安装</a></li>
<li class="toctree-l1"><a class="reference internal" href="../MYSQL.html">MYSQL</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">用户指南</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../UsersGuide/README.html">用户指南</a></li>
<li class="toctree-l1"><a class="reference internal" href="../UsersGuide/Crate.html">机箱</a></li>
<li class="toctree-l1"><a class="reference internal" href="../UsersGuide/FIRMWARE.html">固件</a></li>
<li class="toctree-l1"><a class="reference internal" href="../UsersGuide/Decode.html">数据解码</a></li>
<li class="toctree-l1"><a class="reference internal" href="../UsersGuide/GUI.html">图形交互界面</a></li>
<li class="toctree-l1"><a class="reference internal" href="../UsersGuide/NOGUI.html">非图形交互界面</a></li>
<li class="toctree-l1"><a class="reference internal" href="../UsersGuide/OnlineStattics.html">在线统计</a></li>
<li class="toctree-l1"><a class="reference internal" href="../UsersGuide/MakeEvent.html">MakeEvent</a></li>
<li class="toctree-l1"><a class="reference internal" href="../UsersGuide/FrontPanel.html">插件前面板</a></li>
<li class="toctree-l1"><a class="reference internal" href="../UsersGuide/Logic.html">逻辑功能</a></li>
<li class="toctree-l1"><a class="reference internal" href="../UsersGuide/MultipleModulesSynchronously.html">时间同步</a></li>
<li class="toctree-l1"><a class="reference internal" href="../UsersGuide/UpdateCPLD.html">升级CPLD</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">应用案例</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Example/README.html">应用案例</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Example/TOF2TAC.html">100M 模块测量飞行时间</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Example/TimeResolution.html">时间分辨</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Example/RecommendedParameters.html">推荐参数</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Example/InBeamGammaCIAE.html">在束伽马谱学</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">采购建议与实验调试</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../ProcurementProposal.html">采购推荐</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ExperimentalDebugging.html">实验调试</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">编程指南</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="README.html">开发者指南</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">XIA API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#id1">XIA API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#pixie16acquireadctrace">Pixie16AcquireADCTrace</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pixie16acquirebaselines">Pixie16AcquireBaselines</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pixie16adjustoffsets">Pixie16AdjustOffsets</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pixie16blcutfinder">Pixie16BLcutFinder</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pixie16bootmodule">Pixie16BootModule</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pixie16checkexternalfifostatus">Pixie16CheckExternalFIFOStatus</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pixie16checkrunstatus">Pixie16CheckRunStatus</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pixie16computefastfiltersoffline">Pixie16ComputeFastFiltersOffline</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pixie16computeinputcountrate">Pixie16ComputeInputCountRate</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pixie16computelivetime">Pixie16ComputeLiveTime</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pixie16computeoutputcountrate">Pixie16ComputeOutputCountRate</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pixie16computeprocessedevents">Pixie16ComputeProcessedEvents</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pixie16computerealtime">Pixie16ComputeRealTime</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pixie16computeslowfiltersoffline">Pixie16ComputeSlowFiltersOffline</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pixie16controltaskrun">Pixie16ControlTaskRun</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pixie16copydspparameters">Pixie16CopyDSPParameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pixie16embufferio">Pixie16EMbufferIO</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pixie16endrun">Pixie16EndRun</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pixie16exitsystem">Pixie16ExitSystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pixie16geteventsinfo">Pixie16GetEventsInfo</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pixie16getmoduleevents">Pixie16GetModuleEvents</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pixie16imbufferio">Pixie16IMbufferIO</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pixie16initsystem">Pixie16InitSystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pixie16loaddspparametersfromfile">Pixie16LoadDSPParametersFromFile</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pixie16programfippi">Pixie16ProgramFippi</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pixie16readcsr">Pixie16ReadCSR</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pixie16readdatafromexternalfifo">Pixie16ReadDataFromExternalFIFO</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pixie16readhistogramfromfile">Pixie16ReadHistogramFromFile</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pixie16readhistogramfrommodule">Pixie16ReadHistogramFromModule</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pixie16readlistmodetrace">Pixie16ReadListModeTrace</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pixie16readmoduleinfo">Pixie16ReadModuleInfo</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pixie16readsglchanadctrace">Pixie16ReadSglChanADCTrace</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pixie16readsglchanbaselines">Pixie16ReadSglChanBaselines</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pixie16readsglchanpar">Pixie16ReadSglChanPar</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pixie16readsglmodpar">Pixie16ReadSglModPar</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pixie16readstatisticsfrommodule">Pixie16ReadStatisticsFromModule</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pixie16registerio">Pixie16RegisterIO</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pixie16savedspparameterstofile">Pixie16SaveDSPParametersToFile</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pixie16saveexternalfifodatatofile">Pixie16SaveExternalFIFODataToFile</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pixie16savehistogramtofile">Pixie16SaveHistogramToFile</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pixie16setdacs">Pixie16SetDACs</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pixie16starthistogramrun">Pixie16StartHistogramRun</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pixie16startlistmoderun">Pixie16StartListModeRun</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pixie16taufinder">Pixie16TauFinder</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pixie16writecsr">Pixie16WriteCSR</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pixie16writesglchanpar">Pixie16WriteSglChanPar</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pixie16writesglmodpar">Pixie16WriteSglModPar</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#pku-api">PKU API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#hongyiwupixie16computefastfiltersoffline">HongyiWuPixie16ComputeFastFiltersOffline</a></li>
<li class="toctree-l3"><a class="reference internal" href="#hongyiwupixie16computeslowfiltersoffline">HongyiWuPixie16ComputeSlowFiltersOffline</a></li>
<li class="toctree-l3"><a class="reference internal" href="#hongyiwupixie16computeslowfiltersofflineaveragebaseline">HongyiWuPixie16ComputeSlowFiltersOfflineAverageBaseline</a></li>
<li class="toctree-l3"><a class="reference internal" href="#hongyiwupixie16computeslowfiltersofflineextendbaseline">HongyiWuPixie16ComputeSlowFiltersOfflineExtendBaseline</a></li>
<li class="toctree-l3"><a class="reference internal" href="#hongyiwupixie16setofflinevariant">HongyiWuPixie16SetOfflineVariant</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="PKUCode.html">PKU Code</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">GDDAQ</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>XIA API</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/ProgrammersGuide/XIAAPI.rst.txt" rel="nofollow"> 查看页面源码</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <section id="xia-api">
<h1>XIA API<a class="headerlink" href="#xia-api" title="永久链接至标题">¶</a></h1>
<p>以下说明来源于 <strong>Pixie-16 Programmer’s Manual</strong> <em>Version 3.06, September 13, 2019</em></p>
<section id="id1">
<h2>XIA API<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h2>
<section id="pixie16acquireadctrace">
<h3>Pixie16AcquireADCTrace<a class="headerlink" href="#pixie16acquireadctrace" title="永久链接至标题">¶</a></h3>
<p>在单个或多个模块中获取 ADC 波形</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// 使用此功能可从 Pixie-16 模块获取 ADC 波形。 使用从 0 开始计数的 ModNum 指定模块。如果 ModNum 设置为小于系统中模块的总数，则仅 ModNum 指定的模块将获取其 ADC 波形。 但是，如果 ModNum 等于系统中模块的总数，则系统中的所有模块都将获取其 ADC 波形。</span>
<span class="c1">// 成功返回此功能后，DSP 的内部存储器将充满 ADC 跟踪数据。 然后，用户的应用程序软件应调用 Pixie16ReadSglChanADCTrace 函数，以逐通道的方式将 ADC 跟踪数据读出到主机。</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">Pixie16AcquireADCTrace</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="w"> </span><span class="p">);</span><span class="c1">// module number</span>
</pre></div>
</div>
<p><strong>返回值描述及错误处理方法</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>0 成功</dt><dd><ul>
<li><p>没有</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-1 无效的 Pixie-16 模块编号</dt><dd><ul>
<li><p>使用正确的 ModNum</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-2 无法开始运行</dt><dd><ul>
<li><p>重新启动模块</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-3 获取 ADC 跟踪超时</dt><dd><ul>
<li><p>重新启动模块</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p><strong>示例代码</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">;</span><span class="w"></span>
<span class="kt">int</span><span class="w"> </span><span class="n">retval</span><span class="p">;</span><span class="w"></span>

<span class="c1">// assume we want to acquire ADC trace from module 0</span>
<span class="n">ModNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>

<span class="c1">// acquire the trace</span>
<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16AcquireADCTrace</span><span class="w"> </span><span class="p">(</span><span class="n">ModNum</span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// error handling</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="pixie16acquirebaselines">
<h3>Pixie16AcquireBaselines<a class="headerlink" href="#pixie16acquirebaselines" title="永久链接至标题">¶</a></h3>
<p>从模块获取基线</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// 使用此功能可从 Pixie-16 模块获取基线。 使用从 0 开始计数的 ModNum 指定模块。如果 ModNum 设置为小于系统中模块的总数，则仅 ModNum 指定的模块将获取其基线。但是，如果将 ModNum 设置为等于系统中模块的总数，那么系统中的所有模块都将获取其基线。</span>
<span class="c1">// 成功返回此功能后，DSP 的内部存储器将充满基线数据。然后，用户应调用函数 Pixie16ReadSglChanBaselines，以逐个通道的方式将基线数据读出到主机。</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">Pixie16AcquireBaselines</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="w"> </span><span class="p">);</span><span class="c1">// module number</span>
</pre></div>
</div>
<p><strong>返回值描述及错误处理方法</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>0 成功</dt><dd><ul>
<li><p>没有</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-1 无效的 Pixie-16 模块编号</dt><dd><ul>
<li><p>使用正确的 ModNum</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-2 无法启动 GET_BASELINES 运行</dt><dd><ul>
<li><p>重新启动模块</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-3 GET_BASELINES 运行超时</dt><dd><ul>
<li><p>重新启动模块</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p><strong>示例代码</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">;</span><span class="w"></span>
<span class="kt">int</span><span class="w"> </span><span class="n">retval</span><span class="p">;</span><span class="w"></span>

<span class="c1">// assume we want to acquire baselines for module 0</span>
<span class="n">ModNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>

<span class="c1">// acquire the trace</span>
<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16AcquireBaselines</span><span class="w"> </span><span class="p">(</span><span class="n">ModNum</span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// error handling</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="pixie16adjustoffsets">
<h3>Pixie16AdjustOffsets<a class="headerlink" href="#pixie16adjustoffsets" title="永久链接至标题">¶</a></h3>
<p>调整单个或多个模块中的直流偏置</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// 使用此功能可以调整 Pixie-16 模块的 DC 偏置。 使用从 0 开始计数的 ModNum 指定模块。如果 ModNum 设置为小于系统中模块的总数，则仅 ModNum 指定的模块将调整其 DC 偏移量。 但是，如果 ModNum 设置为等于系统中模块的总数，则系统中的所有模块都将调整其 DC 偏移量。</span>
<span class="c1">// 调整直流偏置电平后，数字化输入信号的基准电平将由 DSP 参数 BaselinePercent 确定。 例如，如果 BaselinePercent设置为 10（％），则输入信号的基线电平将在 12 位 ADC 比例上为 ~409（最小值：0；最大值：4095）。</span>
<span class="c1">// 此功能的主要目的是确保输入信号落在 ADC 的电压范围内，以便所有输入信号都能被 ADC 正确数字化。</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">Pixie16AdjustOffsets</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="w"> </span><span class="p">);</span><span class="w"> </span><span class="c1">// module number</span>
</pre></div>
</div>
<p><strong>返回值描述及错误处理方法</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>0 成功</dt><dd><ul>
<li><p>没有</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-1 无效的 Pixie-16 模块编号</dt><dd><ul>
<li><p>检查 ModNum 是否有效</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-2 无法启动 ADJUST_OFFSETS 运行</dt><dd><ul>
<li><p>重新启动模块</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-3 ADJUST_OFFSETS 运行超时</dt><dd><ul>
<li><p>检查错误消息日志文件 Pixie16msg.txt</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p><strong>示例代码</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">retval</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">;</span><span class="w"></span>

<span class="c1">// set to the first module</span>
<span class="n">ModNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>

<span class="c1">// adjust dc-offsets</span>
<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16AdjustOffsets</span><span class="p">(</span><span class="n">ModNum</span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// error handling</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="pixie16blcutfinder">
<h3>Pixie16BLcutFinder<a class="headerlink" href="#pixie16blcutfinder" title="永久链接至标题">¶</a></h3>
<p>计算模块的新基线切割值</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// 使用此功能可以找到 Pixie-16 模块一个通道的“基线切割”值。 然后将基线切割值下载到 DSP，在其中捕获基线并随时间平均。 削减值将防止在平均过程中使用错误的基线值，即，如果基线值超出基线削减范围，则不会将其用于计算基线平均值。 随时间推移平均基线可以改善能量分辨率的测量。</span>
<span class="c1">// ModNum 是从 0 开始计数的模块号。ChanNum 是从 0 开始计数的通道号。</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">Pixie16BLcutFinder</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">,</span><span class="w"> </span><span class="c1">// module number</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ChanNum</span><span class="p">,</span><span class="c1">// channel number</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">BLcut</span><span class="w"> </span><span class="p">);</span><span class="w"> </span><span class="c1">// returned BLcut value</span>
</pre></div>
</div>
<p><strong>返回值描述及错误处理方法</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>0 成功</dt><dd><ul>
<li><p>没有</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-1 无效的 Pixie-16 模块编号</dt><dd><ul>
<li><p>检查 ModNum 是否有效</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-2 收集基线失败</dt><dd><ul>
<li><p>重新启动模块</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-3 无法从数据存储器读取基线</dt><dd><ul>
<li><p>检查错误消息日志文件 Pixie16msg.txt</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p><strong>示例代码</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">retval</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">,</span><span class="w"> </span><span class="n">ChanNum</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">BLcut</span><span class="p">;</span><span class="w"></span>

<span class="c1">// set to the first module</span>
<span class="n">ModNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>

<span class="c1">// set to the first channel</span>
<span class="n">ChanNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>

<span class="c1">// find the BLcut value</span>
<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16BLcutFinder</span><span class="p">(</span><span class="n">ModNum</span><span class="p">,</span><span class="w"> </span><span class="n">ChanNum</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">BLcut</span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// error handling</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="pixie16bootmodule">
<h3>Pixie16BootModule<a class="headerlink" href="#pixie16bootmodule" title="永久链接至标题">¶</a></h3>
<p>引导模块，以便可以设置它们以进行数据接收。</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// 使用此功能引导 Pixie-16 模块，以便可以设置它们以进行数据采集。 该功能将通信 FPGA 配置，信号处理（或系统）FPGA 配置，触发 FPGA 配置（仅适用于版本A模块），数字信号处理器（DSP）的可执行代码和 DSP 参数下载到 Pixie-16 模块。</span>
<span class="c1">// FPGA 配置由固定长度的字符组成，具体取决于模块上安装的硬件。 DSP 代码的长度取决于实际编译的代码； 每个模块的 DSP 参数集始终由 1280 个 32 位字组成。 主机软件必须使硬盘上那些引导数据文件的名称可用于引导功能。</span>
<span class="c1">// ModNum 是从 0 开始计数的模块号。如果 ModNum 设置为小于系统中模块的总数，则仅引导由 ModNum 指定的模块。 但是如果 ModNum 等于系统中模块的总数，例如 机箱中有 5 个模块，ModNum = 5，则系统中的所有模块都将被引导。</span>
<span class="c1">// 引导模式是一个位掩码（如下所示），指示将引导哪个板载芯片。 通常情况下，所有板载芯片都应被引导，即引导模式为 0x7F。 对于版本 B，C，D，F 模块，即使该位设置为 1，也将忽略其位 1，即 “启动触发 FPGA”。</span>
<span class="c1">// bit 0: 引导通信 FPGA，所有 Pixie-16 版本</span>
<span class="c1">// bit 1: 引导触发 FPGA，仅 Pixie-16 版本A</span>
<span class="c1">// bit 2: 引导信号处理 FPGA，所有 Pixie-16 版本</span>
<span class="c1">// bit 3: 引导数字信号处理器（DSP），所有 Pixie-16 版本</span>
<span class="c1">// bit 4: 下载DSP I/O 参数，所有 Pixie-16 版本</span>
<span class="c1">// bit 5: 编程板载 FPGA，所有 Pixie-16 版本</span>
<span class="c1">// bit 6: 设置板载 DAC，所有 Pixie-16 版本</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">Pixie16BootModule</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">ComFPGAConfigFile</span><span class="p">,</span><span class="w">     </span><span class="c1">// name of ComFPGA configuration file</span>
<span class="w">      </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">SPFPGAConfigFile</span><span class="p">,</span><span class="w">      </span><span class="c1">// name of SPFPGA configuration file</span>
<span class="w">      </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">TrigFPGAConfigFile</span><span class="p">,</span><span class="w">    </span><span class="c1">// name of trigger FPGA file</span>
<span class="w">      </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">DSPCodeFile</span><span class="p">,</span><span class="w">           </span><span class="c1">// name of DSP code file</span>
<span class="w">      </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">DSPParFile</span><span class="p">,</span><span class="w">            </span><span class="c1">// name of DSP parameter file</span>
<span class="w">      </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">DSPVarFile</span><span class="p">,</span><span class="w">            </span><span class="c1">// name of DSP variable names file</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">,</span><span class="w">       </span><span class="c1">// pixie-16 module number</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">BootPattern</span><span class="p">);</span><span class="w"> </span><span class="c1">// boot pattern bit mask</span>
</pre></div>
</div>
<p><strong>返回值描述及错误处理方法</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>0 成功</dt><dd><ul>
<li><p>没有</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-1 无效的 Pixie-16 模块编号</dt><dd><ul>
<li><p>使用正确的 ModNum</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-2 ComFPGAConfigFile 的大小无效</dt><dd><ul>
<li><p>使用正确的 ComFPGAConfigFile</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-3 无法启动 Communication FPGA</dt><dd><ul>
<li><p>检查日志文件（Pixie16msg.txt）</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-4 无法分配内存以将数据存储在 ComFPGAConfigFile中</dt><dd><ul>
<li><p>关闭其他程序或重新启动计算机</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-5 无法打开 ComFPGAConfigFile</dt><dd><ul>
<li><p>使用正确的 ComFPGAConfigFile</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-10 SPFPGAConfigFile 的大小无效</dt><dd><ul>
<li><p>使用正确的 SPFPGAConfigFile</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-11 无法启动信号处理 FPGA</dt><dd><ul>
<li><p>检查日志文件（Pixie16msg.txt）</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-12 无法分配内存以将数据存储在 SPFPGAConfigFile中</dt><dd><ul>
<li><p>关闭其他程序或重新启动计算机</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-13 无法打开 SPFPGAConfigFile</dt><dd><ul>
<li><p>使用正确的 SPFPGAConfigFile</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-14 无法启动 DSP</dt><dd><ul>
<li><p>检查日志文件（Pixie16msg.txt）</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-15 无法分配内存来存储 DSP 可执行代码</dt><dd><ul>
<li><p>关闭其他程序或重新启动计算机</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-16 无法打开 DSPCodeFile</dt><dd><ul>
<li><p>使用正确的 DSPCodeFile</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-17 DSPParFile 的大小无效</dt><dd><ul>
<li><p>使用正确的 DSPParFile</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-18 无法打开 DSPParFile</dt><dd><ul>
<li><p>使用正确的 DSPParFile</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-19 无法初始化 DSP 变量索引</dt><dd><ul>
<li><p>使用正确的 DSPVarFile</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-20 无法复制 DSP 变量索引</dt><dd><ul>
<li><p>检查日志文件（Pixie16msg.txt）</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-21 无法在模块中编程 Fippi</dt><dd><ul>
<li><p>检查日志文件（Pixie16msg.txt）</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-22 无法在模块中设置 DAC</dt><dd><ul>
<li><p>检查日志文件（Pixie16msg.txt）</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-23 无法启动 RESET_ADC 在模块中运行</dt><dd><ul>
<li><p>检查日志文件（Pixie16msg.txt）</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-24 RESET_ADC 运行在模块中超时</dt><dd><ul>
<li><p>检查日志文件（Pixie16msg.txt）</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p><strong>示例代码</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">retval</span><span class="p">;</span><span class="w"></span>
<span class="kt">char</span><span class="w"> </span><span class="n">ComFPGAConfigFile</span><span class="p">[</span><span class="mi">256</span><span class="p">],</span><span class="w"> </span><span class="n">SPFPGAConfigFile</span><span class="p">[</span><span class="mi">256</span><span class="p">];</span><span class="w"></span>
<span class="kt">char</span><span class="w"> </span><span class="n">TrigFPGAConfigFile</span><span class="p">[</span><span class="mi">256</span><span class="p">],</span><span class="w"> </span><span class="n">DSPCodeFile</span><span class="p">[</span><span class="mi">256</span><span class="p">],</span><span class="w"> </span><span class="n">DSPParFile</span><span class="p">[</span><span class="mi">256</span><span class="p">];</span><span class="w"></span>
<span class="kt">char</span><span class="w"> </span><span class="n">DSPVarFile</span><span class="p">[</span><span class="mi">256</span><span class="p">];</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">,</span><span class="w"> </span><span class="n">BootPattern</span><span class="p">;</span><span class="w"></span>

<span class="c1">// first, specify file names and paths for all boot data files</span>
<span class="n">sprintf</span><span class="p">(</span><span class="n">ComFPGAConfigFile</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;C:</span><span class="se">\\</span><span class="s">XIA</span><span class="se">\\</span><span class="s">Pixie16</span><span class="se">\\</span><span class="s">Firmware</span><span class="se">\\</span><span class="s">syspixie16.bin&quot;</span><span class="p">);</span><span class="w"></span>
<span class="n">sprintf</span><span class="p">(</span><span class="n">TrigFPGAConfigFile</span><span class="p">,</span><span class="w"> </span><span class="s">&quot; &quot;</span><span class="p">);</span><span class="w"></span>
<span class="n">sprintf</span><span class="p">(</span><span class="n">SPFPGAConfigFile</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;C:</span><span class="se">\\</span><span class="s">XIA</span><span class="se">\\</span><span class="s">Pixie16</span><span class="se">\\</span><span class="s">Firmware</span><span class="se">\\</span><span class="s">fippixie16.bin&quot;</span><span class="p">);</span><span class="w"></span>
<span class="n">sprintf</span><span class="p">(</span><span class="n">DSPCodeFile</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;C:</span><span class="se">\\</span><span class="s">XIA</span><span class="se">\\</span><span class="s">Pixie16</span><span class="se">\\</span><span class="s">DSP</span><span class="se">\\</span><span class="s">Pixie16DSP.ldr&quot;</span><span class="p">);</span><span class="w"></span>
<span class="n">sprintf</span><span class="p">(</span><span class="n">DSPParFile</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;C:</span><span class="se">\\</span><span class="s">XIA</span><span class="se">\\</span><span class="s">Pixie16</span><span class="se">\\</span><span class="s">Configuration</span><span class="se">\\</span><span class="s">default.set&quot;</span><span class="p">);</span><span class="w"></span>
<span class="n">sprintf</span><span class="p">(</span><span class="n">DSPVarFile</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;C:</span><span class="se">\\</span><span class="s">XIA</span><span class="se">\\</span><span class="s">Pixie16</span><span class="se">\\</span><span class="s">DSP</span><span class="se">\\</span><span class="s">Pixie16DSP.var&quot;</span><span class="p">);</span><span class="w"></span>

<span class="c1">// second, select the Pixie-16 module to boot. All modules in the system</span>
<span class="c1">// can be booted either one-by-one or all at once. The simplest way to</span>
<span class="c1">// boot all modules at once is to set ModNum to be equal to the total</span>
<span class="c1">// number of modules in the system. Here we assume there are total 5</span>
<span class="c1">// Pixie-16 modules.</span>
<span class="n">ModNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span><span class="w"></span>

<span class="c1">// third, specify the boot pattern. Normally, it should be 0x7F, i.e.</span>
<span class="c1">// all bits of the bit mask are selected.</span>
<span class="n">BootPattern</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x7F</span><span class="p">;</span><span class="w"></span>

<span class="c1">// finally, boot the selected modules</span>
<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16BootModule</span><span class="w"> </span><span class="p">(</span><span class="n">ComFPGAConfigFile</span><span class="p">,</span><span class="w"> </span><span class="n">SPFPGAConfigFile</span><span class="p">,</span><span class="w"></span>
<span class="n">TrigFPGAConfigFile</span><span class="p">,</span><span class="w"> </span><span class="n">DSPCodeFile</span><span class="p">,</span><span class="w"> </span><span class="n">DSPParFile</span><span class="p">,</span><span class="w"> </span><span class="n">DSPVarFile</span><span class="p">,</span><span class="w"> </span><span class="n">ModNum</span><span class="p">,</span><span class="w"></span>
<span class="n">BootPattern</span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// error handling</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="pixie16checkexternalfifostatus">
<h3>Pixie16CheckExternalFIFOStatus<a class="headerlink" href="#pixie16checkexternalfifostatus" title="永久链接至标题">¶</a></h3>
<p>Check status of external FIFO of a module</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// 在进行列表模式数据采集运行时，使用此功能检查 Pixie-16 模块的外部 FIFO 的状态。 该函数返回外部 FIFO 当前具有的字数（32位）。 如果字数大于用户设置的阈值，则可以使用函数 Pixie16ReadDataFromExternalFIFO 从外部 FIFO 读取数据。</span>
<span class="c1">// 用户可以设置阈值，以最大程度地减少读取开销或尽快从 FIFO 中读取数据。 Pixie-16 API（pixie16app_defs.h）为外部FIFO 读取（EXTFIFO_READ_THRESH）定义了一个值为 1024 的阈值。</span>
<span class="c1">// *nFIFOWords 返回外部 FIFO 当前具有的 32 位数据的数量。</span>
<span class="c1">// ModNum是从 0 开始计数的模块号。</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">Pixie16CheckExternalFIFOStatus</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">nFIFOWords</span><span class="p">,</span><span class="w">  </span><span class="c1">// returned number of words in the FIFO</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="w"> </span><span class="p">);</span><span class="w">   </span><span class="c1">// module number</span>
</pre></div>
</div>
<p><strong>返回值描述及错误处理方法</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>0 成功</dt><dd><ul>
<li><p>没有</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-1 无效的 Pixie-16 模块编号</dt><dd><ul>
<li><p>使用正确的 ModNum</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p><strong>示例代码</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">retval</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">nFIFOWords</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">;</span><span class="w"></span>

<span class="n">ModNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="c1">// the first module</span>
<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16CheckExternalFIFOStatus</span><span class="w"> </span><span class="p">(</span><span class="o">&amp;</span><span class="n">nFIFOWords</span><span class="p">,</span><span class="w"> </span><span class="n">ModNum</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="pixie16checkrunstatus">
<h3>Pixie16CheckRunStatus<a class="headerlink" href="#pixie16checkrunstatus" title="永久链接至标题">¶</a></h3>
<p>检查数据采集运行的状态。</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// 在进行列表模式数据采集运行时，使用此功能检查 Pixie-16 模块的运行状态。 如果运行仍在进行，请继续轮询。</span>
<span class="c1">// 如果此函数的返回码指示运行已完成，则外部 FIFO（版本 B，C，D，F 模块）中仍可能需要将某些数据读出到主机。 此外，最终运行统计数据和直方图数据也可用于读取。</span>
<span class="c1">// 在MCA直方图运行模式下，也可以调用此函数以检查运行是否仍在进行中，即使它通常是自终止的。</span>
<span class="c1">// ModNum 是从 0 开始计数的模块号。</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">Pixie16CheckRunStatus</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="w"> </span><span class="p">);</span><span class="w"> </span><span class="c1">// module number</span>
</pre></div>
</div>
<p><strong>返回值描述及错误处理方法</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>0 没有运行中</dt><dd><ul>
<li><p>没有</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>1 运行仍在进行中</dt><dd><ul>
<li><p>没有</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-1 无效的 Pixie-16 模块编号</dt><dd><ul>
<li><p>使用正确的 ModNum</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p><strong>示例代码</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">retval</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">;</span><span class="w"></span>

<span class="n">ModNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="c1">// the first module</span>
<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16CheckRunStatus</span><span class="p">(</span><span class="n">ModNum</span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// invalid module number</span>
<span class="p">}</span><span class="w"></span>
<span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// run is still in progress</span>
<span class="p">}</span><span class="w"></span>
<span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// run has finished</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="pixie16computefastfiltersoffline">
<h3>Pixie16ComputeFastFiltersOffline<a class="headerlink" href="#pixie16computefastfiltersoffline" title="永久链接至标题">¶</a></h3>
<p>计算快速滤波响应以进行离线分析</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// 使用此功能可以计算列表模式数据文件中每个事件的快速触发响应，以进行离线分析。 在此离线分析功能中实现的算法与在 Pixie-16 硬件中实现的算法等效。 因此，该功能可用于分析在硬件中实现的前沿快速触发滤波和 CFD 滤波如何响应记录的波形形状。 通过分析这些滤波的响应，可以通过离线调整快速滤波和 CFD 参数来优化前沿触发或 CFD 触发的性能。然后可以将此类优化的参数保存到设置文件中，以用于在线数据采集。</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">Pixie16ComputeFastFiltersOffline</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">FileName</span><span class="p">,</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="n">mode</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="p">(</span><span class="n">with</span><span class="w"> </span><span class="n">complete</span><span class="w"> </span><span class="n">path</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModuleNumber</span><span class="p">,</span><span class="w"> </span><span class="c1">// the module to be analyzed</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ChannelNumber</span><span class="p">,</span><span class="w"> </span><span class="c1">// the channel to be analyzed</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">FileLocation</span><span class="p">,</span><span class="w"> </span><span class="c1">// the location of the trace in the file</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">RcdTraceLength</span><span class="p">,</span><span class="c1">// recorded trace length</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="o">*</span><span class="n">RcdTrace</span><span class="p">,</span><span class="w"> </span><span class="c1">// recorded trace</span>
<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">fastfilter</span><span class="p">,</span><span class="w"> </span><span class="c1">// fast filter response</span>
<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">cfd</span><span class="w"> </span><span class="p">);</span><span class="w"> </span><span class="c1">// cfd response</span>
</pre></div>
</div>
<p><strong>返回值描述及错误处理方法</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>0 成功</dt><dd><ul>
<li><p>没有</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-1 空指针 RcdTrace</dt><dd><ul>
<li><p>确保已为 RcdTrace 分配了足够的内存（最大长度为 32768，但可以更短以匹配实际的波形长度）</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-2 空指针  fastfilter</dt><dd><ul>
<li><p>确保为 fastfilter 分配了足够的内存（最大长度为 32768，但可以更短以匹配实际的波形长度）</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-3 空指针  cfd</dt><dd><ul>
<li><p>确保已为 cfd 分配了足够的内存（最大长度为 32768，但可以更短以匹配实际的波形长度）</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-4 目标模块编号无效</dt><dd><ul>
<li><p>使用正确的 ModuleNumber</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-5 波形长度太短</dt><dd><ul>
<li><p>对于使用快速滤波长度（快速滤波上升时间和平坦顶部）的离线分析，记录的波形的长度太短。 或者必须使用具有较短快速滤波长度的其他设置文件，或者必须获取具有较长波形长度的新波形</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-6 无法打开列表模式数据文件</dt><dd><ul>
<li><p>检查列表模式文件名及其路径是否正确</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p><strong>示例代码</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">retval</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModuleNumber</span><span class="p">,</span><span class="w"> </span><span class="n">ChannelNumber</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">FileLocation</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">RcdTraceLength</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">RcdTrace</span><span class="p">[</span><span class="mi">1000</span><span class="p">];</span><span class="w"></span>
<span class="kt">double</span><span class="w"> </span><span class="n">fastfilter</span><span class="p">[</span><span class="mi">1000</span><span class="p">];</span><span class="w"></span>
<span class="kt">double</span><span class="w"> </span><span class="n">cfd</span><span class="p">[</span><span class="mi">1000</span><span class="p">];</span><span class="w"></span>

<span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">FileName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;C:</span><span class="se">\\</span><span class="s">XIA</span><span class="se">\\</span><span class="s">Pixie16</span><span class="se">\\</span><span class="s">PulseShape</span><span class="se">\\</span><span class="s">listmodedata.bin&quot;</span><span class="p">};</span><span class="w"></span>
<span class="n">ModuleNumber</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">      </span><span class="c1">//the first module</span>
<span class="n">ChannelNumber</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">     </span><span class="c1">//the first channel</span>
<span class="n">FileLocation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">16</span><span class="p">;</span><span class="w">     </span><span class="c1">//the starting address of the trace in the list mode data file (32-bit word address)</span>
<span class="n">RcdTraceLength</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1000</span><span class="p">;</span><span class="w"> </span><span class="c1">//the length of the recorded trace</span>

<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16ComputeFastFiltersOffline</span><span class="w"> </span><span class="p">(</span><span class="n">FileName</span><span class="p">,</span><span class="w"> </span><span class="n">ModuleNumber</span><span class="p">,</span><span class="w"></span>
<span class="n">ChannelNumber</span><span class="p">,</span><span class="w"> </span><span class="n">FileLocation</span><span class="p">,</span><span class="w"> </span><span class="n">RcdTrace</span><span class="p">,</span><span class="w"> </span><span class="n">fastfilter</span><span class="p">,</span><span class="w"> </span><span class="n">cfd</span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// error handling</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="pixie16computeinputcountrate">
<h3>Pixie16ComputeInputCountRate<a class="headerlink" href="#pixie16computeinputcountrate" title="永久链接至标题">¶</a></h3>
<p>计算通道的输入计数率</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// 使用此功能可在 Pixie-16 模块的一个通道上计算输入计数率。 此功能无法与 Pixie-16 模块通信。 在调用此函数之前，应调用另一个函数 Pixie16ReadStatisticsFromModule 从模块读取统计数据。</span>
<span class="c1">// *Statistics 是指向数组的指针，该数组的大小正好是 448个 无符号整数字（32位）。 调用函数 Pixie16ReadStatisticsFromModule 后，*Statistics 数组将填充来自 Pixie-16 模块的数据。 ModNum 是从 0 开始计数的模块号。ChanNum 是从 0 开始计数的通道号。</span>
<span class="kt">double</span><span class="w"> </span><span class="nf">Pixie16ComputeInputCountRate</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">Statistics</span><span class="p">,</span><span class="c1">// run statistics data</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">,</span><span class="w">   </span><span class="c1">// module number</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ChanNum</span><span class="w"> </span><span class="p">);</span><span class="c1">// channel number</span>
</pre></div>
</div>
<p><strong>返回值描述及错误处理方法</strong></p>
<p>返回值是输入计数率，以每秒计数为单位。</p>
<p><strong>示例代码</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">double</span><span class="w"> </span><span class="n">icr</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">Statistics</span><span class="p">[</span><span class="mi">448</span><span class="p">];</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">,</span><span class="w"> </span><span class="n">ChanNum</span><span class="p">;</span><span class="w"></span>
<span class="kt">int</span><span class="w"> </span><span class="n">retval</span><span class="p">;</span><span class="w"></span>

<span class="n">ModNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">  </span><span class="c1">// the first module</span>
<span class="n">ChanNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="c1">// the first channel</span>

<span class="c1">// first call Pixie16ReadStatisticsFromModule to get the statistics data</span>
<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16ReadStatisticsFromModule</span><span class="w"> </span><span class="p">(</span><span class="n">Statistics</span><span class="p">,</span><span class="w"> </span><span class="n">ModNum</span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// error handling</span>
<span class="p">}</span><span class="w"></span>

<span class="c1">// compute input count rate</span>
<span class="n">icr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16ComputeInputCountRate</span><span class="w"> </span><span class="p">(</span><span class="n">Statistics</span><span class="p">,</span><span class="w"> </span><span class="n">ModNum</span><span class="p">,</span><span class="w"> </span><span class="n">ChanNum</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="pixie16computelivetime">
<h3>Pixie16ComputeLiveTime<a class="headerlink" href="#pixie16computelivetime" title="永久链接至标题">¶</a></h3>
<p>计算通道在运行中累积的实时时间</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// 使用此功能可以计算 Pixie-16 模块的一个通道在数据采集上花费的实时时间。此功能无法与 Pixie-16 模块通信。 在调用此函数之前，应调用另一个函数 Pixie16ReadStatisticsFromModule 从模块读取统计数据。</span>
<span class="c1">// *Statistics 是指向数组的指针，该数组的大小正好是 448 个无符号整数字（32位）。 调用函数 Pixie16ReadStatisticsFromModule 后，*Statistics 数组将填充来自 Pixie-16 模块的数据。 ModNum 是从 0 开始计数的模块号。ChanNum 是从 0 开始计数的通道号。</span>
<span class="kt">double</span><span class="w"> </span><span class="nf">Pixie16ComputeLiveTime</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">Statistics</span><span class="p">,</span><span class="w"> </span><span class="c1">// run statistics data</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">,</span><span class="w">    </span><span class="c1">// module number</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ChanNum</span><span class="w"> </span><span class="p">);</span><span class="w"> </span><span class="c1">// channel number</span>
</pre></div>
</div>
<p><strong>返回值描述及错误处理方法</strong></p>
<p>返回值为以秒为单位的实时时间。</p>
<p><strong>示例代码</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">double</span><span class="w"> </span><span class="n">livetime</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">Statistics</span><span class="p">[</span><span class="mi">448</span><span class="p">];</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">,</span><span class="w"> </span><span class="n">ChanNum</span><span class="p">;</span><span class="w"></span>
<span class="kt">int</span><span class="w"> </span><span class="n">retval</span><span class="p">;</span><span class="w"></span>

<span class="n">ModNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="c1">// the first module</span>
<span class="n">ChanNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="c1">// the first channel</span>

<span class="c1">// first call Pixie16ReadStatisticsFromModule to get the statistics data</span>
<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16ReadStatisticsFromModule</span><span class="w"> </span><span class="p">(</span><span class="n">Statistics</span><span class="p">,</span><span class="w"> </span><span class="n">ModNum</span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// error handling</span>
<span class="p">}</span><span class="w"></span>

<span class="c1">// compute live time</span>
<span class="n">livetime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16ComputeLiveTime</span><span class="w"> </span><span class="p">(</span><span class="n">Statistics</span><span class="p">,</span><span class="w"> </span><span class="n">ModNum</span><span class="p">,</span><span class="w"> </span><span class="n">ChanNum</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="pixie16computeoutputcountrate">
<h3>Pixie16ComputeOutputCountRate<a class="headerlink" href="#pixie16computeoutputcountrate" title="永久链接至标题">¶</a></h3>
<p>计算通道的输出计数率</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// 使用此功能可以计算 Pixie-16 模块一个通道上的输出计数率。 此功能无法与 Pixie-16 模块通信。 在调用此函数之前，应调用另一个函数 Pixie16ReadStatisticsFromModule 从模块读取统计数据。</span>
<span class="c1">// *Statistics 是指向数组的指针，该数组的大小正好是 448 个无符号整数字（32位）。 调用函数 Pixie16ReadStatisticsFromModule 后，*Statistics 数组将填充来自 Pixie-16 模块的数据。 ModNum 是从 0 开始计数的模块号。ChanNum 是从 0 开始计数的通道号。</span>
<span class="kt">double</span><span class="w"> </span><span class="nf">Pixie16ComputeOutputCountRate</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">Statistics</span><span class="p">,</span><span class="w"> </span><span class="c1">// run statistics data</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">,</span><span class="w">    </span><span class="c1">// module number</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ChanNum</span><span class="w"> </span><span class="p">);</span><span class="w"> </span><span class="c1">// channel number</span>
</pre></div>
</div>
<p><strong>返回值描述及错误处理方法</strong></p>
<p>返回值是输出计数率，以每秒计数为单位。</p>
<p><strong>示例代码</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">double</span><span class="w"> </span><span class="n">ocr</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">Statistics</span><span class="p">[</span><span class="mi">448</span><span class="p">];</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">,</span><span class="w"> </span><span class="n">ChanNum</span><span class="p">;</span><span class="w"></span>
<span class="kt">int</span><span class="w"> </span><span class="n">retval</span><span class="p">;</span><span class="w"></span>

<span class="n">ModNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">  </span><span class="c1">// the first module</span>
<span class="n">ChanNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="c1">// the first channel</span>

<span class="c1">// first call Pixie16ReadStatisticsFromModule to get the statistics data</span>
<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16ReadStatisticsFromModule</span><span class="p">(</span><span class="n">Statistics</span><span class="p">,</span><span class="w"> </span><span class="n">ModNum</span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// error handling</span>
<span class="p">}</span><span class="w"></span>

<span class="c1">// compute output count rate</span>
<span class="n">ocr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16ComputeOutputCountRate</span><span class="p">(</span><span class="n">Statistics</span><span class="p">,</span><span class="w"> </span><span class="n">ModNum</span><span class="p">,</span><span class="w"> </span><span class="n">ChanNum</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="pixie16computeprocessedevents">
<h3>Pixie16ComputeProcessedEvents<a class="headerlink" href="#pixie16computeprocessedevents" title="永久链接至标题">¶</a></h3>
<p>计算模块处理的事件数</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// 使用此功能可以计算数据采集运行期间 Pixie-16 模块已处理的事件数。 此功能仅由 版本A 模块使用。 此功能无法与 Pixie-16 模块通信。 在调用此函数之前，应先调用另一个函数 Pixie16ReadStatisticsFromModule，以首先从模块读取统计数据。</span>
<span class="c1">// *Statistics 是指向数组的指针，该数组的大小正好是 448 个无符号整数字（32位）。 调用函数 Pixie16ReadStatisticsFromModule 后，*Statistics 数组将填充来自 Pixie-16 模块的数据。 ModNum 是从 0 开始计数的模块号。ChanNum 是从 0 开始计数的通道号。</span>
<span class="kt">double</span><span class="w"> </span><span class="nf">Pixie16ComputeProcessedEvents</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="o">*</span><span class="n">Statistics</span><span class="p">,</span><span class="c1">// run statistics data</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="w"> </span><span class="p">);</span><span class="w">  </span><span class="c1">// module number</span>
</pre></div>
</div>
<p><strong>返回值描述及错误处理方法</strong></p>
<p>返回值是已处理事件的数量。</p>
<p><strong>示例代码</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">double</span><span class="w"> </span><span class="n">NumEvents</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">Statistics</span><span class="p">[</span><span class="mi">448</span><span class="p">];</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">;</span><span class="w"></span>
<span class="kt">int</span><span class="w"> </span><span class="n">retval</span><span class="p">;</span><span class="w"></span>

<span class="n">ModNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="c1">// the first module</span>

<span class="c1">// first call Pixie16ReadStatisticsFromModule to get the statistics data</span>
<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16ReadStatisticsFromModule</span><span class="p">(</span><span class="n">Statistics</span><span class="p">,</span><span class="w"> </span><span class="n">ModNum</span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// error handling</span>
<span class="p">}</span><span class="w"></span>

<span class="c1">// compute number of processed events</span>
<span class="n">NumEvents</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16ComputeProcessedEvents</span><span class="p">(</span><span class="n">Statistics</span><span class="p">,</span><span class="w"> </span><span class="n">ModNum</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="pixie16computerealtime">
<h3>Pixie16ComputeRealTime<a class="headerlink" href="#pixie16computerealtime" title="永久链接至标题">¶</a></h3>
<p>计算模块在运行中累积的实时时间</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// 使用此功能可以计算 Pixie-16 模块在数据采集上花费的实时时间。 此功能无法与 Pixie-16 模块通信。 在调用此函数之前，应调用另一个函数 Pixie16ReadStatisticsFromModule 从模块读取统计数据。</span>
<span class="c1">// *Statistics 是指向数组的指针，该数组的大小正好是 448 个无符号整数字（32位）。 调用函数 Pixie16ReadStatisticsFromModule 后，*Statistics 数组将填充来自 Pixie-16 模块的数据。 ModNum 是从 0 开始计数的模块号。ChanNum 是从 0 开始计数的通道号。</span>
<span class="kt">double</span><span class="w"> </span><span class="nf">Pixie16ComputeRealTime</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">Statistics</span><span class="p">,</span><span class="c1">// run statistics data</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="w"> </span><span class="p">);</span><span class="w"> </span><span class="c1">// module number</span>
</pre></div>
</div>
<p><strong>返回值描述及错误处理方法</strong></p>
<p>返回值为以秒为单位的实时时间。</p>
<p><strong>示例代码</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">double</span><span class="w"> </span><span class="n">realtime</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">Statistics</span><span class="p">[</span><span class="mi">448</span><span class="p">];</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">;</span><span class="w"></span>
<span class="kt">int</span><span class="w"> </span><span class="n">retval</span><span class="p">;</span><span class="w"></span>
<span class="n">ModNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="c1">// the first module</span>

<span class="c1">// first call Pixie16ReadStatisticsFromModule to get the statistics data</span>
<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16ReadStatisticsFromModule</span><span class="p">(</span><span class="n">Statistics</span><span class="p">,</span><span class="w"> </span><span class="n">ModNum</span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// error handling</span>
<span class="p">}</span><span class="w"></span>

<span class="c1">// compute real time</span>
<span class="n">realtime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16ComputeRealTime</span><span class="p">(</span><span class="n">Statistics</span><span class="p">,</span><span class="w"> </span><span class="n">ModNum</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="pixie16computeslowfiltersoffline">
<h3>Pixie16ComputeSlowFiltersOffline<a class="headerlink" href="#pixie16computeslowfiltersoffline" title="永久链接至标题">¶</a></h3>
<p>计算慢速滤波响应以进行离线分析</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// 使用此功能可以计算列表模式数据文件中每个事件的慢速滤波响应，以进行离线分析。 在此离线分析功能中实现的算法与在 Pixie-16 硬件中实现的算法等效。 因此，该功能可用于分析在硬件中实现的用于计算事件能量的慢速滤波如何响应记录的波形形状。 通过分析这些滤波的响应，可以通过离线调整慢速滤波的参数来优化其性能。然后可以将此类优化的参数保存到设置文件中，以用于在线数据采集。</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">Pixie16ComputeSlowFiltersOffline</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">FileName</span><span class="p">,</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="n">mode</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="p">(</span><span class="n">with</span><span class="w"> </span><span class="n">complete</span><span class="w"> </span><span class="n">path</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModuleNumber</span><span class="p">,</span><span class="w"> </span><span class="c1">// the module to be analyzed</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ChannelNumber</span><span class="p">,</span><span class="w"> </span><span class="c1">// the channel to be analyzed</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">FileLocation</span><span class="p">,</span><span class="w"> </span><span class="c1">// the location of the trace in the file</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">RcdTraceLength</span><span class="p">,</span><span class="c1">// recorded trace length</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="o">*</span><span class="n">RcdTrace</span><span class="p">,</span><span class="c1">// recorded trace</span>
<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">slowfilter</span><span class="p">);</span><span class="c1">// slow filter response</span>
</pre></div>
</div>
<p><strong>返回值描述及错误处理方法</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>0 成功</dt><dd><ul>
<li><p>没有</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-1 空指针 RcdTrace</dt><dd><ul>
<li><p>确保已为 RcdTrace 分配了足够的内存（最大长度为 32768，但可以更短以匹配实际的波形长度）</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-2 空指针 slowfilter</dt><dd><ul>
<li><p>确保为 slowfilter 分配了足够的内存（最大长度为 32768，但可以更短以匹配实际的波形长度）</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-3 目标模块编号无效</dt><dd><ul>
<li><p>使用正确的 ModuleNumber</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-4 波形长度太短</dt><dd><ul>
<li><p>对于使用slow filter长度（较慢的滤波上升时间和平坦的顶部）的离线分析，记录的波形长度太短。要么必须使用具有较短的滤波长度的其他设置文件，要么必须获取具有较长波形长度的新波形</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-5 无法打开列表模式数据文件</dt><dd><ul>
<li><p>检查列表模式文件名及其路径是否正确</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p><strong>示例代码</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">retval</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModuleNumber</span><span class="p">,</span><span class="w"> </span><span class="n">ChannelNumber</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">FileLocation</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">RcdTraceLength</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">RcdTrace</span><span class="p">[</span><span class="mi">1000</span><span class="p">];</span><span class="w"></span>
<span class="kt">double</span><span class="w"> </span><span class="n">slowfilter</span><span class="p">[</span><span class="mi">1000</span><span class="p">];</span><span class="w"></span>

<span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">FileName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;C:</span><span class="se">\\</span><span class="s">XIA</span><span class="se">\\</span><span class="s">Pixie16</span><span class="se">\\</span><span class="s">PulseShape</span><span class="se">\\</span><span class="s">listmodedata.bin&quot;</span><span class="p">};</span><span class="w"></span>

<span class="n">ModuleNumber</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">     </span><span class="c1">// the first module</span>
<span class="n">ChannelNumber</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">    </span><span class="c1">// the first channel</span>
<span class="n">FileLocation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">16</span><span class="p">;</span><span class="w">    </span><span class="c1">// the starting address of the trace in the list mode data file (32-bit word address)</span>
<span class="n">RcdTraceLength</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1000</span><span class="p">;</span><span class="c1">// the length of the recorded trace</span>

<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16ComputeSlowFiltersOffline</span><span class="w"> </span><span class="p">(</span><span class="n">FileName</span><span class="p">,</span><span class="w"> </span><span class="n">ModuleNumber</span><span class="p">,</span><span class="w"></span>
<span class="n">ChannelNumber</span><span class="p">,</span><span class="w"> </span><span class="n">FileLocation</span><span class="p">,</span><span class="w"> </span><span class="n">RcdTrace</span><span class="p">,</span><span class="w"> </span><span class="n">slowfilter</span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// error handling</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="pixie16controltaskrun">
<h3>Pixie16ControlTaskRun<a class="headerlink" href="#pixie16controltaskrun" title="永久链接至标题">¶</a></h3>
<p>执行特殊控制任务</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// 使用此功能可以执行特殊的控制任务。 这可能包括在下载 DSP 参数后对 Fippi 进行编程或设置 DAC。</span>
<span class="c1">// ModNum 是从 0 开始计数的模块号。ChanNum 是从 0 开始计数的通道号。</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">Pixie16ControlTaskRun</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">,</span><span class="w">     </span><span class="c1">// module number</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ControlTask</span><span class="p">,</span><span class="c1">// control task run type</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">Max_Poll</span><span class="w"> </span><span class="p">);</span><span class="w">   </span><span class="c1">// Timeout control in unit of ms</span>
</pre></div>
</div>
<p><strong>返回值描述及错误处理方法</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>0 成功</dt><dd><ul>
<li><p>没有</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-1 无效的 Pixie-16 模块编号</dt><dd><ul>
<li><p>使用正确的 ModNum</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-2 控制任务运行失败</dt><dd><ul>
<li><p>重新启动模块</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p><strong>示例代码</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">retval</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ControlTask</span><span class="p">,</span><span class="w"> </span><span class="n">ModNum</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">Max_Poll</span><span class="p">;</span><span class="w"></span>

<span class="n">ModNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">            </span><span class="c1">// this is the first module</span>
<span class="n">ControlTask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SET_DACS</span><span class="p">;</span><span class="c1">// constant SET_DACS defined in header file</span>
<span class="n">Max_Poll</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10000</span><span class="p">;</span><span class="w">      </span><span class="c1">// give the run 10 seconds to finish</span>

<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16ControlTaskRun</span><span class="w"> </span><span class="p">(</span><span class="n">ControlTask</span><span class="p">,</span><span class="w"> </span><span class="n">ModNum</span><span class="p">,</span><span class="w"> </span><span class="n">Max_Poll</span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// Error handling</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="pixie16copydspparameters">
<h3>Pixie16CopyDSPParameters<a class="headerlink" href="#pixie16copydspparameters" title="永久链接至标题">¶</a></h3>
<p>将DSP参数复制到其他模块</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// 使用此功能可将 DSP 参数从一个模块复制到系统中其它模块并使之生效。</span>
<span class="c1">// BitMask 是位模式，它指定应将哪些项目从源模块复制到目标模块。</span>
<span class="c1">// Bit 0: Filter (energy and trigger)</span>
<span class="c1">// Bit 1: Analog signal conditioning (polarity, dc-offset, gain/attenuation)</span>
<span class="c1">// Bit 2: Histogram control (minimum energy, binning factor)</span>
<span class="c1">// Bit 3: Decay time</span>
<span class="c1">// Bit 4: Pulse shape analysis (trace length and trace delay)</span>
<span class="c1">// Bit 5: Baseline control (baseline cut, baseline percentage)</span>
<span class="c1">// Bit 7: Channel CSRA register (good channel, trigger enabled, etc.)</span>
<span class="c1">// Bit 8: CFD trigger (CFD delay, scaling factor)</span>
<span class="c1">// Bit 9: Trigger stretch lengths (veto, external trigger, etc.)</span>
<span class="c1">// Bit 10: FIFO delays (analog input delay, fast trigger output delay, etc.)</span>
<span class="c1">// Bit 11: Multiplicity (bit masks, thresholds, etc.)</span>
<span class="c1">// Bit 12: QDC (QDC sum lengths)</span>
<span class="c1">// SourceModule 和 SourceChannel 是要复制到其它模块和通道的 DSP 参数的模块和通道号。</span>
<span class="c1">// DestinationMask 是一个数组，指示要从源通道和模块复制其设置的通道和模块。 例如，如果系统中有 5 个模块（总共 80 个通道），则 DestinationMask 将被定义为 DestinationMask[80]，其中 DestinationMask[0] 至 DestinationMask[15] 将选择模块 0 的通道 0 至 15，DestinationMask[16] 到 DestinationMask[31] 将选择模块 1 的通道 0 到 15，依此类推。 如果要复制给定的通道 i，则 DestinationMask[i] 应设置为 1，否则应将其设置为 0。</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">Pixie16CopyDSPParameters</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">BitMask</span><span class="p">,</span><span class="w">           </span><span class="c1">// copy items bit mask</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">SourceModule</span><span class="p">,</span><span class="w">      </span><span class="c1">// source module</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">SourceChannel</span><span class="p">,</span><span class="w">     </span><span class="c1">// source channel</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="o">*</span><span class="n">DestinationMask</span><span class="w"> </span><span class="p">);</span><span class="c1">// destination bit mask</span>
</pre></div>
</div>
<p><strong>返回值描述及错误处理方法</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>0 成功</dt><dd><ul>
<li><p>没有</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-1 无法在模块中编程 Fippi</dt><dd><ul>
<li><p>重新启动模块</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-2 无法在模块中设置 DAC</dt><dd><ul>
<li><p>重新启动模块</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p><strong>示例代码</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">retval</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">BitMask</span><span class="p">;</span><span class="w">             </span><span class="c1">//copy items bit mask</span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">SourceModule</span><span class="p">;</span><span class="w">        </span><span class="c1">//source module</span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">SourceChannel</span><span class="p">;</span><span class="w">       </span><span class="c1">//source channel</span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">DestinationMask</span><span class="p">[</span><span class="mi">384</span><span class="p">];</span><span class="c1">//destination bit mask</span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">k</span><span class="p">;</span><span class="w"></span>

<span class="n">BitMask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x1FF</span><span class="p">;</span><span class="w">  </span><span class="c1">// copy everything</span>
<span class="n">SourceModule</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="c1">// the first module</span>
<span class="n">SourceChannel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="c1">// the first channel</span>

<span class="c1">// assume there are 6 Pixie-16 modules in the system</span>
<span class="k">for</span><span class="p">(</span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="p">(</span><span class="mi">6</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">16</span><span class="p">);</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">++</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="n">DestinationMask</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="c1">// copy to all channels of all modules</span>
<span class="p">}</span><span class="w"></span>

<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16CopyDSPParameters</span><span class="w"> </span><span class="p">(</span><span class="n">BitMask</span><span class="p">,</span><span class="w"> </span><span class="n">SourceModule</span><span class="p">,</span><span class="w"> </span><span class="n">SourceChannel</span><span class="p">,</span><span class="w"></span>
<span class="n">DestinationMask</span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// error handling</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="pixie16embufferio">
<h3>Pixie16EMbufferIO<a class="headerlink" href="#pixie16embufferio" title="永久链接至标题">¶</a></h3>
<p>在主机和 DSP 外部存储器之间传输数据</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// 使用此功能可直接从 Pixie-16 模块的板载外部存储器读取数据或将数据写入其中。有效的存储器地址是从 0x0 到 0x7FFFF（32位宽）。 将 Direction = 1 用于读取，将 Direction = 0 用于写入。</span>
<span class="c1">// 外部存储器用于存储 Pixie-16 模块 16 个通道中每个通道累积的直方图数据。每个通道的固定直方图长度为 32768 字（32位宽），直方图数据在存储器中的位置与通道号的顺序相同，即通道 0 占用内存地址 0x0 至 0x7FFF，通道 1 占用 0x8000 到 0xFFFF，依此类推。</span>
<span class="c1">// 注意：另一个函数 Pixie16ReadHistogramFromModule 也可以用于读出直方图，只是需要逐个通道调用它。</span>
<span class="c1">// ModNum 是从 0 开始计数的模块号。</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">Pixie16EMbufferIO</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">Buffer</span><span class="p">,</span><span class="c1">// buffer data</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">NumWords</span><span class="p">,</span><span class="w"> </span><span class="c1">// number of buffer words to read or write</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">Address</span><span class="p">,</span><span class="c1">// buffer address</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">Direction</span><span class="p">,</span><span class="w"> </span><span class="c1">// I/O direction</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="w"> </span><span class="p">);</span><span class="w"> </span><span class="c1">//module number</span>
</pre></div>
</div>
<p><strong>返回值描述及错误处理方法</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>0 成功</dt><dd><ul>
<li><p>没有</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-1 空指针 buffer</dt><dd><ul>
<li><p>使用正确的指针 Buffer</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-2 buffer 字数超过限制</dt><dd><ul>
<li><p>减少 buffer 字数</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-3 无效的 DSP 外部存储器地址</dt><dd><ul>
<li><p>使用有效地址</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-4 无效的 I/O 方向</dt><dd><ul>
<li><p>使用有效方向</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-5 无效的 Pixie-16 模块编号</dt><dd><ul>
<li><p>使用正确的 ModNum</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-6 I/O 失败</dt><dd><ul>
<li><p>重新启动模块</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p><strong>示例代码</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">retval</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">Direction</span><span class="p">,</span><span class="w"> </span><span class="n">ModNum</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">MCAData</span><span class="p">[</span><span class="mi">32768</span><span class="p">],</span><span class="w"> </span><span class="n">NumWords</span><span class="p">,</span><span class="w"> </span><span class="n">Address</span><span class="p">;</span><span class="w"></span>
<span class="n">NumWords</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">32768</span><span class="p">;</span><span class="c1">//to read out the MCA data from channel 0</span>
<span class="n">ModNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">    </span><span class="c1">//the first module in the system</span>
<span class="n">Address</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x0</span><span class="p">;</span><span class="w">         </span><span class="c1">//the starting memory address</span>
<span class="n">Direction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w">         </span><span class="c1">//I/O direction is read</span>

<span class="c1">// read out the MCA data for Channel 0</span>
<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16EMbufferIO</span><span class="w"> </span><span class="p">(</span><span class="n">MCAData</span><span class="p">,</span><span class="w"> </span><span class="n">NumWords</span><span class="p">,</span><span class="w"> </span><span class="n">Address</span><span class="p">,</span><span class="w"> </span><span class="n">Direction</span><span class="p">,</span><span class="w"> </span><span class="n">ModNum</span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// Error handling</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="pixie16endrun">
<h3>Pixie16EndRun<a class="headerlink" href="#pixie16endrun" title="永久链接至标题">¶</a></h3>
<p>停止数据采集运行</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// 使用此功能可结束直方图运行，或强制结束列表模式运行。在多模块系统中，如果所有模块都同步运行，则只需要以这种方式寻址一个模块。它将立即停止系统中所有其他模块的运行。ModNum 是从 0 开始计数的模块号。</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">Pixie16EndRun</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="w"> </span><span class="p">);</span><span class="c1">// module number</span>
</pre></div>
</div>
<p><strong>返回值描述及错误处理方法</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>0 成功</dt><dd><ul>
<li><p>没有</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-1 无效的 Pixie-16 模块编号</dt><dd><ul>
<li><p>使用正确的 ModNum</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-2 停止运行失败</dt><dd><ul>
<li><p>重新启动模块</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p><strong>示例代码</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">retval</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">;</span><span class="w"></span>
<span class="n">ModNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="c1">// the first module</span>
<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16EndRun</span><span class="w"> </span><span class="p">(</span><span class="n">ModNum</span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// error handling</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="pixie16exitsystem">
<h3>Pixie16ExitSystem<a class="headerlink" href="#pixie16exitsystem" title="永久链接至标题">¶</a></h3>
<p>释放分配给模块的用户虚拟地址</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// 当通过功能 Pixie16InitSystem 初始化这些模块时，使用此功能可释放分配给 Pixie-16 模块的用户虚拟地址。 应该在用户的应用程序退出之前调用此函数。</span>
<span class="c1">// 如果将 ModNum 设置为小于系统中模块的总数，则将仅关闭 ModNum 指定的模块。 但是如果 ModNum 等于系统中模块的总数，例如 机箱中有 5 个模块，ModNum = 5，则系统中的所有模块将完全关闭。 请注意，模块从 0 开始计数。</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">Pixie16ExitSystem</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="w"> </span><span class="p">);</span><span class="w"> </span><span class="c1">// Pixie-16 module number</span>
</pre></div>
</div>
<p><strong>返回值描述及错误处理方法</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>0 成功</dt><dd><ul>
<li><p>没有</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-1 无效的 Pixie-16 模块编号</dt><dd><ul>
<li><p>使用正确的 ModNum（不应大于系统中模块的总数）</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-2 无法关闭 Pixie-16 模块</dt><dd><ul>
<li><p>检查错误消息日志文件 Pixie16msg.txt</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p><strong>示例代码</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">retval</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="p">;</span><span class="w"></span>

<span class="c1">// assume there are totally 5 modules in the system</span>
<span class="c1">// so close all 5 modules</span>
<span class="n">ModNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span><span class="w"></span>
<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16ExitSystem</span><span class="w"> </span><span class="p">(</span><span class="n">ModNum</span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// error handling</span>
<span class="p">}</span><span class="w"></span>

<span class="c1">// or module by module</span>
<span class="k">for</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">k</span><span class="o">&lt;</span><span class="mi">5</span><span class="p">;</span><span class="w"> </span><span class="n">k</span><span class="o">++</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16ExitSystem</span><span class="w"> </span><span class="p">(</span><span class="n">k</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="c1">// error handling</span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="pixie16geteventsinfo">
<h3>Pixie16GetEventsInfo<a class="headerlink" href="#pixie16geteventsinfo" title="永久链接至标题">¶</a></h3>
<p>从数据文件获取详细的事件信息</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// 使用此功能可在指定模块的列表模式数据文件中检索每个事件的详细信息（波形除外）。 ModNum 是从 0 开始计数的模块号。ChanNum 是从 0 开始计数的通道号。</span>
<span class="c1">// 在调用此函数以获取单个事件信息之前，应首先调用另一个函数 Pixie16GetModuleEvents 以确定每个模块已记录的事件数。 如果给定模块的事件数为 nEvents，则应为内存块 *EventInformation 分配长度（nEvents * 68）：</span>
<span class="c1">// EventInformation = (unsigned int *)malloc(sizeof(unsigned int) * nEvents * 68);</span>
<span class="c1">// 其中 68 是每个事件（能量，时间戳等）的信息记录的长度，并具有以下结构。</span>
<span class="c1">// EventInformation [0] Event number</span>
<span class="c1">// EventInformation [1] Channel number</span>
<span class="c1">// EventInformation [2] Slot number</span>
<span class="c1">// EventInformation [3] Crate number</span>
<span class="c1">// EventInformation [4] Header length</span>
<span class="c1">// EventInformation [5] Event length</span>
<span class="c1">// EventInformation [6] Finish code</span>
<span class="c1">// EventInformation [7] Event timestamp (lower 32-bit)</span>
<span class="c1">// EventInformation [8] Event timestamp (upper 16-bit)</span>
<span class="c1">// EventInformation [9] Event energy</span>
<span class="c1">// EventInformation [10] Trace length</span>
<span class="c1">// EventInformation [11] Trace location</span>
<span class="c1">// EventInformation [67:12] Not used</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">Pixie16GetEventsInfo</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">FileName</span><span class="p">,</span><span class="o">//</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="n">mode</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="p">(</span><span class="n">with</span><span class="w"> </span><span class="n">complete</span><span class="w"> </span><span class="n">path</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">EventsInformation</span><span class="p">,</span><span class="c1">// to hold event information</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModuleNumber</span><span class="w"> </span><span class="p">);</span><span class="c1">// module to get events from</span>
</pre></div>
</div>
<p><strong>返回值描述及错误处理方法</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>0 成功</dt><dd><ul>
<li><p>没有</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-1 空指针 EventInformation</dt><dd><ul>
<li><p>使用正确的 EventInformation</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-2 无效的 Pixie-16 模块编号</dt><dd><ul>
<li><p>使用正确的 ModuleNumber</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-3 无法打开列表模式数据文件</dt><dd><ul>
<li><p>正确的文件名和路径</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p><strong>示例代码</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">retval</span><span class="p">;</span><span class="w"></span>
<span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">FileName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;C:</span><span class="se">\\</span><span class="s">XIA</span><span class="se">\\</span><span class="s">Pixie16</span><span class="se">\\</span><span class="s">PulseShape</span><span class="se">\\</span><span class="s">listmodedata.bin&quot;</span><span class="p">};</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModuleNumber</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">EventInformation</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">ModuleEvents</span><span class="p">[</span><span class="mi">7</span><span class="p">];</span><span class="w"> </span><span class="c1">// assume maximum number of modules is 7</span>

<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16GetModuleEvents</span><span class="w"> </span><span class="p">(</span><span class="n">FileName</span><span class="p">,</span><span class="w"> </span><span class="n">ModuleEvents</span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// error handling</span>
<span class="p">}</span><span class="w"></span>

<span class="n">ModuleNumber</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="c1">// the first module</span>
<span class="n">EventInformation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"></span>
<span class="w">                   </span><span class="n">ModuleEvents</span><span class="p">[</span><span class="n">ModuleNumber</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">68</span><span class="p">);</span><span class="w"></span>
<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16GetEventsInfo</span><span class="p">(</span><span class="n">FileName</span><span class="p">,</span><span class="w"> </span><span class="n">EventInformation</span><span class="p">,</span><span class="w"> </span><span class="n">ModuleNumber</span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// error handling</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="pixie16getmoduleevents">
<h3>Pixie16GetModuleEvents<a class="headerlink" href="#pixie16getmoduleevents" title="永久链接至标题">¶</a></h3>
<p>解析列表模式数据文件以获取事件信息</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// 使用此功能可以解析列表模式数据文件中的列表模式事件。 将报告每个模块的事件数。</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">Pixie16GetModuleEvents</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">FileName</span><span class="p">,</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="n">mode</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="p">(</span><span class="n">with</span><span class="w"> </span><span class="n">complete</span><span class="w"> </span><span class="n">path</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">ModuleEvents</span><span class="w"> </span><span class="p">);</span><span class="w"> </span><span class="c1">// receives number of events for modules</span>
</pre></div>
</div>
<p><strong>返回值描述及错误处理方法</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>0 成功</dt><dd><ul>
<li><p>没有</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-1 无效指针 ModuleEvents</dt><dd><ul>
<li><p>使用正确的 ModuleEvents</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-2 无法打开列表模式数据文件</dt><dd><ul>
<li><p>使用正确的文件名和路径</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p><strong>示例代码</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">retval</span><span class="p">;</span><span class="w"></span>
<span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">FileName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;C:</span><span class="se">\\</span><span class="s">XIA</span><span class="se">\\</span><span class="s">Pixie16</span><span class="se">\\</span><span class="s">PulseShape</span><span class="se">\\</span><span class="s">listmodedata.bin&quot;</span><span class="p">};</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">ModuleEvents</span><span class="p">[</span><span class="mi">7</span><span class="p">];</span><span class="c1">// assume maximum number of modules is 7</span>

<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16GetModuleEvents</span><span class="w"> </span><span class="p">(</span><span class="n">FileName</span><span class="p">,</span><span class="w"> </span><span class="n">ModuleEvents</span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// error handling</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="pixie16imbufferio">
<h3>Pixie16IMbufferIO<a class="headerlink" href="#pixie16imbufferio" title="永久链接至标题">¶</a></h3>
<p>在主机和 DSP 内部存储器之间传输数据</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// 使用此功能可直接在主机与 Pixie-16 模块的 DSP 内部存储器之间传输数据。 ModNum 是从 0 开始计数的模块号。</span>
<span class="c1">// DSP 内部存储器分为两个块，第一个块的地址范围为 0x40000 至 0x4FFFF，第二个块的地址范围为 0x50000 至 0x5FFFF。 在第一个块中，地址范围 0x40000 到 0x49FFF 被保留用于程序存储器，并且不应由主机直接访问。 DSP I/O 参数使用地址范围 0x4A000 至 0x4A4FF，这些参数存储在主机的配置文件（.set文件）中。 在此范围内，可以读取和写入 0x4A000 至 0x4A33F，但是只能读取但不能写入 0x4A340 至 0x4A4FF。 第一块中的剩余地址范围（0x4A500 至 4FFFF）和整个第二块中的其余地址范围（0x50000 至 0x5FFFF）只能由主机读取，而不能写入。 将 Direction = 1 用于读取，将 Direction = 0 用于写入。</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">Pixie16IMbufferIO</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">Buffer</span><span class="p">,</span><span class="w">    </span><span class="c1">//buffer data</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">NumWords</span><span class="p">,</span><span class="w">   </span><span class="c1">//number of buffer words to transfer</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">Address</span><span class="p">,</span><span class="w">    </span><span class="c1">//buffer address</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">Direction</span><span class="p">,</span><span class="c1">//I/O direction</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="w"> </span><span class="p">);</span><span class="w"> </span><span class="c1">//module number</span>
</pre></div>
</div>
<p><strong>返回值描述及错误处理方法</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>0 成功</dt><dd><ul>
<li><p>没有</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-1 无效的指针 Buffer</dt><dd><ul>
<li><p>使用正确的指针 Buffer</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-2 Buffer 字数超过限制</dt><dd><ul>
<li><p>减少 Buffer 字长</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-3 无效的 DSP 内部存储器地址</dt><dd><ul>
<li><p>使用有效地址</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-4 无效的 I/O 方向</dt><dd><ul>
<li><p>使用有效方向</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-5 无效的 Pixie-16 模块编号</dt><dd><ul>
<li><p>使用正确的 ModNum</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-6 I/O 失败</dt><dd><ul>
<li><p>重新启动模块</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p><strong>示例代码</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">retval</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">Direction</span><span class="p">,</span><span class="w"> </span><span class="n">ModNum</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">DSPMemBlock1</span><span class="p">[</span><span class="mi">65536</span><span class="p">],</span><span class="w"> </span><span class="n">NumWords</span><span class="p">,</span><span class="w"> </span><span class="n">Address</span><span class="p">;</span><span class="w"></span>

<span class="n">NumWords</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">65536</span><span class="p">;</span><span class="w"> </span><span class="c1">//to read out block 1 of the DSP internal memory</span>
<span class="n">ModNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">     </span><span class="c1">//the first module in the system</span>
<span class="n">Address</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x50000</span><span class="p">;</span><span class="c1">//the starting address for block 1</span>
<span class="n">Direction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w">          </span><span class="c1">//I/O direction is read</span>

<span class="c1">// read out the whole block 1 of the DSP internal memory</span>
<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16IMbufferIO</span><span class="w"> </span><span class="p">(</span><span class="n">DSPMemBlock1</span><span class="p">,</span><span class="w"> </span><span class="n">NumWords</span><span class="p">,</span><span class="w"> </span><span class="n">Address</span><span class="p">,</span><span class="w"> </span><span class="n">Direction</span><span class="p">,</span><span class="w"> </span><span class="n">ModNum</span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// Error handling</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="pixie16initsystem">
<h3>Pixie16InitSystem<a class="headerlink" href="#pixie16initsystem" title="永久链接至标题">¶</a></h3>
<p>在 PXI 机箱中配置用于通信的模块</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// 使用此功能可在 PXI 机箱中配置 Pixie-16 模块。</span>
<span class="c1">// NumModules 是系统中安装的 Pixie-16 模块的总数。 PXISlotMap 是指向数组的指针，该数组必须至少具有与机箱中 Pixie-16 模块一样多的条目。</span>
<span class="c1">// PXISlotMap 充当逻辑模块号和模块所驻留的物理插槽号的简单映射。逻辑模块号从 0 开始运行。例如，在具有 5 个 Pixie-16 模块的系统中，这 5 个模块可能占用插槽 3 到 7。用户必须按如下方式填充 PXISlotMap：PXISlotMap = {3、4、5、6、7 ...}，因为模块号 0 驻留在插槽号 3 中，依此类推。要找出模块位于哪个插槽中， 任何后续代码都可以使用表达式 PXISlotMap [ModNum]，其中 ModNum 是逻辑模块号。</span>
<span class="c1">// OfflineMode 用于向 API 指示系统是在离线模式（1）还是在线模式（0）下运行。 离线模式对于没有 Pixie-16 模块但用户仍然可以在其应用程序软件中测试，对 API 函数的调用的情况很有用。</span>
<span class="c1">// 在启动过程中，必须将此功能称为第一步。 它使系统知道模块并 “打开” 每个模块进行通讯。</span>
<span class="c1">// 该功能依赖于一个初始化文件（pxisys.ini），该文件包含有关主机 PC 的 PCI 总线的信息，包括插槽枚举方案。 XIA 的软件发行版通常将此文件放在与 Pixie-16 软件安装文件夹相同的文件夹下。 但是，用户可以通过简单地在文件 pixie16sys.c 的顶部中更改字符串 PCISysIniFile 的定义来灵活地将其放置在其他文件夹中。</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">Pixie16InitSystem</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">NumModules</span><span class="p">,</span><span class="w">   </span><span class="c1">//total number of Pixie-16 modules</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="o">*</span><span class="n">PXISlotMap</span><span class="p">,</span><span class="w">  </span><span class="c1">//an array containing the slot number of each Pixie-16 module</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">OfflineMode</span><span class="w"> </span><span class="p">);</span><span class="c1">//specify if using offline mode</span>
</pre></div>
</div>
<p><strong>返回值描述及错误处理方法</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>0 成功</dt><dd><ul>
<li><p>没有</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-1 Pixie-16 模块总数无效</dt><dd><ul>
<li><p>检查是否满足 NumModules &lt;= PRESET_MAX_MODULES(在 pixie16app_defs.h 中定义)</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-2 空指针 PXISlotMap</dt><dd><ul>
<li><p>使用正确的 PXISlotMap</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-3 初始化系统失败</dt><dd><ul>
<li><p>检查错误消息日志文件 Pixie16msg.txt</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p><strong>示例代码</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">retval</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">NumModules</span><span class="p">,</span><span class="w"> </span><span class="n">PXISlotMap</span><span class="p">[</span><span class="mi">8</span><span class="p">],</span><span class="w"> </span><span class="n">OfflineMode</span><span class="p">;</span><span class="w"></span>

<span class="c1">// there are 5 modules in the system</span>
<span class="n">NumModules</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span><span class="w"></span>

<span class="c1">// specify the slot number for each module</span>
<span class="n">PXISlotMap</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"></span>
<span class="n">PXISlotMap</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w"></span>
<span class="n">PXISlotMap</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span><span class="w"></span>
<span class="n">PXISlotMap</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span><span class="w"></span>
<span class="n">PXISlotMap</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">6</span><span class="p">;</span><span class="w"></span>

<span class="c1">// running in online mode</span>
<span class="n">OfflineMode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>

<span class="c1">// configure the PXI slots in the chassis</span>
<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16InitSystem</span><span class="w"> </span><span class="p">(</span><span class="n">NumModules</span><span class="p">,</span><span class="w"> </span><span class="n">PXISlotMap</span><span class="p">,</span><span class="w"> </span><span class="n">OfflineMode</span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// error handling</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="pixie16loaddspparametersfromfile">
<h3>Pixie16LoadDSPParametersFromFile<a class="headerlink" href="#pixie16loaddspparametersfromfile" title="永久链接至标题">¶</a></h3>
<p>从文件将DSP参数加载到模块</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// 使用此功能可从设置文件读取 DSP 参数，然后将设置下载到系统中安装的 Pixie-16 模块。 每个模块具有正好 1280 个 DSP 参数值（32位无符号整数），并且根据 PRESET_MAX_MODULES 的值（在 pixie16app_defs.h 中定义），设置文件存储在计算机上时应正好具有（1280 * PRESET_MAX_MODULES * 4）个字节。</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">Pixie16LoadDSPParametersFromFile</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">FileName</span><span class="w"> </span><span class="p">);</span><span class="w"> </span><span class="c1">// DSP parameters file name (with complete path)</span>
</pre></div>
</div>
<p><strong>返回值描述及错误处理方法</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>0 成功</dt><dd><ul>
<li><p>没有</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-1 DSPParFile 的大小无效</dt><dd><ul>
<li><p>使用正确的 DSPParFile</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-2 无法在模块中编程 Fippi</dt><dd><ul>
<li><p>重新启动模块</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-3 无法在模块中设置 DAC</dt><dd><ul>
<li><p>重新启动模块</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-4 打开 DSP 参数文件失败</dt><dd><ul>
<li><p>更正 DSP 参数文件名</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p><strong>示例代码</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">retval</span><span class="p">;</span><span class="w"></span>
<span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">FileName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;C:</span><span class="se">\\</span><span class="s">XIA</span><span class="se">\\</span><span class="s">Pixie16</span><span class="se">\\</span><span class="s">Configuration</span><span class="se">\\</span><span class="s">test.set&quot;</span><span class="p">};</span><span class="w"></span>

<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16LoadDSPParametersFromFile</span><span class="w"> </span><span class="p">(</span><span class="n">FileName</span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// error handling</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="pixie16programfippi">
<h3>Pixie16ProgramFippi<a class="headerlink" href="#pixie16programfippi" title="永久链接至标题">¶</a></h3>
<p>编程板载信号处理FPGA</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// 使用此功能可以对 Pixie-16 模块的板载信号处理 FPGA 进行编程。 主机将 DSP 参数写入 DSP 存储器后，DSP 需要将其中一些参数写入 FPGA。 此功能使 DSP 执行该操作。 ModNum 是从 0 开始计数的模块号。</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">Pixie16ProgramFippi</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">);</span><span class="c1">// module number</span>
</pre></div>
</div>
<p><strong>返回值描述及错误处理方法</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>0 成功</dt><dd><ul>
<li><p>没有</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-1 无效的 Pixie-16 模块编号</dt><dd><ul>
<li><p>使用正确的 ModNum</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-2 无法启动 PROGRAM_FIPPI 运行</dt><dd><ul>
<li><p>重新启动模块</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-3 PROGRAM_FIPPI 运行超时</dt><dd><ul>
<li><p>重新启动模块</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p><strong>示例代码</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">retval</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">;</span><span class="w"></span>
<span class="n">ModNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="c1">// the first module</span>

<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16ProgramFippi</span><span class="w"> </span><span class="p">(</span><span class="n">ModNum</span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// error handling</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="pixie16readcsr">
<h3>Pixie16ReadCSR<a class="headerlink" href="#pixie16readcsr" title="永久链接至标题">¶</a></h3>
<p>从模块读取控制和状态寄存器值</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// 使用此功能读取主机控制和状态寄存器（CSR）值。 该寄存器与 DSP 参数 ModCSRA/B，ChanCSRA/B 无关。 它用于控制模块的操作并由主机直接读取。不建议主机直接读取或写入，例如，使用 Pixie16CheckRunStatus 之类的功能来轮询活动位。</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">Pixie16ReadCSR</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">,</span><span class="c1">// module number</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">CSR</span><span class="w"> </span><span class="p">);</span><span class="w">  </span><span class="c1">// returned CSR value</span>
</pre></div>
</div>
<p><strong>返回值描述及错误处理方法</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>0 成功</dt><dd><ul>
<li><p>没有</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-1 无效的 Pixie-16 模块编号</dt><dd><ul>
<li><p>使用正确的 ModNum</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p><strong>示例代码</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">CSR</span><span class="p">;</span><span class="w"></span>
<span class="n">ModNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="c1">// the first module</span>
<span class="n">Pixie16ReadCSR</span><span class="w"> </span><span class="p">(</span><span class="n">ModNum</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">CSR</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="pixie16readdatafromexternalfifo">
<h3>Pixie16ReadDataFromExternalFIFO<a class="headerlink" href="#pixie16readdatafromexternalfifo" title="永久链接至标题">¶</a></h3>
<p>从模块的外部 FIFO 读取数据</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// 使用此功能从模块的外部 FIFO 读取数据。</span>
<span class="c1">// 此功能从 Pixie-16 模块的外部 FIFO 读取列表模式数据。 数据是 32 位无符号整数。通常，首先调用函数 Pixie16CheckExternalFIFOStatus 来查看外部 FIFO 当前有多少个字，然后调用此函数从 FIFO 中读取数据。 ModNum 是从 0 开始计数的模块号。</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">Pixie16ReadDataFromExternalFIFO</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">ExtFIFO_Data</span><span class="p">,</span><span class="c1">// to receive the external FIFO data</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">nFIFOWords</span><span class="p">,</span><span class="c1">// number of words to read from FIFO</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="w"> </span><span class="p">);</span><span class="c1">// module number</span>
</pre></div>
</div>
<p><strong>返回值描述及错误处理方法</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>0 成功</dt><dd><ul>
<li><p>没有</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-1 无效的 Pixie-16 模块编号</dt><dd><ul>
<li><p>检查 ModNum</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-2 无法从外部 FIFO 读取数据</dt><dd><ul>
<li><p>检查错误消息日志文件 Pixie16msg.txt</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p><strong>示例代码</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">retval</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">nFIFOWords</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">ExtFIFO_Data</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">;</span><span class="w"></span>

<span class="n">ModNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="c1">// the first module in the system</span>
<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16CheckExternalFIFOStatus</span><span class="w"> </span><span class="p">(</span><span class="o">&amp;</span><span class="n">nFIFOWords</span><span class="p">,</span><span class="w"> </span><span class="n">ModNum</span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// Error handling</span>
<span class="p">}</span><span class="w"></span>

<span class="k">if</span><span class="p">(</span><span class="n">nFIFOWords</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="c1">// Check if there is data in the external FIFO</span>
<span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">ExtFIFO_Data</span><span class="w"> </span><span class="o">=</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">nFIFOWords</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16ReadDataFromExternalFIFO</span><span class="p">(</span><span class="n">ExtFIFO_Data</span><span class="p">,</span><span class="n">nFIFOWords</span><span class="p">,</span><span class="n">ModNum</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="c1">// Error handling</span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="pixie16readhistogramfromfile">
<h3>Pixie16ReadHistogramFromFile<a class="headerlink" href="#pixie16readhistogramfromfile" title="永久链接至标题">¶</a></h3>
<p>从直方图数据文件中读取直方图数据</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// 使用此功能可以从直方图数据文件中读取直方图数据。在调用此函数之前，主机代码应分配适当的内存量以存储直方图数据。 默认直方图长度为 32768。直方图数据是 32 位无符号整数。</span>
<span class="c1">// 使用 ModNum 指定模块，并使用 ChanNum 指定模块上的通道。请注意，模块和通道均从 0 开始计数。</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">Pixie16ReadHistogramFromFile</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">FileName</span><span class="p">,</span><span class="o">//</span><span class="w"> </span><span class="n">histogram</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="p">(</span><span class="n">with</span><span class="w"> </span><span class="n">complete</span><span class="w"> </span><span class="n">path</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">Histogram</span><span class="p">,</span><span class="c1">// histogram data</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">NumWords</span><span class="p">,</span><span class="c1">// number of words to be read out</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">,</span><span class="c1">// module number</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ChanNum</span><span class="p">);</span><span class="c1">// channel number</span>
</pre></div>
</div>
<p><strong>返回值描述及错误处理方法</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>0 成功</dt><dd><ul>
<li><p>没有</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-1 无法打开直方图数据文件</dt><dd><ul>
<li><p>更正直方图数据文件名</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-2 该通道没有直方图数据</dt><dd><ul>
<li><p>更改 ModNum 和 ChanNum</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p><strong>示例代码</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">retval</span><span class="p">;</span><span class="w"></span>
<span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">FileName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;C:</span><span class="se">\\</span><span class="s">XIA</span><span class="se">\\</span><span class="s">Pixie16</span><span class="se">\\</span><span class="s">MCA</span><span class="se">\\</span><span class="s">histogramdata.bin&quot;</span><span class="p">};</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">,</span><span class="w"> </span><span class="n">ChanNum</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">NumWords</span><span class="p">,</span><span class="w"> </span><span class="n">Histogram</span><span class="p">[</span><span class="mi">32768</span><span class="p">];</span><span class="w"></span>
<span class="n">ModNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">  </span><span class="c1">// the first module</span>
<span class="n">ChanNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="c1">// the first channel</span>
<span class="n">NumWords</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">32768</span><span class="p">;</span><span class="w"></span>

<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16ReadHistogramFromFile</span><span class="w"> </span><span class="p">(</span><span class="n">FileName</span><span class="p">,</span><span class="w"> </span><span class="n">Histogram</span><span class="p">,</span><span class="w"> </span><span class="n">NumWords</span><span class="p">,</span><span class="w"></span>
<span class="n">ModNum</span><span class="p">,</span><span class="w"> </span><span class="n">ChanNum</span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// error handling</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="pixie16readhistogramfrommodule">
<h3>Pixie16ReadHistogramFromModule<a class="headerlink" href="#pixie16readhistogramfrommodule" title="永久链接至标题">¶</a></h3>
<p>从模块读取直方图数据</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// 使用此功能可以从 Pixie-16 模块的直方图存储器中读取直方图数据。在调用此函数之前，主机代码应分配适当的内存量以存储直方图数据。默认直方图长度为 32768。直方图数据是 32 位无符号整数。</span>
<span class="c1">// 使用 ModNum 指定模块，并使用 ChanNum 指定模块上的通道。请注意，模块和通道均从 0 开始计数。</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">Pixie16ReadHistogramFromModule</span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">Histogram</span><span class="p">,</span><span class="c1">//histogram data</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">NumWords</span><span class="p">,</span><span class="c1">//number of words to be read out</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">,</span><span class="c1">//module number</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ChanNum</span><span class="p">);</span><span class="c1">//channel number</span>
</pre></div>
</div>
<p><strong>返回值描述及错误处理方法</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>0 成功</dt><dd><ul>
<li><p>没有</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-1 无效的 Pixie-16 模块编号</dt><dd><ul>
<li><p>使用正确的 ModNum</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-2 无效的 Pixie-16 通道号</dt><dd><ul>
<li><p>使用正确的 ChanNum</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-3 无法获取直方图数据</dt><dd><ul>
<li><p>重新启动模块</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p><strong>示例代码</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">retval</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">,</span><span class="w"> </span><span class="n">ChanNum</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">NumWords</span><span class="p">,</span><span class="w"> </span><span class="n">Histogram</span><span class="p">[</span><span class="mi">32768</span><span class="p">];</span><span class="w"></span>

<span class="n">ModNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="c1">// the first module</span>
<span class="n">ChanNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="c1">// the first channel</span>
<span class="n">NumWords</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">32768</span><span class="p">;</span><span class="w"></span>

<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16ReadHistogramFromModule</span><span class="w"> </span><span class="p">(</span><span class="n">Histogram</span><span class="p">,</span><span class="w"> </span><span class="n">NumWords</span><span class="p">,</span><span class="w"> </span><span class="n">ModNum</span><span class="p">,</span><span class="w"> </span><span class="n">ChanNum</span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// error handling</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="pixie16readlistmodetrace">
<h3>Pixie16ReadListModeTrace<a class="headerlink" href="#pixie16readlistmodetrace" title="永久链接至标题">¶</a></h3>
<p>从列表模式数据文件中读取波形数据</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// 使用此功能从列表模式数据文件中检索列表模式的波形。它使用从函数 Pixie16GetEventsInfo 获得的选定事件的波形长度和文件位置信息。</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">Pixie16ReadListModeTrace</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">FileName</span><span class="p">,</span><span class="w">            </span><span class="c1">//list mode data file name</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="o">*</span><span class="n">Trace_Data</span><span class="p">,</span><span class="o">//</span><span class="n">list</span><span class="w"> </span><span class="n">mode</span><span class="w"> </span><span class="n">trace</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="p">(</span><span class="mi">16</span><span class="o">-</span><span class="n">bit</span><span class="w"> </span><span class="n">words</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">NumWords</span><span class="p">,</span><span class="w">   </span><span class="c1">//number of 16-bit words to be read out</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">FileLocation</span><span class="p">);</span><span class="c1">//the location of the trace in the file</span>
</pre></div>
</div>
<p><strong>返回值描述及错误处理方法</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>0 成功</dt><dd><ul>
<li><p>没有</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-1 无法打开列表模式数据文件</dt><dd><ul>
<li><p>正确的文件名和路径</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p><strong>示例代码</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">retval</span><span class="p">;</span><span class="w"></span>
<span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">FileName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;C:</span><span class="se">\\</span><span class="s">XIA</span><span class="se">\\</span><span class="s">Pixie16</span><span class="se">\\</span><span class="s">PulseShape</span><span class="se">\\</span><span class="s">listmodedata.bin&quot;</span><span class="p">};</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModuleNumber</span><span class="p">,</span><span class="w"> </span><span class="n">ChannelNumber</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">EventInformation</span><span class="p">,</span><span class="w"> </span><span class="n">FileLocation</span><span class="p">,</span><span class="w"> </span><span class="n">EventNumber</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="o">*</span><span class="n">Trace_Data</span><span class="p">,</span><span class="w"> </span><span class="n">NumWords</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">ModuleEvents</span><span class="p">[</span><span class="mi">7</span><span class="p">];</span><span class="w"> </span><span class="c1">// assume maximum number of modules is 7</span>

<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16GetModuleEvents</span><span class="w"> </span><span class="p">(</span><span class="n">FileName</span><span class="p">,</span><span class="w"> </span><span class="n">ModuleEvents</span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// error handling</span>
<span class="p">}</span><span class="w"></span>
<span class="n">ModuleNumber</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="c1">// the first module</span>
<span class="n">EventInformation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">ModuleEvents</span><span class="p">[</span><span class="n">ModuleNumber</span><span class="p">]</span><span class="o">*</span><span class="mi">68</span><span class="p">);</span><span class="w"></span>

<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16GetEventsInfo</span><span class="w"> </span><span class="p">(</span><span class="n">FileName</span><span class="p">,</span><span class="w"> </span><span class="n">EventInformation</span><span class="p">,</span><span class="w"> </span><span class="n">ModuleNumber</span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// error handling</span>
<span class="p">}</span><span class="w"></span>

<span class="n">ChannelNumber</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="c1">// the first channel</span>
<span class="n">EventNumber</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">  </span><span class="c1">// the first event</span>

<span class="n">NumWords</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="p">)</span><span class="n">EventInformation</span><span class="p">[</span><span class="n">EventNumber</span><span class="o">*</span><span class="mi">68</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">10</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"></span>

<span class="n">FileLocation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">EventInformation</span><span class="p">[</span><span class="n">EventNumber</span><span class="o">*</span><span class="mi">68</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">11</span><span class="p">];</span><span class="w"></span>
<span class="n">Trace_Data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">NumWords</span><span class="p">);</span><span class="w"></span>
<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16ReadListModeTrace</span><span class="w"> </span><span class="p">(</span><span class="n">FileName</span><span class="p">,</span><span class="n">Trace_Data</span><span class="p">,</span><span class="n">NumWords</span><span class="p">,</span><span class="n">FileLocation</span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// error handling</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="pixie16readmoduleinfo">
<h3>Pixie16ReadModuleInfo<a class="headerlink" href="#pixie16readmoduleinfo" title="永久链接至标题">¶</a></h3>
<p>读取有关存储在 EEPROM 中的模块信息</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// 使用此功能可以读取存储在每个模块上的信息，包括其版本，序列号，ADC 位和采样率。这应该在初始化 PCI 通信之后完成。在启动模块之前，可以使用来自模块的信息来选择适当的固件，DSP 和配置参数文件。 ModNum 是从 0 开始计数的模块号。</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">Pixie16ReadModuleInfo</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">,</span><span class="w">       </span><span class="c1">//module number</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="o">*</span><span class="n">ModRev</span><span class="p">,</span><span class="w">      </span><span class="c1">//returned module revision</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">ModSerNum</span><span class="p">,</span><span class="w">     </span><span class="c1">//returned module serial number</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="o">*</span><span class="n">ModADCBits</span><span class="p">,</span><span class="w">  </span><span class="c1">//returned module ADC bits</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="o">*</span><span class="n">ModADCMSPS</span><span class="w"> </span><span class="p">);</span><span class="c1">//returned module ADC sampling rate</span>
</pre></div>
</div>
<p><strong>返回值描述及错误处理方法</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>0 成功</dt><dd><ul>
<li><p>没有</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-1 无效的 Pixie 模块编号</dt><dd><ul>
<li><p>使用正确的 ModNum</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-2 无法从 I2C 串行 EEPROM 读取</dt><dd><ul>
<li><p>检查错误消息日志文件 Pixie16msg.txt</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p><strong>示例代码</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">retval</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModuleNumber</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModRev</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">ModSerNum</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModADCBits</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModADCMSPS</span><span class="p">;</span><span class="w"></span>

<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16ReadModuleInfo</span><span class="w"> </span><span class="p">(</span><span class="n">ModuleNumber</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ModRev</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ModSerNum</span><span class="p">,</span><span class="w"></span>
<span class="o">&amp;</span><span class="n">ModADCBits</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ModADCMSPS</span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// error handling</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="pixie16readsglchanadctrace">
<h3>Pixie16ReadSglChanADCTrace<a class="headerlink" href="#pixie16readsglchanadctrace" title="永久链接至标题">¶</a></h3>
<p>从模块中的通道读取 ADC 波形数据</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// 使用此功能从 Pixie-16 模块读取 ADC 波形数据。在调用此函数之前，应先调用另一个函数 Pixie16AcquireADCTrace 来填充 DSP 内部存储器。同样，主机代码应分配适当的内存量以存储波形数据。 每个通道的 ADC 波形数据长度为 8192。由于波形数据是 16 位无符号整数（对于少于 16 位 ADC 的硬件型号，只有低 12 位或 14 位包含实数据），因此两个连续的 16 位字被打包到 DSP 内部存储器中的一个 32 位字中。 因此，对于每个通道，首先从 DSP 读取 4096 个 32 位字，然后将每个 32 位字解包以形成两个 16 位字。</span>
<span class="c1">// 使用 ModNum 指定模块，并使用 ChanNum 指定模块上的通道。请注意，模块和通道均从 0 开始计数。</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">Pixie16ReadSglChanADCTrace</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="o">*</span><span class="n">Trace_Buffer</span><span class="p">,</span><span class="w"> </span><span class="c1">//trace data</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">Trace_Length</span><span class="p">,</span><span class="c1">//number of trace data words to read</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">,</span><span class="c1">//module number</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ChanNum</span><span class="w"> </span><span class="p">);</span><span class="c1">//channel number</span>
</pre></div>
</div>
<p><strong>返回值描述及错误处理方法</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>0 成功</dt><dd><ul>
<li><p>没有</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-1 无效的 Pixie-16 模块编号</dt><dd><ul>
<li><p>使用正确的 ModNum</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-2 无效的 Pixie-16 通道号</dt><dd><ul>
<li><p>使用正确的 ChanNum</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-3 无效的波形长度</dt><dd><ul>
<li><p>使用正确的 Trace_Length</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-4 分配内存以存储 ADC 波形失败</dt><dd><ul>
<li><p>关闭其他程序或重新启动计算机</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-5 读取 ADC 波形失败</dt><dd><ul>
<li><p>重新启动模块</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p><strong>示例代码</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">NumWords</span><span class="p">,</span><span class="w"> </span><span class="n">ModNum</span><span class="p">,</span><span class="w"> </span><span class="n">ChanNum</span><span class="p">;</span><span class="w"></span>
<span class="kt">int</span><span class="w"> </span><span class="n">retval</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ADCTrace</span><span class="p">[</span><span class="mi">8192</span><span class="p">];</span><span class="w"></span>
<span class="c1">// assume we want to acquire ADC trace from channel 0 of module 0</span>
<span class="n">ModNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="n">ChanNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>

<span class="c1">// number of ADC trace words is 8192</span>
<span class="n">NumWords</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">8192</span><span class="p">;</span><span class="w"></span>

<span class="c1">// acquire the trace</span>
<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16AcquireADCTrace</span><span class="p">(</span><span class="n">ModNum</span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// error handling</span>
<span class="p">}</span><span class="w"></span>

<span class="c1">// read out the trace</span>
<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16ReadSglChanADCTrace</span><span class="p">(</span><span class="n">ADCTrace</span><span class="p">,</span><span class="w"> </span><span class="n">NumWords</span><span class="p">,</span><span class="w"> </span><span class="n">ModNum</span><span class="p">,</span><span class="w"> </span><span class="n">ChanNum</span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// error handling</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="pixie16readsglchanbaselines">
<h3>Pixie16ReadSglChanBaselines<a class="headerlink" href="#pixie16readsglchanbaselines" title="永久链接至标题">¶</a></h3>
<p>读取模块中一通道的基线</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// 使用此功能可从 Pixie-16 模块读取基线数据。在调用该函数之前，应先调用另一个函数 Pixie16AcquireBaselines 来填充 DSP 内部存储器。另外，主机代码应分配适当的内存量以存储基线数据。每个通道的基线数目是 3640。在 DSP 内部存储器中，每个基准是 32 位 IEEE 浮点数。 在读出给主机后，此功能会将每个基线数据转换为十进制数。除了基线值，此函数调用后还会返回与每个基线相对应的时间戳。</span>
<span class="c1">// 使用 ModNum 指定模块，并使用 ChanNum 指定模块上的通道。请注意，模块和通道从 0 开始计数。</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">Pixie16ReadSglChanBaselines</span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">Baselines</span><span class="p">,</span><span class="w">       </span><span class="c1">//returned baseline values</span>
<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">TimeStamps</span><span class="p">,</span><span class="w">      </span><span class="c1">//timestamps for each baseline value</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">NumBases</span><span class="p">,</span><span class="w"> </span><span class="c1">//number of baseline data words to read</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">,</span><span class="w">   </span><span class="c1">//module number</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ChanNum</span><span class="w"> </span><span class="p">);</span><span class="c1">//channel number</span>
</pre></div>
</div>
<p><strong>返回值描述及错误处理方法</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>0 成功</dt><dd><ul>
<li><p>没有</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-1 无效的 Pixie-16 模块编号</dt><dd><ul>
<li><p>使用正确的 ModNum</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-2 请求的基线数量超出限制</dt><dd><ul>
<li><p>使用正确的 NumBases</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-3 无法分配内存来存储基线</dt><dd><ul>
<li><p>关闭其他程序或重新启动计算机</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-4 无法读取基线</dt><dd><ul>
<li><p>重新启动模块</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p><strong>示例代码</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">NumWords</span><span class="p">,</span><span class="w"> </span><span class="n">ModNum</span><span class="p">,</span><span class="w"> </span><span class="n">ChanNum</span><span class="p">;</span><span class="w"></span>
<span class="kt">int</span><span class="w"> </span><span class="n">retval</span><span class="p">;</span><span class="w"></span>
<span class="kt">double</span><span class="w"> </span><span class="n">Baselines</span><span class="p">[</span><span class="mi">3640</span><span class="p">],</span><span class="w"> </span><span class="n">TimeStamps</span><span class="p">[</span><span class="mi">3640</span><span class="p">];</span><span class="w"></span>

<span class="c1">// assume we want to acquire baselines for channel 0 of module 0</span>
<span class="n">ModNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="n">ChanNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>

<span class="c1">// number of baseline words is 3640</span>
<span class="n">NumWords</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3640</span><span class="p">;</span><span class="w"></span>

<span class="c1">// acquire the baselines</span>
<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16AcquireBaselines</span><span class="w"> </span><span class="p">(</span><span class="n">ModNum</span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// error handling</span>
<span class="p">}</span><span class="w"></span>

<span class="c1">// read out the baselines</span>
<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16ReadSglChanBaselines</span><span class="w"> </span><span class="p">(</span><span class="n">Baselines</span><span class="p">,</span><span class="w"> </span><span class="n">TimeStamps</span><span class="p">,</span><span class="w"> </span><span class="n">NumWords</span><span class="p">,</span><span class="w"> </span><span class="n">ModNum</span><span class="p">,</span><span class="w"> </span><span class="n">ChanNum</span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// error handling</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="pixie16readsglchanpar">
<h3>Pixie16ReadSglChanPar<a class="headerlink" href="#pixie16readsglchanpar" title="永久链接至标题">¶</a></h3>
<p>从模块读取 CHANNEL 级别参数</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// 使用此功能可从 Pixie-16 模块读取通道参数。ModNum 是从 0 开始计数的模块号。ChanNum 是从 0 开始计数的通道号。</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">Pixie16ReadSglChanPar</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">ChanParName</span><span class="p">,</span><span class="w">       </span><span class="c1">// channel parameter name</span>
<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">ChanParData</span><span class="p">,</span><span class="w">     </span><span class="c1">// channel parameter value</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">,</span><span class="w">   </span><span class="c1">// channel number</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ChanNum</span><span class="w"> </span><span class="p">);</span><span class="c1">// module number</span>
</pre></div>
</div>
<p><strong>返回值描述及错误处理方法</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>0 成功</dt><dd><ul>
<li><p>没有</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-1 无效的 Pixie-16 模块编号</dt><dd><ul>
<li><p>使用有效的 ModNum</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-2 无效的 Pixie-16 通道号</dt><dd><ul>
<li><p>使用有效的 ChanNum</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-3 无效的通道参数名称</dt><dd><ul>
<li><p>使用有效的 ChanParName</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p><strong>示例代码</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">retval</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">,</span><span class="w"> </span><span class="n">ChanNum</span><span class="p">;</span><span class="w"></span>
<span class="kt">double</span><span class="w"> </span><span class="n">ChanParData</span><span class="p">;</span><span class="w"></span>

<span class="c1">// read energy filter rise time from module 0 channel 0</span>
<span class="n">ModNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="c1">// this is the first module</span>
<span class="n">ChanNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="c1">// the first channel</span>

<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16ReadSglChanPar</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;ENERGY_RISETIME”, &amp;ChanParData, ModNum, ChanNum);</span>
<span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// Error handling</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="pixie16readsglmodpar">
<h3>Pixie16ReadSglModPar<a class="headerlink" href="#pixie16readsglmodpar" title="永久链接至标题">¶</a></h3>
<p>从模块读取 MODULE 级别参数</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// 使用此功能可从 Pixie-16 模块读取模块参数。ModNum 是从 0 开始计数的模块号。</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">Pixie16ReadSglModPar</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">ModParName</span><span class="p">,</span><span class="w">        </span><span class="c1">// module parameter name</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">ModParData</span><span class="p">,</span><span class="c1">// module parameter value</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="w"> </span><span class="p">);</span><span class="w"> </span><span class="c1">// module number</span>
</pre></div>
</div>
<p><strong>返回值描述及错误处理方法</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>0 成功</dt><dd><ul>
<li><p>没有</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-1 无效的 Pixie-16 模块编号</dt><dd><ul>
<li><p>使用正确的 ModNum</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-2 无效的模块参数名称</dt><dd><ul>
<li><p>使用正确的 ModParName</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p><strong>示例代码</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">retval</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">ModParData</span><span class="p">;</span><span class="w"></span>

<span class="c1">// Read SlowFilterRange in module 0</span>
<span class="n">ModNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="c1">// this is the first module</span>

<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16ReadSglModPar</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;SLOW_FILTER_RANGE”, &amp;ModParData, ModNum);</span>
<span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// Error handling</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="pixie16readstatisticsfrommodule">
<h3>Pixie16ReadStatisticsFromModule<a class="headerlink" href="#pixie16readstatisticsfrommodule" title="永久链接至标题">¶</a></h3>
<p>从模块读取运行统计数据</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// 使用此功能可以从 Pixie-16 模块中读取统计数据。在调用此函数之前，主机代码应分配适当的内存量以存储统计数据。每个模块的统计数据数量固定为 448。统计数据是 32 位无符号整数。</span>
<span class="c1">// 使用 ModNum 指定模块。 请注意，模块从 0 开始计数。</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">Pixie16ReadStatisticsFromModule</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">Statistics</span><span class="p">,</span><span class="c1">// statistics data</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="w"> </span><span class="p">);</span><span class="w"> </span><span class="c1">// module number</span>
</pre></div>
</div>
<p><strong>返回值描述及错误处理方法</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>0 成功</dt><dd><ul>
<li><p>没有</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-1 无效的 Pixie-16 模块编号</dt><dd><ul>
<li><p>使用正确的 ModNum</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-2 无法获取统计数据</dt><dd><ul>
<li><p>重新启动模块</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p><strong>示例代码</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">retval</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">,</span><span class="w"> </span><span class="n">ChanNum</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">Statistics</span><span class="p">[</span><span class="mi">448</span><span class="p">];</span><span class="w"></span>

<span class="n">ModNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="c1">// the first module</span>
<span class="n">ChanNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="c1">// the first channel</span>

<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16ReadStatisticsFromModule</span><span class="w"> </span><span class="p">(</span><span class="n">Statistics</span><span class="p">,</span><span class="w"> </span><span class="n">ModNum</span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// error handling</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="pixie16registerio">
<h3>Pixie16RegisterIO<a class="headerlink" href="#pixie16registerio" title="永久链接至标题">¶</a></h3>
<p>读取或写入模块上的寄存器</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// 使用此功能可从 Pixie-16 模块中的寄存器读取数据或将数据写入其中。</span>
<span class="c1">// 使用 ModNum 指定模块。 请注意，模块从 0 开始计数。</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">Pixie16RegisterIO</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">,</span><span class="w">   </span><span class="c1">//module number</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">address</span><span class="p">,</span><span class="w">    </span><span class="c1">//register address</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">direction</span><span class="p">,</span><span class="c1">//read or write</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">value</span><span class="w"> </span><span class="p">);</span><span class="w">   </span><span class="c1">//holds or receives the data</span>
</pre></div>
</div>
<p><strong>返回值描述及错误处理方法</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>0 成功</dt><dd><ul>
<li><p>没有</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-1 无效的 Pixie-16 模块编号</dt><dd><ul>
<li><p>使用正确的 ModNum</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p><strong>示例代码</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">retval</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">address</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">;</span><span class="w"></span>
<span class="n">ModNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="c1">// the first module</span>
<span class="n">address</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PCI_STOPRUN_REGADDR</span><span class="p">;</span><span class="c1">// address of the register for ending run</span>
<span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>

<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16RegisterIO</span><span class="p">(</span><span class="n">ModNum</span><span class="p">,</span><span class="w"> </span><span class="n">address</span><span class="p">,</span><span class="w"> </span><span class="n">MOD_WRITE</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">value</span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// error handling</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="pixie16savedspparameterstofile">
<h3>Pixie16SaveDSPParametersToFile<a class="headerlink" href="#pixie16savedspparameterstofile" title="永久链接至标题">¶</a></h3>
<p>从模块读取 DSP 参数并保存到文件</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// 使用此功能可将 DSP 参数保存到设置文件中。它将首先读取每个 Pixie-16 模块上的 DSP 参数值，然后将它们写入设置文件。每个模块具有正好 1280 个 DSP 参数值（32位无符号整数），并且根据 PRESET_MAX_MODULES 的值（在 pixie16app_defs.h中定义），设置文件存储在计算机上时应正好具有（1280 * PRESET_MAX_MODULES * 4）个硬盘字节。</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">Pixie16SaveDSPParametersToFile</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">FileName</span><span class="w"> </span><span class="p">);</span><span class="w"> </span><span class="c1">// DSP parameters file name (with complete path)</span>
</pre></div>
</div>
<p><strong>返回值描述及错误处理方法</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>0 成功</dt><dd><ul>
<li><p>没有</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-1 无法从 Pixie-16 模块读取 DSP 参数值</dt><dd><ul>
<li><p>重新启动模块</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-2 打开 DSP 参数文件失败</dt><dd><ul>
<li><p>更正 DSP 参数文件名</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p><strong>示例代码</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">retval</span><span class="p">;</span><span class="w"></span>
<span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">FileName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;C:</span><span class="se">\\</span><span class="s">XIA</span><span class="se">\\</span><span class="s">Pixie16</span><span class="se">\\</span><span class="s">Configuration</span><span class="se">\\</span><span class="s">test.set&quot;</span><span class="p">};</span><span class="w"></span>

<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16SaveDSPParametersToFile</span><span class="w"> </span><span class="p">(</span><span class="n">FileName</span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// error handling</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="pixie16saveexternalfifodatatofile">
<h3>Pixie16SaveExternalFIFODataToFile<a class="headerlink" href="#pixie16saveexternalfifodatatofile" title="永久链接至标题">¶</a></h3>
<p>从外部 FIFO 读取数据并保存到文件</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Use this function to read data from the external FIFO of a module. ModNum is the module number which starts counting at 0.</span>
<span class="c1">// 此函数首先检查 Pixie-16 模块的外部 FIFO 的状态，如果外部 FIFO 中有数据，则此函数从外部 FIFO 读取列表模式数据（32位无符号整数）。因此，此函数实质上将两个函数 Pixie16CheckExternalFIFOStatus 和 Pixie16ReadDataFromExternalFIFO 封装在一个函数中。从外部 FIFO 读取的字数记录在变量 *FIFOWords 中。该函数还希望设置一个名为 “EndOfRunRead”的变量的值，以指示该读取是在运行结束时（1）还是在运行期间（0）。这是必要的，因为当主机由于其流水线结构而从外部 FIFO 读取最后几个字时，需要对外部 FIFO 进行特殊处理。</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">Pixie16SaveExternalFIFODataToFile</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">FileName</span><span class="p">,</span><span class="c1">// list mode data file name</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">nFIFOWords</span><span class="p">,</span><span class="c1">// number of words read from ext. FIFO</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">,</span><span class="c1">// module number</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">EndOfRunRead</span><span class="w"> </span><span class="p">);</span><span class="w"> </span><span class="c1">// indicator if this is end of run read</span>
</pre></div>
</div>
<p><strong>返回值描述及错误处理方法</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>0 成功</dt><dd><ul>
<li><p>没有</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-1 无效的 Pixie-16 模块编号</dt><dd><ul>
<li><p>使用正确的 ModNum</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-2 分配内存以存储列表模式数据失败</dt><dd><ul>
<li><p>检查计算机资源</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-3 无法打开列表模式数据文件</dt><dd><ul>
<li><p>检查文件是否受保护</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-4 读取外部 FIFO 状态失败</dt><dd><ul>
<li><p>检查错误消息日志文件 Pixie16msg.txt</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-5 无法从外部 FIFO 读取数据</dt><dd><ul>
<li><p>检查错误消息日志文件 Pixie16msg.txt</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p><strong>示例代码</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">retval</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">nFIFOWords</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">,</span><span class="w"> </span><span class="n">EndOfRunRead</span><span class="p">;</span><span class="w"></span>
<span class="n">ModNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="c1">// the first module in the system</span>
<span class="n">EndOfRunRead</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="c1">// this is a read during the run</span>

<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16SaveExternalFIFODataToFile</span><span class="p">(</span><span class="s">&quot;listmodedata_mod0.bin&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">nFIFOWords</span><span class="p">,</span><span class="w"> </span><span class="n">ModNum</span><span class="p">,</span><span class="w"> </span><span class="n">EndOfRunRead</span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// Error handling</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="pixie16savehistogramtofile">
<h3>Pixie16SaveHistogramToFile<a class="headerlink" href="#pixie16savehistogramtofile" title="永久链接至标题">¶</a></h3>
<p>从模块读取直方图数据并将其保存到文件</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// 使用此功能可从 Pixie-16 模块读取直方图数据并将直方图数据保存到用户指定文件名的文件中：首先，此功能将直方图数据保存到二进制文件，然后将直方图数据保存到带有运行统计数据的 ASCII 文件附加到 ASCII 文件的末尾。现有文件将被覆盖。 ModNum 是从 0 开始计数的模块号。</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">Pixie16SaveHistogramToFile</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">FileName</span><span class="p">,</span><span class="o">//</span><span class="w"> </span><span class="n">histogram</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="p">(</span><span class="n">with</span><span class="w"> </span><span class="n">complete</span><span class="w"> </span><span class="n">path</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">);</span><span class="w"> </span><span class="c1">// module number</span>
</pre></div>
</div>
<p><strong>返回值描述及错误处理方法</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>0 成功</dt><dd><ul>
<li><p>没有</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-1 无效的 Pixie-16 模块编号</dt><dd><ul>
<li><p>使用正确的 ModNum</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-2 无法从模块获取直方图数据</dt><dd><ul>
<li><p>重新启动模块</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-3 分配内存以存储直方图数据失败</dt><dd><ul>
<li><p>关闭其它程序或重新启动计算机</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-4 无法打开直方图数据文件</dt><dd><ul>
<li><p>使用正确的文件名和路径</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-5 无法打开 mca ascii 输出文件</dt><dd><ul>
<li><p>使用正确的文件名和路径</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-6 无法分配用于存储 ASCII 文本文件的直方图数据的内存</dt><dd><ul>
<li><p>关闭其他程序或重新启动计算机</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-7 无法从文件读取直方图数据</dt><dd><ul>
<li><p>检查文件名和路径</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-8 无法从模块读取运行统计数据</dt><dd><ul>
<li><p>重新启动模块</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p><strong>示例代码</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">retval</span><span class="p">;</span><span class="w"></span>
<span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">FileName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;C:</span><span class="se">\\</span><span class="s">XIA</span><span class="se">\\</span><span class="s">Pixie16</span><span class="se">\\</span><span class="s">MCA</span><span class="se">\\</span><span class="s">histogramdata.bin&quot;</span><span class="p">};</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">;</span><span class="w"></span>
<span class="n">ModNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="c1">// the first module</span>

<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16SaveHistogramToFile</span><span class="w"> </span><span class="p">(</span><span class="n">FileName</span><span class="p">,</span><span class="w"> </span><span class="n">ModNum</span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// error handling</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="pixie16setdacs">
<h3>Pixie16SetDACs<a class="headerlink" href="#pixie16setdacs" title="永久链接至标题">¶</a></h3>
<p>编程板载 DAC</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// 使用此功能可以对 Pixie-16 模块的板载数模转换器（DAC）进行重新编程。 在此操作中，DSP 使用来自先前下载的 DSP 参数的数据。 ModNum 是从 0 开始计数的模块号。</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">Pixie16SetDACs</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">);</span><span class="c1">// module number</span>
</pre></div>
</div>
<p><strong>返回值描述及错误处理方法</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>0 成功</dt><dd><ul>
<li><p>没有</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-1 无效的 Pixie-16 模块编号</dt><dd><ul>
<li><p>使用正确的 ModNum</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-2 无法启动 SET_DACS 运行</dt><dd><ul>
<li><p>重新启动模块</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-3 SET_DACS run timed out</dt><dd><ul>
<li><p>重新启动模块</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p><strong>示例代码</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">retval</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">;</span><span class="w"></span>
<span class="n">ModNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="c1">// the first module</span>

<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16SetDACs</span><span class="w"> </span><span class="p">(</span><span class="n">ModNum</span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// error handling</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="pixie16starthistogramrun">
<h3>Pixie16StartHistogramRun<a class="headerlink" href="#pixie16starthistogramrun" title="永久链接至标题">¶</a></h3>
<p>开始 MCA 直方图模式数据采集运行</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// 使用此功能可以开始进行数据采集运行，每个通道一个累积能量直方图。它启动数据采集运行，其中仅保存能量信息，并在每个通道本地对直方图进行直方图处理。</span>
<span class="c1">// 为系统中的每个 Pixie-16 模块调用此函数以初始化每个模块中的运行。当最后一个模块完成初始化后，实际的数据采集将在所有模块中同步开始（需要设置同步参数）。当经过的运行时间超过预设的运行时间时，直方图运行可以自行终止，或者用户可以通过调用Pixie16EndRun 提前终止运行。完成后，最终的直方图和统计数据将可用。</span>
<span class="c1">// 在启动新运行之前，请使用 mode = NEW_RUN（= 1）删除直方图和统计信息。 使用 mode = RESUME_RUN（= 0）恢复较早的运行。</span>
<span class="c1">// ModNum 是从 0 开始计数的模块号。如果 ModNum 设置为小于系统中模块的总数，则只有 ModNum 指定的模块才能启动其直方图。 但是，如果将 ModNum 设置为等于系统中模块的总数，则系统中的所有模块将一起开始运行。</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">Pixie16StartHistogramRun</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">,</span><span class="c1">// module number</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">mode</span><span class="w"> </span><span class="p">);</span><span class="c1">// run mode</span>
</pre></div>
</div>
<p><strong>返回值描述及错误处理方法</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>0 成功</dt><dd><ul>
<li><p>没有</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-1 无效的 Pixie-16 模块编号</dt><dd><ul>
<li><p>使用正确的 ModNum</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-2 无效的 run mode</dt><dd><ul>
<li><p>使用正确的 run mode</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-3 无法开始直方图运行</dt><dd><ul>
<li><p>重新启动模块</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p><strong>示例代码</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">retval</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">mode</span><span class="p">,</span><span class="w"> </span><span class="n">ModNum</span><span class="p">;</span><span class="w"></span>
<span class="kt">double</span><span class="w"> </span><span class="n">preset_run_time</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">ieee_preset_run_time</span><span class="p">;</span><span class="w"></span>

<span class="n">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NEW_RUN</span><span class="p">;</span><span class="c1">// to start a new run</span>
<span class="c1">// Assume there are 5 modules in the system</span>
<span class="n">ModNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span><span class="c1">// start histogram run in all 5 modules</span>

<span class="c1">// Assume preset run time is 10 seconds</span>
<span class="n">preset_run_time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">10.0</span><span class="p">;</span><span class="w"></span>

<span class="c1">// Convert preset run time to IEEE 32-bit floating point number</span>
<span class="n">ieee_preset_run_time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Decimal2IEEEFloating</span><span class="w"> </span><span class="p">(</span><span class="n">preset_run_time</span><span class="p">);</span><span class="w"></span>

<span class="c1">// Download the preset run time to the DSP</span>
<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16WriteSglModPar</span><span class="p">(</span><span class="s">&quot;HOST_RT_PRESET&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ieee_preset_run_time</span><span class="p">,</span><span class="w"> </span><span class="n">ModNum</span><span class="p">)</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// Error handling</span>
<span class="p">}</span><span class="w"></span>

<span class="c1">// Start the histogram run</span>
<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16StartHistogramRun</span><span class="w"> </span><span class="p">(</span><span class="n">ModNum</span><span class="p">,</span><span class="w"> </span><span class="n">mode</span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// Error handling</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="pixie16startlistmoderun">
<h3>Pixie16StartListModeRun<a class="headerlink" href="#pixie16startlistmoderun" title="永久链接至标题">¶</a></h3>
<p>开始列表模式数据采集运行</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// 使用此功能可启动在 Pixie-16 模块中运行的列表模式数据采集。列表模式运行用于逐事件收集数据，收集每个事件的能量，时间戳，脉冲形状分析值和波形。运行将一直持续到用户通过调用函数 Pixie16EndRun 终止运行为止。要开始数据采集，必须为系统中的每个 Pixie-16 模块调用此功能。如果所有模块都将同步运行，则最后寻址的模块将释放所有其它模块，然后开始采集。如果已在所有其它模块中设置了运行同步，则第一个结束运行的模块将立即停止所有其他模块中的运行。</span>
<span class="c1">// 在启动新运行之前，请使用 mode = NEW_RUN（= 1）删除直方图和统计信息。请注意，这将导致最多 1 毫秒的启动延迟。使用 mode = RESUME_RUN（= 0）恢复较早的运行。此模式的启动延迟仅为几微秒。</span>
<span class="c1">// 仅支持一种列表模式运行类型，即 0x100。 但是，可以通过启用或禁用不同的 CHANCSRA 位来选择不同的输出数据选项。</span>
<span class="c1">// ModNum 是从 0 开始计数的模块号。如果 ModNum 设置为小于系统中模块的总数，则只有 ModNum 指定的模块才能启动其列表模式运行。但是，如果 ModNum 设置为等于系统中模块的总数，则系统中的所有模块将一起开始运行。</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">Pixie16StartListModeRun</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">,</span><span class="w"> </span><span class="c1">// module number</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">RunType</span><span class="p">,</span><span class="c1">// run type</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">mode</span><span class="w"> </span><span class="p">);</span><span class="w"> </span><span class="c1">// run mode</span>
</pre></div>
</div>
<p><strong>返回值描述及错误处理方法</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>0 Success</dt><dd><ul>
<li><p>None</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-1 Invalid Pixie-16 module number</dt><dd><ul>
<li><p>Correct the ModNum</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-2 Invalid run mode</dt><dd><ul>
<li><p>Correct the run mode</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-3 Failed to start list mode run</dt><dd><ul>
<li><p>Reboot the module</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-4 Invalid run type</dt><dd><ul>
<li><p>Correct RunType</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p><strong>示例代码</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">retval</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">mode</span><span class="p">,</span><span class="w"> </span><span class="n">ModNum</span><span class="p">,</span><span class="w"> </span><span class="n">RunType</span><span class="p">;</span><span class="w"></span>

<span class="n">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NEW_RUN</span><span class="p">;</span><span class="c1">// to start a new run</span>
<span class="n">RunType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x100</span><span class="p">;</span><span class="c1">// general purpose list mode run</span>

<span class="c1">// Assume there are 5 modules in the system</span>
<span class="n">ModNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span><span class="w"></span>

<span class="c1">// start list mode run in all 5 modules</span>
<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16StartListModeRun</span><span class="w"> </span><span class="p">(</span><span class="n">ModNum</span><span class="p">,</span><span class="w"> </span><span class="n">RunType</span><span class="p">,</span><span class="w"> </span><span class="n">mode</span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// Error handling</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="pixie16taufinder">
<h3>Pixie16TauFinder<a class="headerlink" href="#pixie16taufinder" title="永久链接至标题">¶</a></h3>
<p>找出通道输入信号的指数衰减时间</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// 使用此功能可以找到与 Pixie-16 模块的 16 个通道中的每个通道相连的探测器或前置放大器信号的指数衰减时间常数（Tau 值）。 找到的 16 个 Tau 值通过指针 *Tau 返回。 通道的 “-1.0” Tau 值表示该通道的 Tau_Finder 不成功。 ModNum 是从 0 开始计数的模块号。</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">Pixie16TauFinder</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">,</span><span class="c1">// module number</span>
<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">Tau</span><span class="w"> </span><span class="p">);</span><span class="c1">// Tau value</span>
</pre></div>
</div>
<p><strong>返回值描述及错误处理方法</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>0 成功</dt><dd><ul>
<li><p>没有</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-1 无效的 Pixie-16 模块编号</dt><dd><ul>
<li><p>使用正确的 ModNum</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-2 无效的 Pixie-16 通道号</dt><dd><ul>
<li><p>使用正确的 ChanNum</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-3 无法获取 ADC 波形</dt><dd><ul>
<li><p>重新启动模块</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-4 读取 ADC 波形失败</dt><dd><ul>
<li><p>重新启动模块</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-5 找不到足够的脉冲数</dt><dd><ul>
<li><p>增加输入计数率</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p><strong>示例代码</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">retval</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">;</span><span class="w"></span>
<span class="kt">double</span><span class="w"> </span><span class="n">Tau</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span><span class="w"></span>
<span class="n">ModNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="c1">// the first module</span>

<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16TauFinder</span><span class="p">(</span><span class="n">ModNum</span><span class="p">,</span><span class="w"> </span><span class="n">Tau</span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// Error handling</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="pixie16writecsr">
<h3>Pixie16WriteCSR<a class="headerlink" href="#pixie16writecsr" title="永久链接至标题">¶</a></h3>
<p>写入模块中的控制和状态寄存器</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// 使用此功能可将值写入主机控制和状态寄存器（CSR）。该寄存器与 DSP 参数 ModCSRA/B，ChanCSRA/B 无关。它用于控制模块的操作并由主机直接读取。不建议主机直接读取或写入，例如，使用 Pixie16CheckRunStatus 之类的功能来轮询活动位。ModNum是从 0 开始计数的模块号。</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">Pixie16WriteCSR</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">,</span><span class="c1">// module number</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">CSR</span><span class="w"> </span><span class="p">);</span><span class="w">   </span><span class="c1">// CSR value to write</span>
</pre></div>
</div>
<p><strong>返回值描述及错误处理方法</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>0 成功</dt><dd><ul>
<li><p>没有</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-1 无效的 Pixie-16 模块编号</dt><dd><ul>
<li><p>使用正确的 ModNum</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p><strong>示例代码</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">retval</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">CSR</span><span class="p">;</span><span class="w"></span>

<span class="n">ModNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="c1">// the first module</span>
<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16ReadCSR</span><span class="p">(</span><span class="n">ModNum</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">CSR</span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// Error handling</span>
<span class="p">}</span><span class="w"></span>

<span class="n">CSR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">APP32_ClrBit</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">CSR</span><span class="p">);</span><span class="w"></span>
<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16WriteCSR</span><span class="w"> </span><span class="p">(</span><span class="n">ModNum</span><span class="p">,</span><span class="w"> </span><span class="n">CSR</span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// Error handling</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="pixie16writesglchanpar">
<h3>Pixie16WriteSglChanPar<a class="headerlink" href="#pixie16writesglchanpar" title="永久链接至标题">¶</a></h3>
<p>将CHANNEL级别参数写入模块</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// 使用此功能可将通道参数写入 Pixie-16 模块。 ModNum 是从 0 开始计数的模块号。ChanNum 是从 0 开始计数的通道号。</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">Pixie16WriteSglChanPar</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">ChanParName</span><span class="p">,</span><span class="w">       </span><span class="c1">//channel parameter name</span>
<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="n">ChanParData</span><span class="p">,</span><span class="w">      </span><span class="c1">//channel parameter value</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">,</span><span class="w">   </span><span class="c1">//channel number</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ChanNum</span><span class="w"> </span><span class="p">);</span><span class="c1">//module number</span>
</pre></div>
</div>
<p><strong>返回值描述及错误处理方法</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>0 成功</dt><dd><ul>
<li><p>没有</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-1 无效的 Pixie-16 模块编号</dt><dd><ul>
<li><p>使用正确的 ModNum</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-2 无效的 Pixie-16 通道号</dt><dd><ul>
<li><p>使用正确的 ChanNum</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-3 无效的通道参数名称</dt><dd><ul>
<li><p>使用正确的 ChanParName</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-4 编程 Fippi 失败下载通道参数</dt><dd><ul>
<li><p>重新启动模块</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-5 下载通道参数后找不到 BLcut</dt><dd><ul>
<li><p>重新启动模块</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-6 SetDACs 下载通道参数失败</dt><dd><ul>
<li><p>重新启动模块</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p><strong>示例代码</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">retval</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">,</span><span class="w"> </span><span class="n">ChanNum</span><span class="p">;</span><span class="w"></span>
<span class="kt">double</span><span class="w"> </span><span class="n">ChanParData</span><span class="p">;</span><span class="w"></span>
<span class="c1">// Set energy filter rise time to 6.08 us for module 0 channel 0</span>
<span class="n">ModNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="c1">// this is the first module</span>
<span class="n">ChanNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="c1">// the first channel</span>
<span class="n">ChanParData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">6.08</span><span class="p">;</span><span class="w"> </span><span class="c1">// energy filter rise time = 6.08 us</span>

<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16WriteSglChanPar</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;ENERGY_RISETIME&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ChanParData</span><span class="p">,</span><span class="w"> </span><span class="n">ModNum</span><span class="p">,</span><span class="w"> </span><span class="n">ChanNum</span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// Error handling</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="pixie16writesglmodpar">
<h3>Pixie16WriteSglModPar<a class="headerlink" href="#pixie16writesglmodpar" title="永久链接至标题">¶</a></h3>
<p>将MODULE级别参数写入模块</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// 使用此功能可将模块参数写入 Pixie-16 模块。 ModNum 是从 0 开始计数的模块号。</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">Pixie16WriteSglModPar</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">ModParName</span><span class="p">,</span><span class="w">       </span><span class="c1">// module parameter name</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">ModParData</span><span class="p">,</span><span class="c1">// module parameter value</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="w"> </span><span class="p">);</span><span class="c1">// module number</span>
</pre></div>
</div>
<p><strong>返回值描述及错误处理方法</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>0 成功</dt><dd><ul>
<li><p>没有</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-1 无效的 Pixie-16 模块编号</dt><dd><ul>
<li><p>使用正确的 ModNum</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-2 无效的模块参数名称</dt><dd><ul>
<li><p>使用正确的 ModParName</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-3 下载模块参数后无法编程 Fippi</dt><dd><ul>
<li><p>重新启动模块</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-4 下载模块参数后找不到 BLcut</dt><dd><ul>
<li><p>重新启动模块</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p><strong>示例代码</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">retval</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">ModParData</span><span class="p">;</span><span class="w"></span>
<span class="c1">// Set SlowFilterRange in module 0 to 4</span>
<span class="n">ModNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="c1">// this is the first module</span>
<span class="n">ModParData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span><span class="c1">// SlowFilterRange = 4</span>

<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16WriteSglModPar</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;SLOW_FILTER_RANGE&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ModParData</span><span class="p">,</span><span class="w"> </span><span class="n">ModNum</span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// Error handling</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
</section>
<section id="pku-api">
<h2>PKU API<a class="headerlink" href="#pku-api" title="永久链接至标题">¶</a></h2>
<p>Add by Hongyi Wu</p>
<section id="hongyiwupixie16computefastfiltersoffline">
<h3>HongyiWuPixie16ComputeFastFiltersOffline<a class="headerlink" href="#hongyiwupixie16computefastfiltersoffline" title="永久链接至标题">¶</a></h3>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="nf">HongyiWuPixie16ComputeFastFiltersOffline</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="kt">char</span><span class="w">           </span><span class="o">*</span><span class="n">FileName</span><span class="p">,</span><span class="w">          </span><span class="o">//</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="n">mode</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="p">(</span><span class="n">with</span><span class="w"> </span><span class="n">complete</span><span class="w"> </span><span class="n">path</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModuleNumber</span><span class="p">,</span><span class="w">       </span><span class="c1">// the module whose events are to be analyzed</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ChannelNumber</span><span class="p">,</span><span class="w">      </span><span class="c1">// the channel whose events are to be analyzed</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w">   </span><span class="n">FileLocation</span><span class="p">,</span><span class="w">       </span><span class="c1">// the location of the trace in the file</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">RcdTraceLength</span><span class="p">,</span><span class="w">     </span><span class="c1">// recorded trace length</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="o">*</span><span class="n">RcdTrace</span><span class="p">,</span><span class="w">          </span><span class="c1">// recorded trace</span>
<span class="w">      </span><span class="kt">double</span><span class="w">         </span><span class="o">*</span><span class="n">fastfilter</span><span class="p">,</span><span class="w">        </span><span class="c1">// fast filter response, the same scale as the trigger threshold</span>
<span class="w">      </span><span class="kt">double</span><span class="w">         </span><span class="o">*</span><span class="n">cfd</span><span class="p">,</span><span class="w">               </span><span class="c1">// cfd response, the same scale as the CFD threshold</span>
<span class="w">      </span><span class="kt">double</span><span class="w">         </span><span class="o">*</span><span class="n">cfds</span><span class="w"> </span><span class="p">);</span><span class="w">            </span><span class="c1">// cfd response, the same scale as the fast filter</span>
</pre></div>
</div>
</section>
<section id="hongyiwupixie16computeslowfiltersoffline">
<h3>HongyiWuPixie16ComputeSlowFiltersOffline<a class="headerlink" href="#hongyiwupixie16computeslowfiltersoffline" title="永久链接至标题">¶</a></h3>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="nf">HongyiWuPixie16ComputeSlowFiltersOffline</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="kt">char</span><span class="w">           </span><span class="o">*</span><span class="n">FileName</span><span class="p">,</span><span class="w">          </span><span class="o">//</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="n">mode</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="p">(</span><span class="n">with</span><span class="w"> </span><span class="n">complete</span><span class="w"> </span><span class="n">path</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModuleNumber</span><span class="p">,</span><span class="w">       </span><span class="c1">// the module whose events are to be analyzed</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ChannelNumber</span><span class="p">,</span><span class="w">      </span><span class="c1">// the channel whose events are to be analyzed</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w">   </span><span class="n">FileLocation</span><span class="p">,</span><span class="w">       </span><span class="c1">// the location of the trace in the file</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">RcdTraceLength</span><span class="p">,</span><span class="w">     </span><span class="c1">// recorded trace length</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="o">*</span><span class="n">RcdTrace</span><span class="p">,</span><span class="w">          </span><span class="c1">// recorded trace</span>
<span class="w">      </span><span class="kt">double</span><span class="w">         </span><span class="o">*</span><span class="n">slowfilter</span><span class="w"> </span><span class="p">);</span><span class="w">      </span><span class="c1">// slow filter response</span>
</pre></div>
</div>
</section>
<section id="hongyiwupixie16computeslowfiltersofflineaveragebaseline">
<h3>HongyiWuPixie16ComputeSlowFiltersOfflineAverageBaseline<a class="headerlink" href="#hongyiwupixie16computeslowfiltersofflineaveragebaseline" title="永久链接至标题">¶</a></h3>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w">  </span><span class="nf">HongyiWuPixie16ComputeSlowFiltersOfflineAverageBaseline</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="kt">char</span><span class="w">           </span><span class="o">*</span><span class="n">FileName</span><span class="p">,</span><span class="w">          </span><span class="o">//</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="n">mode</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="p">(</span><span class="n">with</span><span class="w"> </span><span class="n">complete</span><span class="w"> </span><span class="n">path</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModuleNumber</span><span class="p">,</span><span class="w">       </span><span class="c1">// the module whose events are to be analyzed</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ChannelNumber</span><span class="p">,</span><span class="w">      </span><span class="c1">// the channel whose events are to be analyzed</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w">   </span><span class="n">FileLocation</span><span class="p">,</span><span class="w">       </span><span class="c1">// the location of the trace in the file</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">RcdTraceLength</span><span class="p">,</span><span class="w">     </span><span class="c1">// recorded trace length</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="o">*</span><span class="n">RcdTrace</span><span class="p">,</span><span class="w">          </span><span class="c1">// recorded trace</span>
<span class="w">      </span><span class="kt">double</span><span class="w">         </span><span class="o">*</span><span class="n">slowfilter</span><span class="p">,</span><span class="w">        </span><span class="c1">// slow filter response</span>
<span class="w">      </span><span class="kt">int</span><span class="w">            </span><span class="n">pointtobl</span><span class="w"> </span><span class="p">);</span><span class="w">        </span><span class="c1">// Average number of estimated waveform baselines</span>
</pre></div>
</div>
</section>
<section id="hongyiwupixie16computeslowfiltersofflineextendbaseline">
<h3>HongyiWuPixie16ComputeSlowFiltersOfflineExtendBaseline<a class="headerlink" href="#hongyiwupixie16computeslowfiltersofflineextendbaseline" title="永久链接至标题">¶</a></h3>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="nf">HongyiWuPixie16ComputeSlowFiltersOfflineExtendBaseline</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="kt">char</span><span class="w">           </span><span class="o">*</span><span class="n">FileName</span><span class="p">,</span><span class="w">          </span><span class="o">//</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="n">mode</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="p">(</span><span class="n">with</span><span class="w"> </span><span class="n">complete</span><span class="w"> </span><span class="n">path</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModuleNumber</span><span class="p">,</span><span class="w">       </span><span class="c1">// the module whose events are to be analyzed</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ChannelNumber</span><span class="p">,</span><span class="w">      </span><span class="c1">// the channel whose events are to be analyzed</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w">   </span><span class="n">FileLocation</span><span class="p">,</span><span class="w">       </span><span class="c1">// the location of the trace in the file</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">RcdTraceLength</span><span class="p">,</span><span class="w">     </span><span class="c1">// recorded trace length</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="o">*</span><span class="n">RcdTrace</span><span class="p">,</span><span class="w">          </span><span class="c1">// recorded trace</span>
<span class="w">      </span><span class="kt">double</span><span class="w">         </span><span class="o">*</span><span class="n">slowfilter</span><span class="p">,</span><span class="w">        </span><span class="c1">// slow filter response</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w">   </span><span class="n">bl</span><span class="p">,</span><span class="w">                 </span><span class="c1">// The baseline calculated in the firmware</span>
<span class="w">      </span><span class="kt">double</span><span class="w">         </span><span class="n">sl</span><span class="p">,</span><span class="w">                 </span><span class="c1">// SL used to calculate the baseline in the firmware</span>
<span class="w">      </span><span class="kt">double</span><span class="w">         </span><span class="n">sg</span><span class="p">,</span><span class="w">                 </span><span class="c1">// SG used to calculate the baseline in the firmware</span>
<span class="w">      </span><span class="kt">double</span><span class="w">         </span><span class="n">tau</span><span class="p">,</span><span class="w">                </span><span class="c1">// TAU used to calculate the baseline in the firmware</span>
<span class="w">      </span><span class="kt">int</span><span class="w">            </span><span class="n">sfr</span><span class="p">,</span><span class="w">                </span><span class="c1">// SlowFilterRange used to calculate the baseline in the firmware</span>
<span class="w">      </span><span class="kt">int</span><span class="w">            </span><span class="n">pointtobl</span><span class="w"> </span><span class="p">);</span><span class="w">        </span><span class="c1">// Average number of estimated waveform baselines</span>
</pre></div>
</div>
</section>
<section id="hongyiwupixie16setofflinevariant">
<h3>HongyiWuPixie16SetOfflineVariant<a class="headerlink" href="#hongyiwupixie16setofflinevariant" title="永久链接至标题">¶</a></h3>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="nf">HongyiWuPixie16SetOfflineVariant</span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">mod</span><span class="p">,</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">variant</span><span class="p">,</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">bits</span><span class="p">,</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">samplerate</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
</section>
</section>
</section>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="PKUCode.html" class="btn btn-neutral float-right" title="PKU Code" accesskey="n" rel="next">下一页 <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="README.html" class="btn btn-neutral float-left" title="开发者指南" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> 上一页</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; 版权所有 2020, Hongyi Wu(吴鸿毅).

    </p>
  </div>
    
    
    
    利用 <a href="https://www.sphinx-doc.org/">Sphinx</a> 构建，使用了 
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">主题</a>
    
    由 <a href="https://readthedocs.org">Read the Docs</a>开发. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>