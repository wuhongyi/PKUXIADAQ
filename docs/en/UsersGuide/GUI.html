

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>GUI &mdash; PKUXIADAQ beta documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/graphviz.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="NOGUI" href="NOGUI.html" />
    <link rel="prev" title="Decode" href="Decode.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> PKUXIADAQ
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../README.html">Introduction</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../INSTALL.html">Installation of Software</a></li>
</ul>
<p class="caption"><span class="caption-text">Users Guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="README.html">Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="Crate.html">Crate</a></li>
<li class="toctree-l1"><a class="reference internal" href="FIRMWARE.html">FIRMWARE</a></li>
<li class="toctree-l1"><a class="reference internal" href="Decode.html">Decode</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">GUI</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#the-main-control-interface">The main control interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="#file">File</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#about">About</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#uv-setup">UV_Setup</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#base-setup">Base Setup</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#interface">Interface</a></li>
<li class="toctree-l4"><a class="reference internal" href="#parameters-introduction">Parameters introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="#important-note">Important note</a></li>
<li class="toctree-l4"><a class="reference internal" href="#baseline-measurements">Baseline measurements</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#trigger-filter">Trigger Filter</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id1">Interface</a></li>
<li class="toctree-l4"><a class="reference internal" href="#digital-filters">Digital Filters</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#energy">Energy</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id2">Interface</a></li>
<li class="toctree-l4"><a class="reference internal" href="#filter-range">Filter Range</a></li>
<li class="toctree-l4"><a class="reference internal" href="#trapezoidal-filtering">Trapezoidal Filtering</a></li>
<li class="toctree-l4"><a class="reference internal" href="#baselines-and-preamp-decay-times">Baselines and Preamp. Decay Times</a></li>
<li class="toctree-l4"><a class="reference internal" href="#pileup-inspection">Pileup Inspection</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#cfd">CFD</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id3">Interface</a></li>
<li class="toctree-l4"><a class="reference internal" href="#mhz-and-250-mhz-modules">100 MHz and 250 MHz modules</a></li>
<li class="toctree-l4"><a class="reference internal" href="#mhz-modules">500 MHz modules</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#qdc">QDC</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id4">Interface</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#decimation">Decimation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id5">Interface</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#copy-pars">Copy Pars</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id6">Interface</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#save2file">Save2File</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id7">Interface</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#expert">Expert</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#module-variables">Module Variables</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id8">Interface</a></li>
<li class="toctree-l4"><a class="reference internal" href="#register-definition">Register definition</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#csra">CSRA</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id9">Interface</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id10">Register definition</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#logic-set">Logic Set</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id11">Interface</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#monitor">Monitor</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#hist-xdt">Hist &amp; XDT</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id12">Interface</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#trace-baseline">Trace &amp; Baseline</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id13">Interface</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#offiline">Offiline</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#initdata">InitData</a></li>
<li class="toctree-l3"><a class="reference internal" href="#adjust-par">Adjust Par</a></li>
<li class="toctree-l3"><a class="reference internal" href="#wave-16">Wave-16</a></li>
<li class="toctree-l3"><a class="reference internal" href="#energy-16">Energy-16</a></li>
<li class="toctree-l3"><a class="reference internal" href="#orig-energy">Orig Energy</a></li>
<li class="toctree-l3"><a class="reference internal" href="#calc-energy">Calc Energy</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ff-cfd-thre">FF/CFD Thre</a></li>
<li class="toctree-l3"><a class="reference internal" href="#energy-ff">Energy-FF</a></li>
<li class="toctree-l3"><a class="reference internal" href="#energy-cfd">Energy-CFD</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id14">QDC</a></li>
<li class="toctree-l3"><a class="reference internal" href="#fft">FFT</a></li>
<li class="toctree-l3"><a class="reference internal" href="#time-diff">Time Diff</a></li>
<li class="toctree-l3"><a class="reference internal" href="#simulation">Simulation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="NOGUI.html">NOGUI</a></li>
<li class="toctree-l1"><a class="reference internal" href="OnlineStattics.html">Online Stattics</a></li>
<li class="toctree-l1"><a class="reference internal" href="MakeEvent.html">MakeEvent</a></li>
<li class="toctree-l1"><a class="reference internal" href="FrontPanel.html">Front Panel</a></li>
<li class="toctree-l1"><a class="reference internal" href="Logic.html">Logic</a></li>
<li class="toctree-l1"><a class="reference internal" href="MultipleModulesSynchronously.html">Multiple Modules Synchronously</a></li>
<li class="toctree-l1"><a class="reference internal" href="UpdateCPLD.html">Update CPLD</a></li>
</ul>
<p class="caption"><span class="caption-text">Applications</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Example/README.html">Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Example/TimeResolution.html">Time Resolution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Example/RecommendedParameters.html">Recommended Parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Example/InBeamGammaCIAE.html">In Beam Gamma</a></li>
</ul>
<p class="caption"><span class="caption-text">Programmers Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../ProgrammersGuide/README.html">Developer’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ProgrammersGuide/XIAAPI.html">XIA API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ProgrammersGuide/PKUCode.html">PKU Code</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">PKUXIADAQ</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>GUI</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/UsersGuide/GUI.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="gui">
<h1>GUI<a class="headerlink" href="#gui" title="Permalink to this headline">¶</a></h1>
<p>After setting the parameter file in the <strong>parset</strong>, enter the GUI directory and execute the following command to pop up the main control interface.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./pku
</pre></div>
</div>
<div class="section" id="the-main-control-interface">
<h2>The main control interface<a class="headerlink" href="#the-main-control-interface" title="Permalink to this headline">¶</a></h2>
<img alt="../_images/mainframe.png" src="../_images/mainframe.png" />
<p>At the top of the main interface are five drop-down columns: File, UV_Setup, Expert, Monitor, and Offiline. The submenu inside is as follows:</p>
<ul class="simple">
<li><dl class="simple">
<dt>File</dt><dd><ul>
<li><p>Exit</p></li>
<li><p>About</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>UV_Setup</dt><dd><ul>
<li><p>Base Setup</p></li>
<li><p>Trigger Filter</p></li>
<li><p>Energy</p></li>
<li><p>CFD</p></li>
<li><p>QDC</p></li>
<li><p>Decimation</p></li>
<li><p>Copy Pars</p></li>
<li><p>Save2File</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Expert</dt><dd><ul>
<li><p>Module Variables</p></li>
<li><p>CSRA</p></li>
<li><p>Logic Set</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Monitor</dt><dd><ul>
<li><p>Hist &amp; XDT</p></li>
<li><p>Trace &amp; Baseline</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Offiline</dt><dd><ul>
<li><p>Adjust Par</p></li>
<li><p>Simulation(Not yet implemented)</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p>After the main interface is open, select the <strong>Online Mode</strong> option. You need to connect to the chassis. All functions (including offline analysis) can be used in this mode. If the <strong>Online Mode</strong> option is not selected, it means that the offline mode is enabled, and the acquired parameters can be set and modified or analyze the acquired waveform.</p>
<p>After selecting or not selecting the <strong>Online Mode</strong> option, press the <strong>Boot</strong> button to start the initialization process and see the status changes in the <em>Information</em> section at the bottom.</p>
<p>After the system is successfully initialized, confirm the file storage path, file name, and file number in the <em>Setup</em> column. If there is any problem, modify it directly. After confirming, press <strong>Complete</strong>.</p>
<p>After confirming the information in the <em>Setup</em> column, the main button <strong>LSRunStart</strong> in the <em>Control</em> column is open. Click this button to get data acquisition open, the button status changes to <strong>LSRunStop</strong>, click the button again, the data acquisition completed, and the <em>Run Num</em> number is automatically added.  Click <strong>LSRunStart</strong> again to open the next run.</p>
<p>Currently, you can adjust and modify the parameters through the submenu in the top drop-down bar before you acquire data. Do not manipulate all options except the <em>Control</em> bar when acquiring data.</p>
<p>The <strong>Online Statistics</strong> option in the <em>Control</em> column is turned on to get the input rate and output rate information for each signal sent to the <em>OnineStatistics</em> program every <strong>3 s</strong>.</p>
<p><strong>Clicking the Update Energy Monitor option once will send the one-dimensional spectrum of each channel in all the internal registers of the modules to the Online Statistics program. Sending this information will cause a certain dead time. Please do not click this option frequently.</strong></p>
<hr class="docutils" />
</div>
<div class="section" id="file">
<h2>File<a class="headerlink" href="#file" title="Permalink to this headline">¶</a></h2>
<p>Here it has no practical use.</p>
<div class="section" id="about">
<h3>About<a class="headerlink" href="#about" title="Permalink to this headline">¶</a></h3>
<img alt="../_images/About.png" src="../_images/About.png" />
<p>The introduction of software developer. The basic operating instructions of the main program will be added later.</p>
<hr class="docutils" />
</div>
</div>
<div class="section" id="uv-setup">
<h2>UV_Setup<a class="headerlink" href="#uv-setup" title="Permalink to this headline">¶</a></h2>
<p>The adjustments in this drop-down column are the basics, and anyone using the Pixie16 acquisition system should be familiar with and master the operating techniques.</p>
<div class="section" id="base-setup">
<h3>Base Setup<a class="headerlink" href="#base-setup" title="Permalink to this headline">¶</a></h3>
<div class="section" id="interface">
<h4>Interface<a class="headerlink" href="#interface" title="Permalink to this headline">¶</a></h4>
<img alt="../_images/BaseSetup.png" src="../_images/BaseSetup.png" />
<p>The status below the interface shows a <strong>green Ready</strong> to indicate that the interface can be operated, otherwise you need to wait.</p>
<p>In the interface, the parameters behind the <strong>Module</strong> are used to select the adjusted module, <strong>Load</strong> is used to read the parameter value of the modules, and <strong>Apply</strong> is to write the value in the interface to the module.</p>
<p>The parameter following the <strong>Select Channel</strong> at the bottom of the interface indicates that you can choose to copy the parameters of the channel on the interface to other channels, click <strong>Copy</strong> to complete the copy, and then <strong>Apply</strong> to write the parameters to the module.</p>
<p>The <strong>Base Setup</strong> page controls the analog gain, offset and polarity for each channel. It is useful to click on <strong>Trace &amp; Baseline</strong> in the top control <strong>Monitor</strong> bar to view the signal read from the ADCs while adjusting these parameters. The display shows one or all 16 channels of a module; you can set the sampling interval for each block to capture a longer time frame in <strong>Hist &amp; XDT</strong> page. Click <strong>Draw</strong> to update the graph.</p>
<p>Pulses from the detector should fall in the range from 0 to 16383(14 bit), with the baseline at ~1638 to allow for drifts and/or undershoots and no clipping at the upper limit. If there is clipping, adjust the Gain and Offset or click on the <em>AdjustOffset</em> button to let the software set the DC offsets to proper levels.</p>
<p>Since the trigger/filter circuits in the FPGA only act on rising pulses, negative pulses are inverted at the input of the FPGA, and the waveforms shown in the ADC trace display include this optional inversion. Thus set the channel’s Polarity such that pulses from the detector appear with positive amplitude (rising edge).</p>
<p>In the <strong>Base Setup</strong>  tab, you can set the total trace length and the pre-trigger trace delay for the waveforms to be acquired in list mode runs.</p>
<p>The trace delay cannot be longer than the trace length, and for each Pixie-16 variant, there is also a limit for the maximum value of trace delay and trace length.</p>
</div>
<div class="section" id="parameters-introduction">
<h4>Parameters introduction<a class="headerlink" href="#parameters-introduction" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>The option <em>Gain</em> indicates the gain adjustment. The user can select the <em>Larger</em> or <em>Small</em>. The gain parameters corresponding to the two files of each module can be tested by the user or be chosen by consulting the manufacturer.</p></li>
<li><p>The option <em>Sign</em> indicates the polarity of the selected input signal. The positive signal selects “+” and the negative signal selects “-“.</p></li>
<li><p>The option <em>GC</em> indicates whether the channel is data recorded. If it is checked, it means that the channel is recorded. If it is not checked, it means that it is not recorded.</p></li>
<li><p>The option <em>ECT</em> means to enable CFD trigger. Otherwise, regular trapezoidal fast trigger will be used.</p></li>
</ul>
<p>The red <em>TC</em>, <em>EQS</em>, <em>ERB</em> are used to select which raw data to output:</p>
<ul class="simple">
<li><p>The option <em>TC</em> indicates the recording waveform. At this time, <em>TraceDelay</em> and <em>TraceLength</em> are valid. If not selected, the waveform is not recorded.</p></li>
<li><p>The option <em>EQS</em> means that the scores of the eight QDCs are recorded, and if they are not selected, they are not recorded.</p></li>
<li><p>The option <em>ERB</em> represents the three-part area integral of the energy trapezoid(raw energy sums) and the baseline value of the trapezoidal calculation.</p></li>
</ul>
<p>The green <em>TraceDelay</em> and <em>TraceLength</em> are the points of the output data. The parameter is divided by the nominal sampling rate of the acquisition card to calculate the actual output data points of the waveform:</p>
<ul class="simple">
<li><p><em>TraceDelay</em> indicates the length of the acquired waveform before the trigger.</p></li>
<li><p><em>TraceLength</em> represents the entire waveform acquisition length.</p></li>
</ul>
<p>It should be specially noted that when using the down frequency mode, the actual waveform length is TraceDelay x 2^N / TraceLength x 2^N (N is the down-frequency parameter).</p>
<p>The blue <em>Baseline</em> is used to adjust the baseline position and adjust the baseline to the user’s expected position by voltage compensation:</p>
<ul class="simple">
<li><p>The <em>Baseline</em> adjustable range is 0 - 100, which indicates the percentage of the waveform’s baseline that falls within the full scale. For example, for a vertical precision 14-bit capture card, setting this parameter to 10 means that the baseline reduction compensation is adjusted to around 10% of the 16384 full-scale, near 1638.</p></li>
<li><p>The purple <em>DCOffset</em> and <em>BLcut</em> users do not need to be modified, and the parameters can be adjusted automatically. After modifying <em>Baseline</em>, <em>Gain</em>, and <em>Sign</em> in this submenu, you need to press the bottom of the <em>AdjustOffset</em>, and then press <em>BLcutFinder</em> to automatically adjust these two parameters.</p></li>
</ul>
</div>
<div class="section" id="important-note">
<h4>Important note<a class="headerlink" href="#important-note" title="Permalink to this headline">¶</a></h4>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>trace length in 500 MHz</strong></p>
<p>For the 500 MHz Pixie-16 modules, the ADCs are running at 500 MHz, but the traces are recorded with 100 MHz clocks in the FPGA with 5 ADC samples captured in each 10 ns interval. In addition, the data packing from the FPGA to the onboard External FIFO is two sets of 5 ADC samples in one transfer. So the trace length should be multiples of 20 ns, i.e., 20 ns, 40 ns, … for instance, a trace length of 500 ns and a trace delay of 200 ns.</p>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p><strong>Good channel</strong></p>
<p>Only channels marked as good will have their events recorded.</p>
<p>This setting has no bearing on the channel’s capability to issue a trigger.</p>
<p>There can be a triggering channel whose data are discarded.</p>
<p>Channels not marked as good will be excluded from the automatic offset adjustment.</p>
</div>
</div>
<div class="section" id="baseline-measurements">
<h4>Baseline measurements<a class="headerlink" href="#baseline-measurements" title="Permalink to this headline">¶</a></h4>
<p>The Pixie-16 constantly takes baseline measurements when no pulse is detected and keeps a baseline average to be subtracted from the energy filter output during pulse height reconstruction. Baseline measurements that differ from the average by more than the BaselineCut value will be rejected as they are likely contaminated with small pulses below the trigger threshold.</p>
<p>A series of baseline measurements for each channel can be viewed in <strong>Trace &amp; Baseline</strong> page, and in the BASELINE panel a histogram of baselines can be built to verify that the Baseline Cut does not reject measurements falling into the main (ideally Gaussian) peak in the baseline distribution.</p>
<p>Usually, it is sufficient to keep Baseline Cut at its default value.</p>
<p>Note: Since the baseline computation takes into account the exponential decay, no pulses should be noticeable in the baseline display if</p>
<ul class="simple">
<li><ol class="loweralpha simple">
<li><p>the decay time is set correctly and</p></li>
</ol>
</li>
<li><ol class="loweralpha simple" start="2">
<li><p>the detector pulses are truly exponential.</p></li>
</ol>
</li>
</ul>
<p>Baseline Percent is a parameter used for automatic offset adjustment; by clicking on the <em>AdjustOffses</em> button, offsets will be set such that the baseline seen in the ADC trace display falls at the Baseline Percent fraction of the full ADC range (e.g. for a 12-bit ADC and Baseline Percent = 10% the baseline falls at ADC step 409 out of 4096 total).</p>
</div>
</div>
<hr class="docutils" />
<div class="section" id="trigger-filter">
<h3>Trigger Filter<a class="headerlink" href="#trigger-filter" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id1">
<h4>Interface<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h4>
<img alt="../_images/TriggerFilter.png" src="../_images/TriggerFilter.png" />
<p>When the status below the interface is displaying <strong>green Ready</strong>, it means that the interface can be operated, otherwise you need to wait. The operation of the bottom button is the same as above.</p>
<ul class="simple">
<li><p>The parameter <em>Rise Time</em> mean trigger filter rise time.</p></li>
<li><p>The parameter <em>Flat Top</em> mean trigger filter flat top time.</p></li>
<li><p>The parameter <em>Thresh.</em> represents the threshold, which is set relative to the fast filter waveform.</p></li>
</ul>
<p>General rules of thumb for the following important parameters are:</p>
<ul class="simple">
<li><p>A longer trigger filter rise time averages more samples and thus allows setting lower thresholds without triggering on noise.</p></li>
<li><p>Typically the threshold should be set as low as possible, just above the noise level.</p></li>
<li><p>A longer trigger filter flat top time makes it easier to detect slow rising pulses.</p></li>
</ul>
</div>
<div class="section" id="digital-filters">
<h4>Digital Filters<a class="headerlink" href="#digital-filters" title="Permalink to this headline">¶</a></h4>
<p>Energy dispersive detectors, which include such solid state detectors as Si(Li), HPGe, HgI2 , CdTe and CZT detectors, are generally operated with charge sensitive preamplifiers as shown in Figure. Here the detector <strong>D</strong> is biased by voltage source <strong>V</strong> and connected to the input of <strong>preamplifier A</strong> which has feedback capacitor <strong>Cf</strong> and feedback resistor <strong>Rf</strong> .</p>
<img alt="../_images/chargesenitivepreamplifierrcfeedbackoutputonabsorptionofagammaray.png" src="../_images/chargesenitivepreamplifierrcfeedbackoutputonabsorptionofagammaray.png" />
<p>Reducing noise in an electrical measurement is accomplished by filtering. Traditional analog filters use combinations of a differentiation stage and multiple integration stages to convert the preamp output steps, such as shown in Figure (b), into either triangular or semi-Gaussian pulses whose amplitudes (with respect to their baselines) are then proportional to <strong>Vx</strong> and thus to the gamma-ray’s energy.</p>
<p>Digital filtering proceeds from a slightly different perspective. Here the signal has been digitized and is no longer continuous. Instead it is a string of discrete values as shown in Figure. Figure is actually just a subset of Figure (b), in which the signal was digitized by a Tektronix 544 TDS digital oscilloscope at 10 MSPS (mega samples per second). Given this data set, and some kind of arithmetic processor, the obvious approach to determining Vx is to take some sort of average over the points before the step and subtract it from the value of the average over the points after the step. That is, as shown in follow Figure, averages are computed over the two regions marked “Length” (the “Gap” region is omitted because the signal is changing rapidly here), and their difference taken as a measure of <strong>Vx</strong> . Thus the value Vx may be found from the following equation:</p>
<div class="math notranslate nohighlight">
\[V_{x,k}=-\sum_{i(before)}W_{i}V_{i}+\sum_{i(after)}W_{i}V_{i}\]</div>
<p>Where the values of the weighting constants <strong>Wi</strong> determine the type of average being computed. The sums of the values of the two sets of weights must be individually normalized.</p>
<p><strong>The primary differences between different digital signal processors lie in two areas: what set of weights Wi is used and how the regions are selected for the computation of Equation.</strong></p>
<p>Thus, for example, when larger weighting values are used for the region close to the step while smaller values are used for the data away from the step, Equation  produces “cusp-like” filters. When the weighting values are constant, one obtains triangular (if the gap is zero) or trapezoidal filters. The concept behind cusp-like filters is that, since the points nearest the step carry the most information about its height, they should be most strongly weighted in the averaging process. How one chooses the filter lengths results in time variant (the lengths vary from pulse to pulse) or time invariant (the lengths are the same for all pulses) filters. Traditional analog filters are time invariant. The concept behind time variant filters is that, since the gamma-rays arrive randomly and the lengths between them vary accordingly, one can make maximum use of the available information by setting the length to the interpulse spacing.</p>
<p>In principle, the very best filtering is accomplished by using cusp-like weights and time variant filter length selection. There are serious costs associated with this approach however, both in terms of computational power required to evaluate the sums in real time and in the complexity of the electronics required to generate (usually from stored coefficients) normalized <strong>Wi</strong> sets on a pulse by pulse basis.</p>
<img alt="../_images/digitizedversionofthedataoffigurebinthestepregion.png" src="../_images/digitizedversionofthedataoffigurebinthestepregion.png" />
<p><strong>The Pixie-16 takes a different approach because it was optimized for high speed operation.</strong></p>
<p>It implements a fixed length filter with all <strong>Wi</strong> values equal to unity and in fact computes this sum afresh for each new signal value k. Thus the equation implemented is:</p>
<div class="math notranslate nohighlight">
\[LV_{x,k}=-\sum_{i=k-2L-G+1}^{k-L-G}V_{i}+\sum_{i=k-L+1}^{k}V_{i}\]</div>
<p>Where the filter length is <strong>L</strong> and the gap is <strong>G</strong>. The factor <strong>L</strong> multiplying <span class="math notranslate nohighlight">\(V_{x,k}\)</span> arises because the sum of the weights here is not normalized. Accommodating this factor is trivial.</p>
<p>While this relationship is very simple, it is still very effective. In the first place, this is the digital equivalent of triangular (or trapezoidal if G ≠ 0) filtering which is the analog industry’s standard for high rate processing. In the second place, one can show theoretically that if the noise in the signal is white (i.e., Gaussian distributed) above and below the step, which is typically the case for the short shaping times used for high signal rate processing, then the average in Equation actually gives the best estimate of <strong>Vx</strong> in the least squares sense. This, of course, is why triangular filtering has been preferred at high rates.</p>
<p>Triangular filtering with time variant filter lengths can, in principle, achieve both somewhat superior resolution and higher throughputs but comes at the cost of a significantly more complex circuit and a rate dependent resolution, which is unacceptable for many types of precise analysis. In practice, XIA’s design has been found to duplicate the energy resolution of the best analog shapers while approximately doubling their throughput, providing experimental confirmation of the validity of the approach.</p>
</div>
</div>
<hr class="docutils" />
<div class="section" id="energy">
<h3>Energy<a class="headerlink" href="#energy" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id2">
<h4>Interface<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h4>
<img alt="../_images/Energy.png" src="../_images/Energy.png" />
<p>When the status below the interface is displaying <strong>green Ready</strong>, it means that the interface can be operated, otherwise you need to wait. The operation of the bottom button is the same as above.</p>
<ul class="simple">
<li><p>The parameter Rise Time, please refer to <em>Trapezoidal Filtering</em></p></li>
<li><p>The parameter Flat Top, please refer to <em>Trapezoidal Filtering</em></p></li>
<li><p>The parameter Tau, please refer to <em>Baselines and Preamp. Decay Times</em></p></li>
<li><p>The parameter filter range, please refer to <em>Filter Range</em></p></li>
</ul>
<p>The most critical parameter for the energy computation is the signal decay time Tau. It is used to compensate for the falling edge of a previous pulse in the computation of the energy. You can either enter Tau directly for each channel, or enter an approximate value in the right control, select a channel, and click Find it to let the software determine the decay time automatically.</p>
<p>Click Accept it to apply the found value to the channel. (If the approximate value is unchanged,the software could not find a better value.)</p>
<p>At high count rates, pulses overlap with each other at higher frequency. In order to compute the energy or pulse height of those pulses accurately without the need to wait until they decay back to baseline level completely, the pulse height computation algorithm implemented in the Pixie-16 uses the decay time to compute and remove the contribution from the exponentially decaying tail of the overlapping prior pulse when computing the pulse height of the current pulse.</p>
<div class="admonition danger">
<p class="admonition-title">Danger</p>
<p><strong>single exponential decay constant</strong></p>
<p>It is assumed the pulses have only a single exponential decay constant. If pulses have multiple decay constants, it might be possible to use the decay constant that dominates the decay of the pulse, but the accuracy of pulse height computation will be degraded.</p>
</div>
<p>General rules of thumb for the following important parameters are:</p>
<ul class="simple">
<li><p>The energy filter flat top time should be larger than the longest pulse rise time.</p></li>
<li><p>The energy filter rise time can be varied to balance the resolution and throughput.</p></li>
<li><p>In general, energy resolution improves with the increase of energy filter rise time, up to an optimum when longer filters only add more noise into the measurement.</p></li>
<li><p>The energy filter dead time TD is about <span class="math notranslate nohighlight">\(2×(T_{rise}+T_{flat})\)</span>, and the maximum throughput for Poisson statistics is 1/(TD x e). For HPGe detectors, a rise time of 4-6us and a flat top of 1us are usually appropriate.</p></li>
<li><p>Choose the smallest energy filter range that allows setting the optimum energy filter rise time. Larger filter ranges allow longer filter sums, but increase the granularity of possible values for the energy filter rise time and flat top time and increase the jitter of latching the energy filter output relative to the rising edge of the pulse. This is usually only important for very fast pulses.</p></li>
</ul>
</div>
<div class="section" id="filter-range">
<h4>Filter Range<a class="headerlink" href="#filter-range" title="Permalink to this headline">¶</a></h4>
<p>To accommodate a wide range of energy filter rise times from tens of nanoseconds to tens of microseconds, the filters are implemented in the FPGA with different clock decimations(filter ranges). The ADC sampling rate is either 2ns, 4ns, or 10ns depending on the ADC variant that is used, but in higher clock decimations, several ADC samples are averaged before entering the energy filtering logic. In filter range 1, <span class="math notranslate nohighlight">\(2^{1}\)</span> samples are averaged, <span class="math notranslate nohighlight">\(2^{2}\)</span> samples in filter range 2, and so on. Since the sum of rise time and flat top is limited to 127 decimated clock cycles, filter time granularity and filter time are limited to the values listed in Table .</p>
<img alt="../_images/filterclockdecimationsandfiltertimegranularityfor100mhzor500mhz.png" src="../_images/filterclockdecimationsandfiltertimegranularityfor100mhzor500mhz.png" />
<img alt="../_images/filterclockdecimationsandfiltertimegranularityfor250mhz.png" src="../_images/filterclockdecimationsandfiltertimegranularityfor250mhz.png" />
</div>
<div class="section" id="trapezoidal-filtering">
<h4>Trapezoidal Filtering<a class="headerlink" href="#trapezoidal-filtering" title="Permalink to this headline">¶</a></h4>
<p>From this point onward, only trapezoidal filtering will be considered as it is implemented in a Pixie-16 module according to Equation <span class="math notranslate nohighlight">\(LV_{x,k}=-\sum_{i=k-2L-G+1}^{k-L-G}V_{i}+\sum_{i=k-L+1}^{k}V_{i}\)</span>. The result of applying such a filter with Length L=1 us and Gap G=0.4 us to a gamma-ray event is shown in Figure. The filter output is clearly trapezoidal in shape and has a rise time equal to L, a flattop equal to G, and a symmetrical fall time equal to L. The basewidth, which is a first-order measure of the filter’s noise reduction properties, is thus 2L+G.</p>
<img alt="../_images/trapezoidalfilteringofapreamplifierstepwithl1usandg04us.png" src="../_images/trapezoidalfilteringofapreamplifierstepwithl1usandg04us.png" />
<p>This raises several important points in comparing the noise performance of the Pixie-16 module to analog filtering amplifiers.</p>
<ul class="simple">
<li><dl class="simple">
<dt>First, semi-Gaussian filters are usually specified by a shaping time.</dt><dd><ul>
<li><p>Their rise time is typically twice this and their pulses are not symmetric so that the basewidth is about 5.6 times the shaping time or 2.8 times their rise time.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Thus a semi-Gaussian filter typically has a slightly better energy resolution than a triangular filter of the same rise time because it has a longer filtering time.</dt><dd><ul>
<li><p>This is typically accommodated in amplifiers offering both triangular and semi-Gaussian filtering by stretching the triangular rise time a bit, so that the true triangular rise time is typically 1.2 times the selected semi-Gaussian rise time.</p></li>
<li><p>This also leads to an apparent advantage for the analog system when its energy resolution is compared to a digital system with the same nominal rise time.</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p>One important characteristic of a digitally shaped trapezoidal pulse is its extremely sharp termination on completion of the basewidth 2L+G. This may be compared to analog filtered pulses whose tails may persist up to 40% of the rise time, a phenomenon due to the finite bandwidth of the analog filter. As can be seen below, this sharp termination gives the digital filter a definite rate advantage in pileup free throughput.</p>
</div>
<div class="section" id="baselines-and-preamp-decay-times">
<h4>Baselines and Preamp. Decay Times<a class="headerlink" href="#baselines-and-preamp-decay-times" title="Permalink to this headline">¶</a></h4>
<p>Figure shows an event over a longer time interval and how the filter treats the preamplifier noise in regions when no gamma-ray pulses are present.</p>
<img alt="../_images/agammaeventdisplayedoveralongertimeperiodtoshowbaselinenoiseandtheeffectofpreamplifierdecaytime.png" src="../_images/agammaeventdisplayedoveralongertimeperiodtoshowbaselinenoiseandtheeffectofpreamplifierdecaytime.png" />
<p>As may be seen the effect of the filter is both to reduce the amplitude of the fluctuations and reduce their high frequency content. This region is called the baseline because it establishes the reference level from which the gamma-ray peak amplitude <strong>Vx</strong> is to be measured. The fluctuations in the baseline have a standard deviation <span class="math notranslate nohighlight">\(\sigma_e\)</span> which is referred to as the electronic noise of the system, a number which depends on the rise time of the filter used. Riding on top of this noise, the gamma-ray peaks contribute an additional noise term, the Fano noise, which arises from statistical fluctuations in the amount of charge <strong>Qx</strong> produced when the gamma-ray is absorbed in the detector. This Fano noise <span class="math notranslate nohighlight">\(\sigma_f\)</span> adds in quadrature with the electronic noise, so that the total noise <span class="math notranslate nohighlight">\(\sigma_t\)</span> in measuring <strong>Vx</strong> is found from:</p>
<div class="math notranslate nohighlight">
\[\sigma_t=\sqrt{\sigma_{f}^{2}+\sigma_{e}^{2}}\]</div>
<p>The Fano noise is only a property of the detector material. The electronic noise, on the other hand, may have contributions from both the preamplifier and the amplifier. When the preamplifier and amplifier are both well designed and well matched, however, the amplifier’s noise contribution should be essentially negligible. Achieving this in the mixed analog-digital environment of a digital pulse processor is a non-trivial task, however.</p>
<p>With a RC-type preamplifier, the slope of the preamplifier is rarely zero. Every step decays exponentially back to the DC level of the preamplifier. During such a decay, the baselines are obviously not zero. This can be seen in Figure, where the filter output during the exponential decay after the pulse is below the initial level. Note also that the flat top region is sloped downwards.</p>
<p>Using the decay constant <span class="math notranslate nohighlight">\(\tau\)</span>, the baselines can be mapped back to the DC level. This allows precise determination of gamma-ray energies, even if the pulse sits on the falling slope of a previous pulse. The value of  <span class="math notranslate nohighlight">\(\tau\)</span>, being a characteristic of the preamplifier, has to be determined by the user and host software and downloaded to the module.</p>
</div>
<div class="section" id="pileup-inspection">
<h4>Pileup Inspection<a class="headerlink" href="#pileup-inspection" title="Permalink to this headline">¶</a></h4>
<p>As noted above, the goal is to capture a value of <strong>Vx</strong> for each gamma-ray detected and use these values to construct a spectrum.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This process is also significantly different between digital and analog systems.
In the analog system the peak value must be “captured” into an analog storage device, usually a capacitor, and “held” until it is digitized.
Then the digital value is used to update a memory location to build the desired spectrum.
During this analog to digital conversion process the system is dead to other events, which can severely reduce system throughput.
Even single channel analyzer systems introduce significant deadtime at this stage since they must wait some period (typically a few microseconds) to determine whether or not the window condition is satisfied.</p>
<p>Digital systems are much more efficient in this regard, since the values output by the filter are already digital values.
All that is required is to take the filter sums, reconstruct the energy Vx , and add it to the spectrum.
In the Pixie-16, the filter sums are continuously updated in the FPGA, and are captured into event buffers.
Reconstructing the energy and incrementing the spectrum is done by the DSP, so that the FPGA is ready to take new data immediately (unless the buffers are full).
This is a significant source of the enhanced throughput found in digital systems.</p>
</div>
<p>The peak detection and sampling in a Pixie-16 module is handled as indicated in follow Figure. Two trapezoidal filters are implemented, a fast filter and a slow filter. The fast filter is used to detect the arrival of gamma-rays, the slow filter is used for the measurement of <strong>Vx</strong> , with reduced noise at longer filter rise times. The fast filter has a filter length Lf = 0.1us and a gap Gf = 0.1us. The slow filter has Ls = 1.2us and Gs = 0.35us.</p>
<img alt="../_images/peakdetectionandsampling.png" src="../_images/peakdetectionandsampling.png" />
<p>The arrival of the gamma-ray step(in the preamplifier output) is detected by digitally comparing the fast filter output to <strong>THRESHOLD</strong>, a digital constant set by the user. Crossing the threshold starts a delay line to wait <strong>PEAKSAMP</strong> clock cycles to arrive at the appropriate time to sample the value of the slow filter. Because the digital filtering processes are deterministic, <strong>PEAKSAMP</strong> depends only on the values of the fast and slow filter constants.</p>
<p>The slow filter value captured following <strong>PEAKSAMP</strong> is then the slow digital filter’s estimate of <strong>Vx</strong> . Using a delay line allows to stage sampling of multiple pulses even within a <strong>PEAKSAMP</strong> interval (though the filter values themselves are then not correct representations of a single pulse’s height).</p>
<p>The value <strong>Vx</strong> captured will only be a valid measure of the associated gamma-ray’s energy provided that the filtered pulse is sufficiently well separated in time from its preceding and succeeding neighbor pulses so that their peak amplitudes are not distorted by the action of the trapezoidal filter. That is, if the pulse is not piled up. The relevant issues may be understood by reference to Figure, which shows 3 gamma-rays arriving separated by various intervals. The fast filter has a filter length Lf = 0.1us and a gap Gf =0.1us. The slow filter has Ls = 1.2us and Gs = 0.35us.</p>
<img alt="../_images/asequenceof3gammaraypulsesseparatedbyvariousintervalstoshowtheoriginofpileupanddemonstratehowitisdetected.png" src="../_images/asequenceof3gammaraypulsesseparatedbyvariousintervalstoshowtheoriginofpileupanddemonstratehowitisdetected.png" />
<p>Because the trapezoidal filter is a linear filter, its output for a series of pulses is the linear sum of its outputs for the individual members in the series. Pileup occurs when the rising edge of one pulse lies under the peak (specifically the sampling point) of its neighbor. Thus, in Figure , peaks 1 an 2 are sufficiently well separated so that the leading edge of peak 2 falls after the peak of pulse 1. Because the trapezoidal filter function is symmetrical, this also means that pulse 1’s trailing edge also does not fall under the peak of pulse 2. For this to be true, the two pulses must be separated by at least an interval of L+G. Peaks 2 and 3, which are separated by less than 1.0 us, are thus seen to pileup in the present example with a 1.2 us rise time.</p>
<p>This leads to an important point: whether pulses suffer slow pileup depends critically on the rise time of the filter being used. The amount of pileup which occurs at a given average signal rate will increase with longer rise times.</p>
<p>Because the fast filter rise time is only 0.1 us, these gamma-ray pulses do not pileup in the fast filter channel. The Pixie-16 module can therefore test for slow channel pileup by measuring the fast filter for the interval PEAKSEP after a pulse arrival time. If no second pulse occurs in this interval, then there is no trailing edge pileup and the pulse is validated for acquisition. <strong>PEAKSEP</strong> is usually set to a value close to L+G+1. Pulse 1 passes this test, as shown in Figure. Pulse 2, however, fails the <strong>PEAKSEP</strong> test because pulse 3 follows less than 1.0 us. Notice, by the symmetry of the trapezoidal filter, if pulse 2 is rejected because of pulse 3, then pulse 3 is similarly rejected because of pulse 2.</p>
</div>
</div>
<hr class="docutils" />
<div class="section" id="cfd">
<h3>CFD<a class="headerlink" href="#cfd" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id3">
<h4>Interface<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h4>
<img alt="../_images/CFDPars.png" src="../_images/CFDPars.png" />
<p><strong>TODO</strong></p>
</div>
<div class="section" id="mhz-and-250-mhz-modules">
<h4>100 MHz and 250 MHz modules<a class="headerlink" href="#mhz-and-250-mhz-modules" title="Permalink to this headline">¶</a></h4>
<p>The following CFD algorithm is implemented in the signal processing FPGA of the 100 MHz(Rev. B, C, D and F) and 250 MHz(Rev. F) Pixie-16 modules.</p>
<p>Assume the digitized waveform can be represented by data series Trace[i], i = 0, 1, 2, … First the fast filter response(FF) of the digitized waveform is computed as follows:</p>
<div class="math notranslate nohighlight">
\[FF[i]=\sum_{j=i-(FL-1)}^{i}Trace[j]-\sum_{j=i-(2\times FL+FG-1)}^{i-(FL+FG)}Trace[j]\]</div>
<p>Where FL is called the fast length and FG is called the fast gap of the digital trapezoidal filter. Then the CFD is computed as follows:</p>
<div class="math notranslate nohighlight">
\[CFD[i+D]=FF[i+D]\times(1-w/8)-FF[i]\]</div>
<p>Where D is called the CFD delay length and w is called the CFD scaling factor(w=0, 1,…, 7).</p>
<p>The CFD zero crossing point(ZCP) is then determined when <span class="math notranslate nohighlight">\(CFD[i]\leq0\)</span> and <span class="math notranslate nohighlight">\(CFD[i+1]&lt;0\)</span>. The timestamp is latched at Trace point <span class="math notranslate nohighlight">\(i\)</span>, and the fraction time <span class="math notranslate nohighlight">\(f\)</span> is given by the ratio of the two CFD response amplitudes right before and after the ZCP.</p>
<div class="math notranslate nohighlight">
\[f=\frac{CFDout1}{CFDout1-CFDout2}\]</div>
<p>Where CFDout1 is the CFD response amplitude right before the ZCP, and CFDout2 is the CFD response amplitude right after the ZCP(subtraction is used in the denominator since CFDout2 is negative). The Pixie-16 DSP computes the CFD final value as follows and stores it in the output data stream for online or offline analysis.</p>
<div class="math notranslate nohighlight">
\[CFD=\frac{CFDout1}{CFDout1-CFDout2} \times N\]</div>
<p>Where N is scaling factor, which equals to 32768 for 100 MHz modules and 16384 for 250 MHz modules, respectively.</p>
<img alt="../_images/adcsamples_cfd.png" src="../_images/adcsamples_cfd.png" />
<img alt="../_images/fastfilter_cfd.png" src="../_images/fastfilter_cfd.png" />
<img alt="../_images/cfdfilter_cfd.png" src="../_images/cfdfilter_cfd.png" />
<p>Figure shows a sample ADC trace, its fast filter response and its CFD response, respectively.</p>
<p>The top figure shows a raw ADC trace. After computing the fast filter response on the raw ADC trace using Equation <span class="math notranslate nohighlight">\(FF[i]\)</span>, the fast filter response is compared against the fast filter threshold as shown in the middle figure. The ADC sample where the fast filter response crosses the fast filter threshold is called the fast trigger point, which also starts the search for the CFD zero crossing point.</p>
<p>The CFD response is computed using Equation <span class="math notranslate nohighlight">\(CFD[i+D]\)</span> and is shown in the bottom figure(for actual implementation in the firmware, the fast filter response FF is delayed slightly before being used for computing the CFD response so that there are sufficient number of CFD response points to look for the zero crossing point after the fast trigger). To prevent premature CFD trigger as a result of the noise in the CFD response before the actual trigger, a DSP parameter called CFDThresh is used to suppress those noise-caused zero crossing. However, if a zero crossing point cannot be found within a certain period after the fast trigger (typically 32 clock cycles), e.g., due to unnecessarily high CFDThresh, a forced CFD Trigger will be issued and a flag will be set in an event header word to indicate that the recorded CFD time for this event is invalid.</p>
<p>However, the event will still have a valid timestamp which is latched by the fast filter trigger when fast filter crosses over the trigger threshold. The aforementioned CFD parameters correspond to the following DSP parameters.</p>
<img alt="../_images/correspondingdspparametersforthecfdparmeters.png" src="../_images/correspondingdspparametersforthecfdparmeters.png" />
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>250 MHz</strong></p>
<p>In the 250 MHz Pixie-16 modules, the event timestamp is counted with 125 MHz clock ticks, i.e., 8 ns intervals, and two consecutive 250 MHz ADC samples are captured in one 8 ns interval as well.</p>
<p>The CFD trigger also runs at 125 MHz, but the CFD zero crossing point is still reported as a fractional time between two neighboring 250 MHz ADC samples, which are processed by the FPGA in one 125 MHz clock cycle.</p>
<p>However, the CFD zero crossing point could be in either the odd or even clock cycle of the captured 250 MHz ADC waveforms.</p>
<p>Therefore, the firmware outputs a “CFD trigger source” bit in the output data stream to indicate whether the CFD zero crossing point is in the odd or even clock cycle of the captured 250 MHz ADC waveforms.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>100 MHz</strong></p>
<p>In the 100 MHz Pixie-16 modules, event timestamp, CFD trigger, and ADC waveform capture are all carried out with the same 100 MHz clock. So there is no need to report “CFD trigger source” for the 100 MHz Pixie-16 modules.</p>
</div>
</div>
<div class="section" id="mhz-modules">
<h4>500 MHz modules<a class="headerlink" href="#mhz-modules" title="Permalink to this headline">¶</a></h4>
<p>The CFD algorithm discussed in the previous section for the 100 MHz and 250 MHz Pixie-16 modules can also be written in the following format:</p>
<div class="math notranslate nohighlight">
\[CFD(k)=w\cdot\left(\sum_{i=k}^{k+L}a(i)-\sum_{i=k-B}^{k-B+L}a(i)\right)-\left(\sum_{i=k-D}^{k-D+L}a(i)-\sum_{i=k-D-B}^{k-D-B+L}a(i)\right)\]</div>
<p>Where a(i) is the ADC trace data, k is the index, and w, B, D, and L are CFD parameters.</p>
<p>The CFD algorithm implemented in the 500 MHz Pixie-16 modules is special when compared to the one implemented in the 100 MHz and 250 MHz Pixie-16 modules in terms of the ability to adjust parameters w, B, D, and L.</p>
<p>The reason for this is that in the 500 MHz Pixie-16 modules, ADC data that come into the FPGA at the speed of 500 MHz is first slowed down with a ratio of 1:5, in other words, the FPGA captures 5 ADC samples at the rate of 100 MHz, i.e., every 10 ns. The FPGA then tries to find the CFD trigger point between any two adjacent 2-ns ADC samples within that 10 ns by first building sums of ADC samples and then calculating differences between delayed and non-delayed sums until the zero crossing point is found. However, in the 500 MHz Pixie-16 modules, the FPGA does not have enough resources to build sums for 5 ADC samples in parallel with variable delays. Therefore, the CFD algorithm for the 500 MHz modules was implemented using a set of fixed CFD parameters as shown in Table <em>Fixed CFD Parameter Values for 500 MHz Pixie-16 Modules</em>. Tests show these fixed parameters give best performance for LaBr3(Ce) detectors.</p>
<img alt="../_images/fixedcfdparametervaluesfor500mhzpixie16modules.png" src="../_images/fixedcfdparametervaluesfor500mhzpixie16modules.png" />
<p>The CFD time given by the 500 MHz Pixie-16 modules consists of two parts: a shift within the 5 ADC samples and a fractional time between two ADC samples where the CFD zero crossing occurred. The shift within the 5 ADC samples is reported as the 3-bit CFD trigger source[2:0] is defined as follows.</p>
<img alt="../_images/meaningofthecfdtriggersourcefor500mhzpixie16modules.png" src="../_images/meaningofthecfdtriggersourcefor500mhzpixie16modules.png" />
<p>CFD 分数时间如下：</p>
<div class="math notranslate nohighlight">
\[CFD=\frac{CFDout1}{CFDout1-CFDout2}\times8192\]</div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="qdc">
<h3>QDC<a class="headerlink" href="#qdc" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id4">
<h4>Interface<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h4>
<img alt="../_images/QDCPars.png" src="../_images/QDCPars.png" />
<p>Eight QDC sums, each of which can have different lengths, are computed in the Signal Processing FPGA of a Pixie-16 module for each channel and the sums are written to the list mode output data stream if the user requests so.</p>
<p>The recording of QDC sums starts at the waveform point which is <em>Pre-trigger Trace Length</em> or <em>Trace Delay</em> earlier than the trigger point, which is either the CFD trigger or channel fast trigger depending on whether or not CFD trigger mode is enabled.</p>
<p>The eight QDC sums are computed one by one continuously, but they are not overlapping. The recording of QDC sums ends when the eight intervals have all passed.</p>
<img alt="../_images/the8qdcsumsofatriggeredevent.png" src="../_images/the8qdcsumsofatriggeredevent.png" />
</div>
</div>
<hr class="docutils" />
<div class="section" id="decimation">
<h3>Decimation<a class="headerlink" href="#decimation" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id5">
<h4>Interface<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h4>
<img alt="../_images/Decimation.png" src="../_images/Decimation.png" />
<p><strong>。。TODO。。</strong></p>
</div>
</div>
<hr class="docutils" />
<div class="section" id="copy-pars">
<h3>Copy Pars<a class="headerlink" href="#copy-pars" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id6">
<h4>Interface<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h4>
<img alt="../_images/CopyPars.png" src="../_images/CopyPars.png" />
<p><strong>。。TODO。。</strong></p>
</div>
</div>
<hr class="docutils" />
<div class="section" id="save2file">
<h3>Save2File<a class="headerlink" href="#save2file" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id7">
<h4>Interface<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h4>
<img alt="../_images/Save2File.png" src="../_images/Save2File.png" />
<p><strong>。。TODO。。</strong></p>
<hr class="docutils" />
</div>
</div>
</div>
<div class="section" id="expert">
<h2>Expert<a class="headerlink" href="#expert" title="Permalink to this headline">¶</a></h2>
<p>The contents in this drop-down column are high-level, and you need to learn to master the acquisition logic.</p>
<div class="section" id="module-variables">
<h3>Module Variables<a class="headerlink" href="#module-variables" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id8">
<h4>Interface<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h4>
<img alt="../_images/ModuleVariables.png" src="../_images/ModuleVariables.png" />
<p>In addition to distributing the global clock signal, the Pixie-16 rear I/O trigger module can also share global triggers and run synchronization signals. The global trigger signals include the global validation trigger and global fast trigger, plus the Pixie-16 FPGA data storage buffers’ full flag signal. The run synchronization signals include synchronous run start and stop signals that can be shared among multiple crates.</p>
<p>In order to enable the distribution of such global triggers and run synchronization signals, certain Pixie-16 parameters have to be set properly. The parameter that controls the trigger distribution and run synchronization is the Module Control Register B (ModCSRB).</p>
<p>ModCSRB is a 32-bit parameter with each of 32 bits controlling different operation modes of the Pixie-16 module.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>Trigger Distribution and Run Synchronization</strong></p>
<p>For the System Director module that is installed in the Master crate, bits 0, 4, 6 and 11 of ModCSRB should be set to 1 (checked &amp; enabled).</p>
<p>For the Crate Master module that is installed in the Slave crate, bits 0, 6 and 11 of ModCSRB should be set to 1 (checked &amp; enabled).</p>
<p>For the General modules that are installed in both the Slave crate and Master crate, bit 11 of ModCSRB should be set to 1 (checked &amp; enabled).</p>
</div>
</div>
<div class="section" id="register-definition">
<h4>Register definition<a class="headerlink" href="#register-definition" title="Permalink to this headline">¶</a></h4>
<p>Module Control Register B affecting the module as a whole.</p>
<ul class="simple">
<li><dl class="simple">
<dt>bit 0 - MODCSRB_CPLDPULLUP</dt><dd><ul>
<li><p>Enable pullups for PXI trigger lines on the backplane through an onboard CPLD.</p></li>
<li><p>With the pullups, those PXI trigger lines default to logic high state.</p></li>
<li><p>Only when one module actively pulls a line to logic low state will such a line be in the low state.</p></li>
<li><p>Therefore signals transmitted over those PXI trigger lines are actively low signals.</p></li>
<li><p><strong>Note: enable this bit only for one module per crate (e.g. the crate master module)</strong></p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>bit 4 - MODCSRB_DIRMOD</dt><dd><ul>
<li><p>Set this module as the Director module so that it can send triggers, trace and header DPM full signal and run synchronization signal to all crates through the rear I/O trigger modules.</p></li>
<li><p>Here triggers include fast trigger and validation trigger</p></li>
<li><p><strong>Note: enable this bit only for one module among all crates (e.g. the system director module in multi-crate configuration)</strong></p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>bit 6 - MODCSRB_CHASSISMASTER</dt><dd><ul>
<li><p>Set this module as the chassis master module so that it can send triggers, trace and header DPM full signal and run synchronization signal to the backplane of the local crate.</p></li>
<li><p>Here triggers include fast trigger and validation trigger</p></li>
<li><p><strong>Note: enable this bit only for one module per crate(e.g. the crate master module)</strong></p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>bit 7 - MODCSRB_GFTSEL</dt><dd><ul>
<li><p>Select external fast trigger source(=1: external validation trigger, =0: external fast trigger, in case these two signals are swapped at the Pixie-16 front panel input connectors)</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>bit 8 - MODCSRB_ETSEL</dt><dd><ul>
<li><p>Select external validation trigger source(=1: external fast trigger, =0: external validation trigger, in case these two signals are swapped at the Pixie-16 front panel input connectors)</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>bit 10 - MODCSRB_INHIBITENA</dt><dd><ul>
<li><p>Enable(=1) or disable(=0) the use of external INHIBIT signal.</p></li>
<li><p>When enabled, the external INHIBIT signal in the logic high state will prevent the run from starting until this external INHIBIT signal goes to logic low state.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>bit 11 - MODCSRB_MULTCRATES</dt><dd><ul>
<li><p>Set this module to run in the multi-crate mode(=1) or in the local-crate mode(=0).</p></li>
<li><p>If the module is running in multi-crate mode, it will use the trace and header DPM full signal and run synchronization signal that are generated and distributed among multiple crates.</p></li>
<li><p>If the module is running in local-crate mode, it will use the trace and header DPM full signal and run synchronization signal generated in the local crate.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>bit 12 - MODCSRB_SORTEVENTS</dt><dd><ul>
<li><p>Sort(=1) or do not sort(=0) events from all 16 channels of a Pixie-16 module based on the timestamps of the events, before storing the events in the external FIFO.</p></li>
<li><p>Note: all 16 channels must have the same DAQ parameters setting to use this feature</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>bit 13 - MODCSRB_BKPLFASTTRIG</dt><dd><ul>
<li><p>Enable(=1) or disable(=0) the sending of 16 local fast triggers to the 16 lines on the backplane of the crate.</p></li>
<li><p><strong>Note: only one module can enable this option in each PCI bus segment of a crate(not limited to the crate master module, e.g. any module in each PCI bus segment)</strong></p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
</div>
<hr class="docutils" />
<div class="section" id="csra">
<h3>CSRA<a class="headerlink" href="#csra" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id9">
<h4>Interface<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h4>
<img alt="../_images/CSRA.png" src="../_images/CSRA.png" />
<ul class="simple">
<li><dl class="simple">
<dt>The yellow FTS and GTS combinations are used to select the channel fast trigger:</dt><dd><ul>
<li><p>When both are not selected, it is local fast trigger.</p></li>
<li><p>When selecting FTS, it is a latched module fast trigger.</p></li>
<li><p>FTS is not selected, GTS is selected as a latched channel validation trigger.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Blue MSE, CSE, MVT, CVT are used to select module/channel validation trigger:</dt><dd><ul>
<li><p>MVT is the module validation trigger.</p></li>
<li><p>CVT is the channel validation trigger.</p></li>
<li><p>MSE select module validation trigger depends on System FPGA or front panel module GATE.</p></li>
<li><p>CSE selection channel validation trigger depends on System FPGA or front panel channel GATE.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>The pink NPR, IPR combination is used to select the treatment of the pileup event:</dt><dd><ul>
<li><p>All events are logged when both are not selected, and the accumulated event energy value is invalid.</p></li>
<li><p>NPR selection does not record stacking events when IPR is not selected.</p></li>
<li><p>When the NPR is not selected, the event record waveform is accumulated, and the waveform is not recorded when it is not stacked.</p></li>
<li><p>When both NPR and IPR are selected, only the stacked events are recorded.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Green CTV, CVS, MVS are used to select module/channel veto:</dt><dd><ul>
<li><p>MVS select module veto depending on the front panel module GATE or module validation trigger.</p></li>
<li><p>CVS select channel veto depending on the front panel channel GATE or channel validation trigger.</p></li>
<li><p>CTV is whether to enable channel trigger veto.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>The Red contents are the basic settings.</dt><dd><ul>
<li><p>Black NTL is to keep the waveform out of range.</p></li>
<li><p>Black ETS is to record the data of the external clock.</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>The remaining BDA does not need to be selected, HE does not matter.</p></li>
</ul>
</div>
<div class="section" id="id10">
<h4>Register definition<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h4>
<p>Channel Control Register A affecting each channel individually</p>
<ul class="simple">
<li><dl class="simple">
<dt>bit 0 - CCSRA_FTRIGSEL</dt><dd><ul>
<li><p>Channel fast trigger selection(=1: module fast trigger from the System FPGA; =0: the selection depends on the value of another bit CCSRA_GROUPTRIGSEL – if CCSRA_GROUPTRIGSEL = 1, select the channel validation trigger from the System FPGA, and if CCSRA_GROUPTRIGSEL = 0, select this channel’s local fast trigger)</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>bit 1 - CCSRA_EXTTRIGSEL</dt><dd><ul>
<li><p>Module validation trigger selection(=1: module gate input from the Pixie-16 front panel Module Gate LVDS connector; =0: module validation trigger from the System FPGA)</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>bit 2 - CCSRA_GOOD</dt><dd><ul>
<li><p>Set this channel as a Good channel(=1) or a not Good channel(=0).</p></li>
<li><p><strong>When a channel is set to be a not Good channel, it still generates local fast triggers, which could be used in multiplicity computation, etc., but this channel will not record list mode data or MCA data, and will not update its baseline value</strong></p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>bit 3 - CCSRA_CHANTRIGSEL</dt><dd><ul>
<li><p>Channel validation signal selection(=1: channel gate input from the Pixie-16 front panel Channel Gate LVDS connector; =0:channel validation trigger from the System FPGA)</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>bit 4 - CCSRA_SYNCDATAACQ</dt><dd><ul>
<li><p>Choose the level of synchronous data acquisition for this channel(=1: stops taking data when the trace or header DPM for any channel of any Pixie-16 module in the system is full; =0: stops taking data only when the trace or header DPM for this channel of this Pixie-16 module is full)</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>bit 5 - CCSRA_POLARITY</dt><dd><ul>
<li><p>Choose this channel’s input signal polarity(=1: invert input signal’s polarity; =0: do not invert input signal’s polarity).</p></li>
<li><p><strong>Please note in Pixie-16, signal processing requires positive rising input signal. So if input signal has a negative falling edge, it should be inverted by setting this CCSRA_POLARITY bit to 1</strong></p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>bit 6 - CCSRA_VETOENA</dt><dd><ul>
<li><p>Enable(=1) or disable(=0) this channel’s veto.</p></li>
<li><p>If veto is enabled, this channel’s fast trigger will be vetoed by either the module veto signal(see bit 20 CCSRA_MODVETOSEL below) or channel veto signal(see bit 19 CCSRA_CHANVETOSEL below).</p></li>
<li><p>But if veto is disabled, this channel’s fast trigger will not be vetoed by either veto signal, even if either veto signal is present</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>bit 7 - CCSRA_HISTOE</dt><dd><ul>
<li><p>Enable(=1) or disable(=0) the histogramming of pulse energy values in the onboard MCA memory.</p></li>
<li><p>However, the current Pixie-16 firmware always histograms pulse energy values in the onboard MCA memory.</p></li>
<li><p>So this CCSRA_HISTOE is essentially not in use at the moment</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>bit 8 - CCSRA_TRACEENA</dt><dd><ul>
<li><p>Enable(=1) or disable(=0) trace capture in the list mode run for this channel</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>bit 9 - CCSRA_QDCENA</dt><dd><ul>
<li><p>Enable(=1) or disable(=0) QDC sums recording in the list mode run for this channel.</p></li>
<li><p>There are a total of 8 QDC sums for each event</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>bit 10 - CCSRA_CFDMODE</dt><dd><ul>
<li><p>Enable(=1) or disable(=0) CFD trigger in the list mode run for this channel.</p></li>
<li><p>CFD trigger is used to latch sub-sample timing for the event time of arrival or timestamp</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>bit 11 - CCSRA_GLOBTRIG</dt><dd><ul>
<li><p>Enable(=1) or disable(=0) the requirement of module validation trigger for this channel.</p></li>
<li><p>If enabled, only when module validation trigger overlaps the channel fast trigger will the events be recorded for this channel</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>bit 12 - CCSRA_ESUMSENA</dt><dd><ul>
<li><p>Enable(=1) or disable(=0) the recording of raw energy sums and baseline values in the list mode run for this channel.</p></li>
<li><p>There are a total of three raw energy sums and one baseline value for each event.</p></li>
<li><p><strong>Please note the baseline value is stored in the format of 32-bit IEEE float point(IEEE 754)</strong></p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>bit 13 - CCSRA_CHANTRIG</dt><dd><ul>
<li><p>Enable(=1) or disable(=0) the requirement of channel validation trigger for this channel.</p></li>
<li><p>If enabled, only when channel validation trigger overlaps the channel fast trigger will the events be recorded for this channel</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>bit 14 - CCSRA_ENARELAY</dt><dd><ul>
<li><p>Switch between two attenuations or gains for the input signal in this channel through an input relay(=1: close the input relay resulting in no input signal attenuation; =0: open the input relay resulting in a 1⁄4 input signal attenuation)</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>bit 15/16 - CCSRA_PILEUPCTRL/CCSRA_INVERSEPILEUP</dt><dd><ul>
<li><p>Control normal pileup rejection(bit 15) and inverse pileup rejection(bit 16) for list mode runs:</p></li>
<li><ol class="arabic simple">
<li><p>Bits [16:15] = 00, record all events</p></li>
</ol>
</li>
<li><ol class="arabic simple" start="2">
<li><p>Bits [16:15] = 01, only record single events, i.e., reject piled up events</p></li>
</ol>
</li>
<li><ol class="arabic simple" start="3">
<li><p>Bits [16:15] = 10, record everything for piled up events, but will not record trace for single events even if trace recording is enabled, i.e., only record event header</p></li>
</ol>
</li>
<li><ol class="arabic simple" start="4">
<li><p>Bits [16:15] = 11, only record piled up events, i.e., reject single events</p></li>
</ol>
</li>
<li><p>In all cases, if the event is piled up, no energy will be computed for such event</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>bit 17 - CCSRA_ENAENERGYCUT</dt><dd><ul>
<li><p>Enable(=1) or disable(=0) the “no traces for large pulses” feature.</p></li>
<li><p>If enabled, trace will be not be recorded if the event energy is larger than the value set in DSP parameter EnergyLow</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>bit 18 - CCSRA_GROUPTRIGSEL</dt><dd><ul>
<li><p>Select channel fast trigger – this bit works together with the CCSRA_FTRIGSEL bit(bit 0): if CCSRA_FTRIGSEL=1, this CCSRA_GROUPTRIGSEL bit has no effect; if CCSRA_FTRIGSEL=0, then if CCSRA_GROUPTRIGSEL=1, select the channel validation trigger from the System FPGA, and if CCSRA_GROUPTRIGSEL=0, select this channel’s local fast trigger</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>bit 19 - CCSRA_CHANVETOSEL</dt><dd><ul>
<li><p>Channel veto signal selection(=1: channel validation trigger from the System FPGA; =0: channel gate input from the Pixie-16 front panel Channel Gate LVDS connector)</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>bit 20 - CCSRA_MODVETOSEL</dt><dd><ul>
<li><p>Module veto signal selection(=1: module validation trigger from the System FPGA; =0: module gate input from the Pixie-16 front panel Module Gate LVDS connector)</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>bit 21 - CCSRA_EXTTSENA</dt><dd><ul>
<li><p>Enable(=1) or disable(=0) the recording of the 48-bit external clock timestamp in the event header during list mode run for this channel</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
</div>
<hr class="docutils" />
<div class="section" id="logic-set">
<h3>Logic Set<a class="headerlink" href="#logic-set" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id11">
<h4>Interface<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h4>
<img alt="../_images/LogicTrigger.png" src="../_images/LogicTrigger.png" />
<p><strong>TODO</strong></p>
<img alt="../_images/stretchlength.PNG" src="../_images/stretchlength.PNG" />
<hr class="docutils" />
</div>
</div>
</div>
<div class="section" id="monitor">
<h2>Monitor<a class="headerlink" href="#monitor" title="Permalink to this headline">¶</a></h2>
<p>The adjustment in this drop-down column is to monitor the waveform noise level, baseline distribution, and so on.</p>
<div class="section" id="hist-xdt">
<h3>Hist &amp; XDT<a class="headerlink" href="#hist-xdt" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id12">
<h4>Interface<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h4>
<img alt="../_images/HistXDT.png" src="../_images/HistXDT.png" />
<p>The binning factor controls the number of MCA bins in the spectrum. Energies are computed as 16 bit numbers, allowing in principle 64K MCA bins.</p>
<p>However, spectrum memory for each channel is limited to 32K bins, so computed energy values are divided by <span class="math notranslate nohighlight">\(2^{binning factor}\)</span> before building the histogram. Binning Factor is usually set to 1, but for low count rates and wide peaks, it might be useful to set it to a larger value to obtain a spectrum with fewer bins, but more counts per bin.</p>
<p><span class="math notranslate nohighlight">\(E_{min}\)</span> is reserved for a future function to subtract a constant “minimum energy” from the computed energy value before binning to essentially cut off the lower end of the spectrum.</p>
</div>
</div>
<hr class="docutils" />
<div class="section" id="trace-baseline">
<h3>Trace &amp; Baseline<a class="headerlink" href="#trace-baseline" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id13">
<h4>Interface<a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h4>
<img alt="../_images/Trace.png" src="../_images/Trace.png" />
<img alt="../_images/BaselineHist.png" src="../_images/BaselineHist.png" />
<img alt="../_images/BaselineTimestamps.png" src="../_images/BaselineTimestamps.png" />
<p><strong>。。TODO。。</strong></p>
<hr class="docutils" />
</div>
</div>
</div>
<div class="section" id="offiline">
<h2>Offiline<a class="headerlink" href="#offiline" title="Permalink to this headline">¶</a></h2>
<p>The contents in this drop-down column are the offline parameter optimization adjustment.</p>
<div class="section" id="initdata">
<h3>InitData<a class="headerlink" href="#initdata" title="Permalink to this headline">¶</a></h3>
<img alt="../_images/AdjustPar.png" src="../_images/AdjustPar.png" />
<ul class="simple">
<li><p><em>Run</em>: Select the file run number to be read, <em>Mod</em>: selects to read which module, and the button <em>Read</em> loads the file main information (channel address, energy, waveform position, etc.) into the memory.</p></li>
<li><p>Additional analysis: Among the three options, the selection indicates that the information is included when reading the file data into memory. Some analysis methods can only be enabled if this data is read. But the premise is that this information needs to be recorded during data collection.</p></li>
<li><p>InitData: This page. Read the binary file.</p></li>
<li><p>Adjust Par:  Waveform/fast filter/energy filter/cfd/threshould of the select channel.</p></li>
<li><p>Wave-16:  Waveform/fast filter/energy filter/cfd filter/threshould of the 16 channels.</p></li>
<li><p>Energy-16:  The original energy spectrum of the 16 channel..</p></li>
<li><p>Orig Energy:  The original energy spectrum of the select channel.</p></li>
<li><p>Calc Energy:  Recalculation of energy spectrum by waveforms.</p></li>
<li><p>FF/CFD Thre:   Accumulation of a large number of fast filter/cfd filter waveforms to determine the threshold.</p></li>
<li><p>Energy-FF:  The two dimensional relationship between energy and fast filter first/second peak height.</p></li>
<li><p>QDC:  It will be finished soon.</p></li>
<li><p>FFT:  Fourier transformation of a single waveform. User can choose XIA/CAEN/FFTW3 functions.</p></li>
<li><p>Time Diff:  Time difference of two signal.</p></li>
</ul>
</div>
<hr class="docutils" />
<div class="section" id="adjust-par">
<h3>Adjust Par<a class="headerlink" href="#adjust-par" title="Permalink to this headline">¶</a></h3>
<img alt="../_images/OfflineAPI.png" src="../_images/OfflineAPI.png" />
<p>To calculate the fast filter and slow filter cfd curves offline from the acquired waveform, the following requirements are imposed on the acquired waveform. In the above figure, the calculated energy is the difference between the energy of the algorithm and the baseline of the algorithm. To get the correct trapezoid, the premise is that there is a long enough point in front to calculate the baseline.</p>
<p>In the figure, EFRT stands for Energy Filter Rise Time and EFFT stands for Energy Filter Flat Top.</p>
<p>To compute energy filter response offline, the ideal settings are:</p>
<ul class="simple">
<li><p>Total trance length &gt; 2 x ( 2 x EFRT + EFFT)</p></li>
<li><p>Pre-trigger trace (Trace-delay) length &gt; ( 3 x EFRT + EFFT )</p></li>
</ul>
<p>Of course, this is just one way to calculate the trapezoid. If we record the baseline of the energy trapezoid for each event and use the average of the pre-trigger partial points as the infinite extension to the left of the waveform, then this is not limited by this condition Pre-trigger trace length &gt; ( 3 x EFRT + EFFT ) . In the following pages, when using the Old Baseline method to calculate the energy trapezoid, there is a premise that the pre-trigger trace length requires at least 200 points because the left side of the waveform is averaged by the first 200 points.</p>
<img alt="../_images/Adjustpars3.png" src="../_images/Adjustpars3.png" />
<p>When the acquired waveform pre-trigger trace length &gt; 3 x EFRT + EFFT, the pre-trigger trace provides enough points to calculate the baseline, and the SF BL algorithm can choose Calculate, otherwise the Old Baseline algorithm needs to be selected. When recording data with the premise of the Old Baseline algorithm, select to turn on the baseline for the trapezoid and the raw E sums/baseline option for the InitData page. When the Old Baseline algorithm is selected, the next four option parameters take effect, which are the parameters of the energy trapezoid used in the data acquisition.</p>
<p>The green curve in the above figure is a typical condition that does not satisfy the pre-trigger trace length &gt; 3 x EFRT + EFFT when the Calculate algorithm is used. The figure shows a pre-trigger trace length of 10 us, an EFRT of 5.04 us, and an EFFT of 1.60 us.</p>
<p>In this case, you should use the Old Baseline algorithm shown below.</p>
<img alt="../_images/Adjustpars1.png" src="../_images/Adjustpars1.png" />
<p>The user can choose to view the channel of the waveform. The button <em>Load</em> can read and display the current parameter setting. When modifying the above parameters, you need to press the <em>Apply</em> button to make it effective. The button <em>Draw</em> is used to display the event waveform of the next channel.</p>
<p>Users can choose to display multiple waveforms in <strong>Wave / Slow Filter / Fast filter / Thres / CFD / CFD Thres</strong> or select the drawing style of the curve.</p>
<img alt="../_images/Adjustpars2.png" src="../_images/Adjustpars2.png" />
<p>The figure above shows four waveforms，fast filter, Thres, CFD, and CFD Thres. The pattern displays in dots. The lowest level horizontal bar can be dragged at both ends, and the user can pull to control the display range of the waveform abscissa, as shown in the figure of 800 - 1300 points. In this case, clicking the Draw button will hold the specified coordinate range.</p>
</div>
<hr class="docutils" />
<div class="section" id="wave-16">
<h3>Wave-16<a class="headerlink" href="#wave-16" title="Permalink to this headline">¶</a></h3>
<img alt="../_images/Waveform16.png" src="../_images/Waveform16.png" />
<p>This page is used to view 16 channels of raw waveforms, filter waveforms, thresholds, and so on. Users can choose to display multiple waveforms in <strong>Wave/Slow Filter/Fast filter/Thres/CFD/CFD Thres</strong> simultaneously.</p>
<p>Through this page, the user can quickly check whether the waveforms of all channels of the module are normal and whether the parameter settings are reasonable. Click the button <strong>Draw</strong> once to display the next waveform for all channels.</p>
<p><em>It should be noted that when the acquired waveform pre-trigger trace length is greater than 3 x EFRT + EFFT, the Slow Filter waveform on this page is correct.</em></p>
</div>
<hr class="docutils" />
<div class="section" id="energy-16">
<h3>Energy-16<a class="headerlink" href="#energy-16" title="Permalink to this headline">¶</a></h3>
<img alt="../_images/Energy16.png" src="../_images/Energy16.png" />
<p>This interface is used to view the 1D spectrum of 16 channels simultaneously. Click the button <em>Draw</em> in the top right corner.</p>
</div>
<hr class="docutils" />
<div class="section" id="orig-energy">
<h3>Orig Energy<a class="headerlink" href="#orig-energy" title="Permalink to this headline">¶</a></h3>
<img alt="../_images/OrigEnergy.png" src="../_images/OrigEnergy.png" />
<p>This page is used to quickly view the energy spectrum of a channel. The user selects the number of bins of the spectrum, which represents how many points we can didide 0-65536 into. Select to view the channel and then press the <em>Draw</em> button.</p>
<img alt="../_images/OrigEnergyFit.png" src="../_images/OrigEnergyFit.png" />
<p>The <em>Open Fit</em> button in the upper left corner is used for fast Gaussian fitting to see energy resolution. Click the button to turn on the fitting mode, and click the button again to turn it off. Move the mouse to the blue line of the histogram and the mouse cross will become a triangular arrow. The mouse of the triangle arrow clicks on two positions in the histogram, and the interval between the two points is the fitting interval, then the energy resolution can be viewed.</p>
</div>
<hr class="docutils" />
<div class="section" id="calc-energy">
<h3>Calc Energy<a class="headerlink" href="#calc-energy" title="Permalink to this headline">¶</a></h3>
<img alt="../_images/CalcEnergy.png" src="../_images/CalcEnergy.png" />
<p>This page recalculates the energy using the acquired waveform. Like the <strong>Adjust Par</strong> page, the SF BL algorithm can choose either the Calculate algorithm or the Old Baseline algorithm.</p>
<p>The fast filter and energy filter parameters used to calculate the energy adopt the setting parameters of the module. The user needs to select the number of bins that the energy about 65536 channels are divided into. You can select 1024/2048/4096/8192/16384/32768/65536. Select the calculated channel and then press the button <em>Draw</em> to start the calculation, the upper left corner will display the progress of the calculation, or press the button <em>Stop</em> to terminate the calculation early. When the calculation is terminated, the spectrum will be displayed on the artboard.</p>
</div>
<hr class="docutils" />
<div class="section" id="ff-cfd-thre">
<h3>FF/CFD Thre<a class="headerlink" href="#ff-cfd-thre" title="Permalink to this headline">¶</a></h3>
<img alt="../_images/FFCFDThre.png" src="../_images/FFCFDThre.png" />
<p>This interface is used for the accumulation of fast filter waveforms and cfd filter waveforms. The user selects the channel to view and presses the <em>Draw</em> button to start the calculation. The top left corner of the page can monitor the progress from time to time, or press the <em>Stop</em> button to terminate the calculation early. The calculation ends as shown in the figure above.</p>
<p>The upper buttons <em>FFProjectY</em>, <em>CFDProjectY</em>, <em>OriginalCFD</em>, and <em>CalculateCFD</em> respectively pop up the sub-painters.</p>
<img alt="../_images/FFCFDThreFFProjectY.png" src="../_images/FFCFDThreFFProjectY.png" />
<p>Click the button <em>FFProjectY</em> to open the view of the fast filter projection. Click again to close the function. When the function is turned on, place the mouse on the 2D map and move the mouse left and right. The Fast Filter ShowProjectY sub-panel displays the projection distribution of the position pointed by the mouse. This distribution before triggering also characterizes the level of noise.</p>
<img alt="../_images/FFCFDThreCFDProjectY.png" src="../_images/FFCFDThreCFDProjectY.png" />
<p>Similarly, the button <em>CFDProjectY</em> function is as shown in the figure above.</p>
<img alt="../_images/FFCFDThreCFD.png" src="../_images/FFCFDThreCFD.png" />
<p>Click the button <em>OriginalCFD</em> to display the distribution of CFD values in the raw data on the left. Click the button <em>CalculateCFD</em> to display the result of the offline waveform calculation on the right, and the parameters used for the calculation are the current ones. For a suitable CFD parameter setting, the CFD should be evenly distributed.</p>
</div>
<hr class="docutils" />
<div class="section" id="energy-ff">
<h3>Energy-FF<a class="headerlink" href="#energy-ff" title="Permalink to this headline">¶</a></h3>
<img alt="../_images/EnergyFFGraph.png" src="../_images/EnergyFFGraph.png" />
<p>This interface is a two-dimensional map of the energy and fast filter peak heights used to determine the appropriate threshold. The left picture is a two-dimensional correlation between energy and fast filter, which should have a good linear relationship. The right picture shows the two-dimensional correlation between the energy and the remaining maximum value of the part of the fast filer where the trapezoid is thrown away, which characterizes the noise level. And the energy should be uncorrelated with this value.</p>
<p>Firstly, for <strong>Draw Style</strong> we choose <strong>Graph</strong>, which is the 2D scatter plot mode. Select the channel you want to view, then press the <em>Draw</em> button to start the calculation, in the top left corner the progress from time to time can be monitored, or you can press the <em>Stop</em> button to terminate the calculation early. The calculation ends as shown in the figure above.</p>
<img alt="../_images/EnergyFFHist.png" src="../_images/EnergyFFHist.png" />
<p>The 2D scatter plot does not visually show the density distribution of the displayed data points, so for <strong>Draw Style</strong> we select the <strong>Hist mode</strong>. Select the bins or ranges of the X and Y axis, and then press the <em>Draw</em> button to start the calculation. The result is shown in the figure above, and the right figure reflects the level of noise.</p>
</div>
<hr class="docutils" />
<div class="section" id="energy-cfd">
<h3>Energy-CFD<a class="headerlink" href="#energy-cfd" title="Permalink to this headline">¶</a></h3>
<img alt="../_images/EnergyCFD.png" src="../_images/EnergyCFD.png" />
<ul class="simple">
<li><p>The upper left picture shows the energy spectrum when cfd is invalid.</p></li>
<li><p>The lower left picture shows the energy spectrum when cfd is valid.</p></li>
<li><p>The upper right picture shows the CFD spectrum.</p></li>
<li><p>The lower right picture is a two-dimensional map of energy and CFD.</p></li>
</ul>
<p>首先选择能量与CFD二维关联图中bin数。其中 CFD 分 bin 可选择 4096，2084，1024；能量可选择bin数与道址范围。
之后选择查看通道，然后按 Draw 按钮开始进入计算。</p>
</div>
<hr class="docutils" />
<div class="section" id="id14">
<h3>QDC<a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h3>
<p><strong>to do not completed</strong></p>
<p><strong>QDC  TODO</strong></p>
</div>
<hr class="docutils" />
<div class="section" id="fft">
<h3>FFT<a class="headerlink" href="#fft" title="Permalink to this headline">¶</a></h3>
<img alt="../_images/FFT.png" src="../_images/FFT.png" />
<p>This interface is used to quickly view the Fourier transform of the waveform. Users can choose different algorithms, such as <strong>XIA, fftw3, CAEN(HANNING), CAEN(HAMMING), CAEN(BLACKMAN), CAEN(RECT)</strong>. Select the channel you want to view. Then press the <em>Draw</em> button, and each time the button is clicked, the next result is displayed.</p>
<p>the ADC trace display also includes the option to view a FFT of the acquired trace. This is useful to diagnose noise contributions.</p>
</div>
<hr class="docutils" />
<div class="section" id="time-diff">
<h3>Time Diff<a class="headerlink" href="#time-diff" title="Permalink to this headline">¶</a></h3>
<img alt="../_images/TimeDiff.png" src="../_images/TimeDiff.png" />
<p>This interface is used to quickly view the time resolution of the two signals. The user can choose to view the time difference between the two signals of the zero crossing of the CFD algorithm or the time difference between two signals of the fast filter over threshold. <strong>Xbin</strong> represents the bin number of the abscissa, <strong>Xmin</strong> represents the minimum value of the abscissa, and <strong>Xmax</strong> represents the maximum value of the abscissa. With Ch A, Ch B we can select the two channels we want to view. Then press the <em>Draw</em> button.</p>
<p>The option <strong>Limits</strong> selection turns on the energy range constraint. After selecting this option, the following four parameters, AL, AR, BL, and BR, take effect, which respectively represent the left and right ranges of the Ch A/B energy address, and only events with energy falling in this interval are filled into the histogram. The <strong>Orig Energy</strong> page allows the user to select the appropriate energy channel interval.</p>
</div>
<hr class="docutils" />
<div class="section" id="simulation">
<h3>Simulation<a class="headerlink" href="#simulation" title="Permalink to this headline">¶</a></h3>
<p>Different types of detection and different signal-to-noise ratio waveforms are generated by the model to assist the user in learning parameter optimization adjustment.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="NOGUI.html" class="btn btn-neutral float-right" title="NOGUI" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="Decode.html" class="btn btn-neutral float-left" title="Decode" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Hongyi Wu(吴鸿毅)

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>