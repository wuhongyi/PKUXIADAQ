

<!DOCTYPE html>
<html class="writer-html5" lang="zh-CN" >
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Logic &mdash; GDDAQ beta 文档</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/graphviz.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/translations.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜索" href="../search.html" />
    <link rel="next" title="Multiple Modules Synchronously" href="MultipleModulesSynchronously.html" />
    <link rel="prev" title="Front Panel" href="FrontPanel.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> GDDAQ
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="在文档中搜索" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../README.html">Introduction</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Install</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../INSTALL.html">Installation of Software</a></li>
<li class="toctree-l1"><a class="reference internal" href="../MYSQL.html">MYSQL</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Users Guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="README.html">Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="Crate.html">Crate</a></li>
<li class="toctree-l1"><a class="reference internal" href="FIRMWARE.html">FIRMWARE</a></li>
<li class="toctree-l1"><a class="reference internal" href="Decode.html">Decode</a></li>
<li class="toctree-l1"><a class="reference internal" href="GUI.html">GUI</a></li>
<li class="toctree-l1"><a class="reference internal" href="NOGUI.html">NOGUI</a></li>
<li class="toctree-l1"><a class="reference internal" href="OnlineStattics.html">Online Stattics</a></li>
<li class="toctree-l1"><a class="reference internal" href="MakeEvent.html">MakeEvent</a></li>
<li class="toctree-l1"><a class="reference internal" href="FrontPanel.html">Front Panel</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Logic</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#logic-function">Logic function</a></li>
<li class="toctree-l2"><a class="reference internal" href="#module-fast-trigger-for-trigger">Module Fast Trigger(for trigger)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#module-validation-trigger-for-control-logic">Module Validation Trigger(for control logic)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#channel-validation-trigger-for-trigger-control-logic">Channel Validation Trigger(for trigger/control logic)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#veto">Veto</a></li>
<li class="toctree-l2"><a class="reference internal" href="#system-fpga-coincidence-multiplicity">System FPGA（coincidence/multiplicity）</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="MultipleModulesSynchronously.html">Multiple Modules Synchronously</a></li>
<li class="toctree-l1"><a class="reference internal" href="UpdateCPLD.html">Update CPLD</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Applications</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Example/README.html">Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Example/TOF2TAC.html">TOF measurement in 100M</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Example/TimeResolution.html">Time Resolution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Example/RecommendedParameters.html">Recommended Parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Example/InBeamGammaCIAE.html">In Beam Gamma</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Programmers Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../ProgrammersGuide/README.html">Developer’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ProgrammersGuide/XIAAPI.html">PIXIE-16 API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ProgrammersGuide/PKUCode.html">PKU Code</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">GDDAQ</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Logic</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/UsersGuide/Logic.rst.txt" rel="nofollow"> 查看页面源码</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <section id="logic">
<h1>Logic<a class="headerlink" href="#logic" title="永久链接至标题">¶</a></h1>
<section id="logic-function">
<h2>Logic function<a class="headerlink" href="#logic-function" title="永久链接至标题">¶</a></h2>
<p>Whether each event of a certain signal is recorded depends on:</p>
<ul class="simple">
<li><p>Fast trigger select (first trigger)</p></li>
<li><p>Control logic (second trigger)</p></li>
</ul>
<p>Fast trigger select：</p>
<ul class="simple">
<li><p>Local fast filter</p></li>
<li><p>Channel validation trigger</p></li>
<li><p>Module fast trigger</p></li>
</ul>
<p>Control logic：</p>
<ul class="simple">
<li><p>Module validation trigger</p></li>
<li><p>Channel validation trigger</p></li>
<li><p>Veto</p></li>
<li><p>Pileup</p></li>
<li><p>…</p></li>
</ul>
<img alt="../_images/illustratesthesignalprocessinginthepixie16modules.png" src="../_images/illustratesthesignalprocessinginthepixie16modules.png" />
<p>As shown in Figure, the incoming analog pulse is first digitized by the ADC and then enters the signal processing circuitries in the Signal Processing FPGA, each of which processes ADC data from 4 channels of a Pixie-16 module.</p>
<p>The digitized data stream is first fed into two branches: a fast filter generating fast triggers to be sent to the System FPGA and a Delay FIFO which could be used to compensate for the delay between fast triggers and the external triggers.</p>
<p>The digitized data stream passing through the Delay FIFO is then branched into four parts:</p>
<ul class="simple">
<li><p>energy filter which samples energy running sums at the PeakSample time;</p></li>
<li><p>trigger filter which detects pulse and performs pileup inspection;</p></li>
<li><p>capture FIFO which delays the ADC data according to the trace delay parameter value before the ADC data is streamed into the Trace Dual Port Memory (DPM) when a valid pulse is detected;</p></li>
<li><p>CFD circuitry where a CFD trigger is generated to trigger the computation of QDC sums, latch timestamps and record traces.</p></li>
</ul>
<p>The Control Logic in the signal processing FPGA utilizes the local fast trigger, CFD trigger, veto and external triggers to determine whether and when to stream waveform data into the Trace DPM and to write event information into the Header DPM. The DSP polls the status of the DPMs through the Status Registers and moves event data into the External FIFO through the DSP bus and the System FPGA.</p>
<p><strong>Trigger Stretch Lengths</strong></p>
<ul class="simple">
<li><p><strong>External trigger stretch</strong> is used to stretch the module validation trigger pulse.</p></li>
<li><p><strong>Channel trigger stretch</strong> is used to stretch the channel validation trigger pulse.</p></li>
<li><p><strong>Veto stretch</strong> is used to stretch the veto pulse for this channel.</p></li>
<li><p><strong>Fast trigger backplane length</strong> is used to stretch the fast trigger pulse to be sent to the System FPGA, where this fast trigger can be sent to the backplane to be shared with other modules, or can be used for making coincidence or multiplicity triggers.</p></li>
</ul>
<p><strong>FIFO Delays</strong></p>
<ul class="simple">
<li><p><strong>External delay length</strong> is used to delay the incoming ADC waveform and the local fast trigger in order to compensate for the delayed arrival of the external trigger pulses, e.g., module validation trigger, channel validation trigger, etc.</p></li>
<li><p><strong>Fast trigger backplane delay</strong> is used to delay the fast trigger pulse before it is sent to the System FPGA for sharing with other modules through the backplane or making coincidence or multiplicity triggers.</p></li>
</ul>
<img alt="../_images/rangefortriggerstretchlengthsandfifodelayinpixie16modules.png" src="../_images/rangefortriggerstretchlengthsandfifodelayinpixie16modules.png" />
</section>
<section id="module-fast-trigger-for-trigger">
<h2>Module Fast Trigger(for trigger)<a class="headerlink" href="#module-fast-trigger-for-trigger" title="永久链接至标题">¶</a></h2>
<p>Module fast trigger has four options：</p>
<ul class="simple">
<li><dl class="simple">
<dt>Ext_FastTrig_In(From this module)</dt><dd><ul>
<li><p>Ext_FastTrig_Sel(Front panel TTL input)</p></li>
<li><p>Int_FastTrig_Sgl(Local fast trigger of a specified channel in this module)</p></li>
<li><p>FTIN_Or(The OR of local fast trigger of all channel in this module)</p></li>
<li><p>LVDS_FastTrig_FP(Front panel RJ45 port input)</p></li>
<li><p>ChanTrig_Sel(The valid trigger of a specified channel of the module)(Share a setting with module validation trigger)</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>FT_LocalCrate_BP(Trigger sent by the specified module in this crate)</p></li>
<li><p>FT_In_BP(Trigger sent by the specified module on the specified crate in multiple crates)</p></li>
<li><p>FT_WiredOr(OR of local fast trigger of all modules in this crate)</p></li>
</ul>
</section>
<section id="module-validation-trigger-for-control-logic">
<h2>Module Validation Trigger(for control logic)<a class="headerlink" href="#module-validation-trigger-for-control-logic" title="永久链接至标题">¶</a></h2>
<p>Module validation trigger has five options：</p>
<ul class="simple">
<li><dl class="simple">
<dt>Ext_ValidTrig_In(From this module)</dt><dd><ul>
<li><p>Ext_ValidTrig_Sel(Front panel TTL input)</p></li>
<li><p>Int_ValidTrig_Sgl(Local fast trigger of a specified channel in this module)</p></li>
<li><p>FTIN_Or(The OR of local fast trigger of all channel in this module)</p></li>
<li><p>LVDS_ValidTrig_FP(Front panel RJ45 port input)</p></li>
<li><p>ChanTrig_Sel(The valid trigger of a specified channel of the module)(Share a setting with  module fast trigger)</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>ET_LocalCrate_BP(Trigger sent by the specified module in this crate)</p></li>
<li><p>ET_In_BP(Trigger sent by the specified module on the specified crate in multiple crates)</p></li>
<li><p>ET_WiredOr(OR of local fast trigger of all modules in this crate)</p></li>
<li><p>Front panel module GATE input LVDS signal</p></li>
</ul>
</section>
<section id="channel-validation-trigger-for-trigger-control-logic">
<h2>Channel Validation Trigger(for trigger/control logic)<a class="headerlink" href="#channel-validation-trigger-for-trigger-control-logic" title="永久链接至标题">¶</a></h2>
<p>Channel validation trigger has five options：</p>
<ul class="simple">
<li><p>Independent setting for each channel, from multiplicity</p></li>
<li><p>Independent setting for each channel, from coincidence</p></li>
<li><p>One setting for every 4 channels, derived from the left, its own and right modules FT</p></li>
<li><p>One setting for every 4 channels, from the coincidence between its own FT and Ext_FastTrig_In</p></li>
<li><p>Independent setting for each channe, the front panel channel GATE inputs the LVDS signal (shares one input port with the front panel Veto)</p></li>
</ul>
</section>
<section id="veto">
<h2>Veto<a class="headerlink" href="#veto" title="永久链接至标题">¶</a></h2>
<p>OR from ModuleVeto and ChannelVeto:</p>
<ul class="simple">
<li><dl class="simple">
<dt>ModuleVeto source has two options：</dt><dd><ul>
<li><p>Module Validation Trigger</p></li>
<li><p>Front panel Module Gate</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>ChannelVote source has two options：</dt><dd><ul>
<li><p>Channel Validtion Trigger</p></li>
<li><p>Front panel Gate input for channel (Share one input port with the front panel Channel validation trigger)</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</section>
<section id="system-fpga-coincidence-multiplicity">
<h2>System FPGA（coincidence/multiplicity）<a class="headerlink" href="#system-fpga-coincidence-multiplicity" title="永久链接至标题">¶</a></h2>
<img alt="../_images/SystemFPGA.png" src="../_images/SystemFPGA.png" />
<p>Multiplicity: For the channel set up, the left neighbor module, its own module, and the right-side module have a total of 48 channels, and you can choose the number of channel to participate in multiply trigger.</p>
<p>Coincidence: For the channel set, the left neighbor module, its own module, and the right neighbor module, each module match the set criteria to give a coincidence trigger.</p>
<img alt="../_images/fasttrigger_stretch_delay.png" src="../_images/fasttrigger_stretch_delay.png" />
<p>It takes about 100 ns for the fast filter trigger of other modules to pass to the module through the crate backplane. Therefore, by adjusting the gate width and delay, it is guaranteed to coincidence and multiply trigger.</p>
<ul class="simple">
<li><p>Fast trigger stretch length: Set fast trigger gate width，</p></li>
<li><p>fast trigger delay length: Set fast trigger delay。</p></li>
</ul>
<p><em>Control logic (module/channel validation trigger)</em></p>
<img alt="../_images/validationtrigger.png" src="../_images/validationtrigger.png" />
<p><strong>Particular attention should be paid to the fact that it takes about 100 ns for the signal to be transmitted through the backplane.</strong></p>
</section>
</section>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="MultipleModulesSynchronously.html" class="btn btn-neutral float-right" title="Multiple Modules Synchronously" accesskey="n" rel="next">下一页 <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="FrontPanel.html" class="btn btn-neutral float-left" title="Front Panel" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> 上一页</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; 版权所有 2020, Hongyi Wu(吴鸿毅).

    </p>
  </div>
    
    
    
    利用 <a href="https://www.sphinx-doc.org/">Sphinx</a> 构建，使用了 
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">主题</a>
    
    由 <a href="https://readthedocs.org">Read the Docs</a>开发. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>