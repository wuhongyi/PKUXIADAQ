

<!DOCTYPE html>
<html class="writer-html5" lang="zh-CN" >
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>PIXIE-16 API &mdash; GDDAQ beta 文档</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/graphviz.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/translations.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜索" href="../search.html" />
    <link rel="next" title="PKU Code" href="PKUCode.html" />
    <link rel="prev" title="Developer’s Guide" href="README.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> GDDAQ
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="在文档中搜索" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../README.html">Introduction</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Install</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../INSTALL.html">Installation of Software</a></li>
<li class="toctree-l1"><a class="reference internal" href="../MYSQL.html">MYSQL</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Users Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../UsersGuide/README.html">Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../UsersGuide/Crate.html">Crate</a></li>
<li class="toctree-l1"><a class="reference internal" href="../UsersGuide/FIRMWARE.html">FIRMWARE</a></li>
<li class="toctree-l1"><a class="reference internal" href="../UsersGuide/Decode.html">Decode</a></li>
<li class="toctree-l1"><a class="reference internal" href="../UsersGuide/GUI.html">GUI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../UsersGuide/NOGUI.html">NOGUI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../UsersGuide/OnlineStattics.html">Online Stattics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../UsersGuide/MakeEvent.html">MakeEvent</a></li>
<li class="toctree-l1"><a class="reference internal" href="../UsersGuide/FrontPanel.html">Front Panel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../UsersGuide/Logic.html">Logic</a></li>
<li class="toctree-l1"><a class="reference internal" href="../UsersGuide/MultipleModulesSynchronously.html">Multiple Modules Synchronously</a></li>
<li class="toctree-l1"><a class="reference internal" href="../UsersGuide/UpdateCPLD.html">Update CPLD</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Applications</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Example/README.html">Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Example/TOF2TAC.html">TOF measurement in 100M</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Example/TimeResolution.html">Time Resolution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Example/RecommendedParameters.html">Recommended Parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Example/InBeamGammaCIAE.html">In Beam Gamma</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Programmers Guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="README.html">Developer’s Guide</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">PIXIE-16 API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#xia-api">XIA API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#pixie16acquireadctrace">Pixie16AcquireADCTrace</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pixie16acquirebaselines">Pixie16AcquireBaselines</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pixie16adjustoffsets">Pixie16AdjustOffsets</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pixie16blcutfinder">Pixie16BLcutFinder</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pixie16bootmodule">Pixie16BootModule</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pixie16checkexternalfifostatus">Pixie16CheckExternalFIFOStatus</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pixie16checkrunstatus">Pixie16CheckRunStatus</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pixie16computefastfiltersoffline">Pixie16ComputeFastFiltersOffline</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pixie16computeinputcountrate">Pixie16ComputeInputCountRate</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pixie16computelivetime">Pixie16ComputeLiveTime</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pixie16computeoutputcountrate">Pixie16ComputeOutputCountRate</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pixie16computeprocessedevents">Pixie16ComputeProcessedEvents</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pixie16computerealtime">Pixie16ComputeRealTime</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pixie16computeslowfiltersoffline">Pixie16ComputeSlowFiltersOffline</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pixie16controltaskrun">Pixie16ControlTaskRun</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pixie16copydspparameters">Pixie16CopyDSPParameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pixie16embufferio">Pixie16EMbufferIO</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pixie16endrun">Pixie16EndRun</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pixie16exitsystem">Pixie16ExitSystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pixie16geteventsinfo">Pixie16GetEventsInfo</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pixie16getmoduleevents">Pixie16GetModuleEvents</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pixie16imbufferio">Pixie16IMbufferIO</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pixie16initsystem">Pixie16InitSystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pixie16loaddspparametersfromfile">Pixie16LoadDSPParametersFromFile</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pixie16programfippi">Pixie16ProgramFippi</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pixie16readcsr">Pixie16ReadCSR</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pixie16readdatafromexternalfifo">Pixie16ReadDataFromExternalFIFO</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pixie16readhistogramfromfile">Pixie16ReadHistogramFromFile</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pixie16readhistogramfrommodule">Pixie16ReadHistogramFromModule</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pixie16readlistmodetrace">Pixie16ReadListModeTrace</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pixie16readmoduleinfo">Pixie16ReadModuleInfo</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pixie16readsglchanadctrace">Pixie16ReadSglChanADCTrace</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pixie16readsglchanbaselines">Pixie16ReadSglChanBaselines</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pixie16readsglchanpar">Pixie16ReadSglChanPar</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pixie16readsglmodpar">Pixie16ReadSglModPar</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pixie16readstatisticsfrommodule">Pixie16ReadStatisticsFromModule</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pixie16registerio">Pixie16RegisterIO</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pixie16savedspparameterstofile">Pixie16SaveDSPParametersToFile</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pixie16saveexternalfifodatatofile">Pixie16SaveExternalFIFODataToFile</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pixie16savehistogramtofile">Pixie16SaveHistogramToFile</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pixie16setdacs">Pixie16SetDACs</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pixie16starthistogramrun">Pixie16StartHistogramRun</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pixie16startlistmoderun">Pixie16StartListModeRun</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pixie16taufinder">Pixie16TauFinder</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pixie16writecsr">Pixie16WriteCSR</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pixie16writesglchanpar">Pixie16WriteSglChanPar</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pixie16writesglmodpar">Pixie16WriteSglModPar</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#pku-api">PKU API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#hongyiwupixie16computefastfiltersoffline">HongyiWuPixie16ComputeFastFiltersOffline</a></li>
<li class="toctree-l3"><a class="reference internal" href="#hongyiwupixie16computeslowfiltersoffline">HongyiWuPixie16ComputeSlowFiltersOffline</a></li>
<li class="toctree-l3"><a class="reference internal" href="#hongyiwupixie16computeslowfiltersofflineaveragebaseline">HongyiWuPixie16ComputeSlowFiltersOfflineAverageBaseline</a></li>
<li class="toctree-l3"><a class="reference internal" href="#hongyiwupixie16computeslowfiltersofflineextendbaseline">HongyiWuPixie16ComputeSlowFiltersOfflineExtendBaseline</a></li>
<li class="toctree-l3"><a class="reference internal" href="#hongyiwupixie16setofflinevariant">HongyiWuPixie16SetOfflineVariant</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="PKUCode.html">PKU Code</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">GDDAQ</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>PIXIE-16 API</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/ProgrammersGuide/XIAAPI.rst.txt" rel="nofollow"> 查看页面源码</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <section id="pixie-16-api">
<h1>PIXIE-16 API<a class="headerlink" href="#pixie-16-api" title="永久链接至标题">¶</a></h1>
<p>It from <strong>Pixie-16 Programmer’s Manual</strong> <em>Version 3.06, September 13, 2019</em></p>
<hr class="docutils" />
<section id="xia-api">
<h2>XIA API<a class="headerlink" href="#xia-api" title="永久链接至标题">¶</a></h2>
<section id="pixie16acquireadctrace">
<h3>Pixie16AcquireADCTrace<a class="headerlink" href="#pixie16acquireadctrace" title="永久链接至标题">¶</a></h3>
<p>Acquire ADC traces in single or multiple modules</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Use this function to acquire ADC traces from Pixie-16 modules. Specify the module using ModNum which starts counting at 0. If ModNum is set to be less than the total number of modules in the system, only the module specified by ModNum will have its ADC traces acquired. But if ModNum is equal to the total number of modules in the system, then all modules in the system will have their ADC traces acquired.</span>
<span class="c1">// After the successful return of this function, the DSP’s internal memory will be filled with ADC trace data. A user’s application software should then call the function Pixie16ReadSglChanADCTrace to read the ADC trace data out to the host computer, channel by channel.</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">Pixie16AcquireADCTrace</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="w"> </span><span class="p">);</span><span class="c1">// module number</span>
</pre></div>
</div>
<p><strong>Return values description and error handling</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>0 Success</dt><dd><ul>
<li><p>None</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-1 Invalid Pixie-16 module number</dt><dd><ul>
<li><p>Correct ModNum</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-2 Failed to start run</dt><dd><ul>
<li><p>Reboot the modules</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-3 Acquiring ADC traces timed out</dt><dd><ul>
<li><p>Reboot the modules</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p><strong>Usage example</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">;</span><span class="w"></span>
<span class="kt">int</span><span class="w"> </span><span class="n">retval</span><span class="p">;</span><span class="w"></span>

<span class="c1">// assume we want to acquire ADC trace from module 0</span>
<span class="n">ModNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>

<span class="c1">// acquire the trace</span>
<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16AcquireADCTrace</span><span class="w"> </span><span class="p">(</span><span class="n">ModNum</span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// error handling</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="pixie16acquirebaselines">
<h3>Pixie16AcquireBaselines<a class="headerlink" href="#pixie16acquirebaselines" title="永久链接至标题">¶</a></h3>
<p>Acquire baselines from a module</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Use this function to acquire baselines from Pixie-16 modules. Specify the module using ModNum which starts counting at 0. If ModNum is set to be less than the total number of modules in the system, only the module specified by ModNum will have its baselines acquired. But if ModNum is set to be equal to the total number of modules in the system, then all modules in the system will have their baselines acquired.</span>
<span class="c1">// After the successful return of this function, the DSP’s internal memory will be filled with baselines data. Users should then call the function Pixie16ReadSglChanBaselines to read the baselines data out to the host computer, channel by channel.</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">Pixie16AcquireBaselines</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="w"> </span><span class="p">);</span><span class="c1">// module number</span>
</pre></div>
</div>
<p><strong>Return values description and error handling</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>0 Success</dt><dd><ul>
<li><p>None</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-1 Invalid Pixie-16 module number</dt><dd><ul>
<li><p>Correct ModNum</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-2 Failed to start the GET_BASELINES run</dt><dd><ul>
<li><p>Reboot the modules</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-3 GET_BASELINES run timed out</dt><dd><ul>
<li><p>Reboot the modules</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p><strong>Usage example</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">;</span><span class="w"></span>
<span class="kt">int</span><span class="w"> </span><span class="n">retval</span><span class="p">;</span><span class="w"></span>

<span class="c1">// assume we want to acquire baselines for module 0</span>
<span class="n">ModNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>

<span class="c1">// acquire the trace</span>
<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16AcquireBaselines</span><span class="w"> </span><span class="p">(</span><span class="n">ModNum</span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// error handling</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="pixie16adjustoffsets">
<h3>Pixie16AdjustOffsets<a class="headerlink" href="#pixie16adjustoffsets" title="永久链接至标题">¶</a></h3>
<p>Adjust DC-offsets in single or multiple modules</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Use this function to adjust the DC-offsets of Pixie-16 modules. Specify the module using ModNum which starts counting at 0. If ModNum is set to be less than the total number of modules in the system, only the module specified by ModNum will have its DC-offsets adjusted. But if ModNum is set to be equal to the total number of modules in the system, then all modules in the system will have their DC-offsets adjusted.</span>
<span class="c1">// After the DC-offset levels have been adjusted, the baseline level of the digitized input signals will be determined by the DSP parameter BaselinePercent. For instance, if BaselinePercent is set to 10(%), the baseline level of the input signals will be ~409 on the 12-bit ADC scale (minimum: 0; maximum: 4095).</span>
<span class="c1">// The main purpose of this function is to ensure the input signals fall within the voltage range of the ADCs so that all input signals can be digitized by the ADCs properly.</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">Pixie16AdjustOffsets</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="w"> </span><span class="p">);</span><span class="w"> </span><span class="c1">// module number</span>
</pre></div>
</div>
<p><strong>Return values description and error handling</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>0 Success</dt><dd><ul>
<li><p>None</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-1 Invalid Pixie-16 module number</dt><dd><ul>
<li><p>Check if ModNum is valid</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-2 Failed to start the ADJUST_OFFSETS run</dt><dd><ul>
<li><p>Reboot the module</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-3 ADJUST_OFFSETS run timed out</dt><dd><ul>
<li><p>Check error message log file Pixie16msg.txt</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p><strong>Usage example</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">retval</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">;</span><span class="w"></span>

<span class="c1">// set to the first module</span>
<span class="n">ModNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>

<span class="c1">// adjust dc-offsets</span>
<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16AdjustOffsets</span><span class="p">(</span><span class="n">ModNum</span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// error handling</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="pixie16blcutfinder">
<h3>Pixie16BLcutFinder<a class="headerlink" href="#pixie16blcutfinder" title="永久链接至标题">¶</a></h3>
<p>Compute new Baseline Cut values of a module</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Use this function to find the Baseline Cut value for one channel of a Pixie-16 module. The baseline cut value is then downloaded to the DSP, where baselines are captured and averaged over time. The cut value would prevent a bad baseline value from being used in the averaging process, i.e., if a baseline value is outside the baseline cut range, it will not be used for computing the baseline average. Averaging baselines over time improves energy resolution measurement.</span>
<span class="c1">// ModNum is the module number which starts counting at 0. ChanNum is the channel number which starts counting at 0.</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">Pixie16BLcutFinder</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">,</span><span class="w"> </span><span class="c1">// module number</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ChanNum</span><span class="p">,</span><span class="c1">// channel number</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">BLcut</span><span class="w"> </span><span class="p">);</span><span class="w"> </span><span class="c1">// returned BLcut value</span>
</pre></div>
</div>
<p><strong>Return values description and error handling</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>0 Success</dt><dd><ul>
<li><p>None</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-1 Invalid Pixie-16 module number</dt><dd><ul>
<li><p>Check if ModNum is valid</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-2 Failed to collect baselines</dt><dd><ul>
<li><p>Reboot the module</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-3 Failed to read baselines from the data memory</dt><dd><ul>
<li><p>Check error message log file Pixie16msg.txt</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p><strong>Usage example</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">retval</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">,</span><span class="w"> </span><span class="n">ChanNum</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">BLcut</span><span class="p">;</span><span class="w"></span>

<span class="c1">// set to the first module</span>
<span class="n">ModNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>

<span class="c1">// set to the first channel</span>
<span class="n">ChanNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>

<span class="c1">// find the BLcut value</span>
<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16BLcutFinder</span><span class="p">(</span><span class="n">ModNum</span><span class="p">,</span><span class="w"> </span><span class="n">ChanNum</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">BLcut</span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// error handling</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="pixie16bootmodule">
<h3>Pixie16BootModule<a class="headerlink" href="#pixie16bootmodule" title="永久链接至标题">¶</a></h3>
<p>Boot modules so that they can be set up for data taking</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Use this function to boot Pixie-16 modules so that they can be set up for data taking. The function downloads to the Pixie-16 modules the communication (or system) FPGA configurations, signal processing FPGA configurations, trigger FPGA configurations (Revision A modules only), executable code for the digital signal processor (DSP), and DSP parameters.</span>
<span class="c1">// The FPGA configurations consist of a fixed number of words depending on the hardware mounted on the modules; the DSP codes have a length which depends on the actual compiled code; and the set of DSP parameters always consists of 1280 32-bit words for each module. The host software has to make the names of those boot data files on the hard disk available to the boot function.</span>
<span class="c1">// ModNum is the module number which starts counting at 0. If ModNum is set to be less than the total number of modules in the system, only the module specified by ModNum will be booted. But if ModNum is equal to the total number of modules in the system, e.g. there are 5 modules in the chassis and ModNum = 5, then all modules in the system will be booted.</span>
<span class="c1">// The boot pattern is a bit mask (shown below) indicating which on-board chip will be booted. Under normal circumstances, all on-board chips should be booted, i.e. the boot pattern would be 0x7F. For Rev-B, C, D, F modules, bit 1, i.e., “Boot trigger FPGA”, will be ignored even if that bit is set to 1.</span>
<span class="c1">// bit 0: Boot communication FPGA, All Pixie-16 Revisions</span>
<span class="c1">// bit 1: Boot trigger FPGA, Pixie-16 Revision A only</span>
<span class="c1">// bit 2: Boot signal processing FPGA, All Pixie-16 Revisions</span>
<span class="c1">// bit 3: Boot digital signal processor (DSP), All Pixie-16 Revisions</span>
<span class="c1">// bit 4: Download DSP I/O parameters, All Pixie-16 Revisions</span>
<span class="c1">// bit 5: Program on-board FPGAs, All Pixie-16 Revisions</span>
<span class="c1">// bit 6: Set on-board DACs, All Pixie-16 Revisions</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">Pixie16BootModule</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">ComFPGAConfigFile</span><span class="p">,</span><span class="w">     </span><span class="c1">// name of ComFPGA configuration file</span>
<span class="w">      </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">SPFPGAConfigFile</span><span class="p">,</span><span class="w">      </span><span class="c1">// name of SPFPGA configuration file</span>
<span class="w">      </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">TrigFPGAConfigFile</span><span class="p">,</span><span class="w">    </span><span class="c1">// name of trigger FPGA file</span>
<span class="w">      </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">DSPCodeFile</span><span class="p">,</span><span class="w">           </span><span class="c1">// name of DSP code file</span>
<span class="w">      </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">DSPParFile</span><span class="p">,</span><span class="w">            </span><span class="c1">// name of DSP parameter file</span>
<span class="w">      </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">DSPVarFile</span><span class="p">,</span><span class="w">            </span><span class="c1">// name of DSP variable names file</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">,</span><span class="w">       </span><span class="c1">// pixie-16 module number</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">BootPattern</span><span class="p">);</span><span class="w"> </span><span class="c1">// boot pattern bit mask</span>
</pre></div>
</div>
<p><strong>Return values description and error handling</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>0 Success</dt><dd><ul>
<li><p>None</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-1 Invalid Pixie-16 module number</dt><dd><ul>
<li><p>Correct ModNum</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-2 Size of ComFPGAConfigFile is invalid</dt><dd><ul>
<li><p>Correct ComFPGAConfigFile</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-3 Failed to boot Communication FPGA</dt><dd><ul>
<li><p>Check log file (Pixie16msg.txt)</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-4 Failed to allocate memory to store data in ComFPGAConfigFile</dt><dd><ul>
<li><p>Close other programs or reboot the computer</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-5 Failed to open ComFPGAConfigFile</dt><dd><ul>
<li><p>Correct ComFPGAConfigFile</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-10 Size of SPFPGAConfigFile is invalid</dt><dd><ul>
<li><p>Correct SPFPGAConfigFile</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-11 Failed to boot signal processing FPGA</dt><dd><ul>
<li><p>Check log file (Pixie16msg.txt)</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-12 Failed to allocate memory to store data in SPFPGAConfigFile</dt><dd><ul>
<li><p>Close other programs or reboot the computer</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-13 Failed to open SPFPGAConfigFile</dt><dd><ul>
<li><p>Correct SPFPGAConfigFile</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-14 Failed to boot DSP</dt><dd><ul>
<li><p>Check log file (Pixie16msg.txt)</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-15 Failed to allocate memory to store DSP executable code</dt><dd><ul>
<li><p>Close other programs or reboot the computer</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-16 Failed to open DSPCodeFile</dt><dd><ul>
<li><p>Correct DSPCodeFile</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-17 Size of DSPParFile is invalid</dt><dd><ul>
<li><p>Correct DSPParFile</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-18 Failed to open DSPParFile</dt><dd><ul>
<li><p>Correct DSPParFile</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-19 Can’t initialize DSP variable indices</dt><dd><ul>
<li><p>Correct DSPVarFile</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-20 Can’t copy DSP variable indices</dt><dd><ul>
<li><p>Check log file (Pixie16msg.txt)</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-21 Failed to program Fippi in a module</dt><dd><ul>
<li><p>Check log file (Pixie16msg.txt)</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-22 Failed to set DACs in a module</dt><dd><ul>
<li><p>Check log file (Pixie16msg.txt)</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-23 Failed to start RESET_ADC run in a module</dt><dd><ul>
<li><p>Check log file (Pixie16msg.txt)</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-24 RESET_ADC run timed out in a module</dt><dd><ul>
<li><p>Check log file (Pixie16msg.txt)</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p><strong>Usage example</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">retval</span><span class="p">;</span><span class="w"></span>
<span class="kt">char</span><span class="w"> </span><span class="n">ComFPGAConfigFile</span><span class="p">[</span><span class="mi">256</span><span class="p">],</span><span class="w"> </span><span class="n">SPFPGAConfigFile</span><span class="p">[</span><span class="mi">256</span><span class="p">];</span><span class="w"></span>
<span class="kt">char</span><span class="w"> </span><span class="n">TrigFPGAConfigFile</span><span class="p">[</span><span class="mi">256</span><span class="p">],</span><span class="w"> </span><span class="n">DSPCodeFile</span><span class="p">[</span><span class="mi">256</span><span class="p">],</span><span class="w"> </span><span class="n">DSPParFile</span><span class="p">[</span><span class="mi">256</span><span class="p">];</span><span class="w"></span>
<span class="kt">char</span><span class="w"> </span><span class="n">DSPVarFile</span><span class="p">[</span><span class="mi">256</span><span class="p">];</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">,</span><span class="w"> </span><span class="n">BootPattern</span><span class="p">;</span><span class="w"></span>

<span class="c1">// first, specify file names and paths for all boot data files</span>
<span class="n">sprintf</span><span class="p">(</span><span class="n">ComFPGAConfigFile</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;C:</span><span class="se">\\</span><span class="s">XIA</span><span class="se">\\</span><span class="s">Pixie16</span><span class="se">\\</span><span class="s">Firmware</span><span class="se">\\</span><span class="s">syspixie16.bin&quot;</span><span class="p">);</span><span class="w"></span>
<span class="n">sprintf</span><span class="p">(</span><span class="n">TrigFPGAConfigFile</span><span class="p">,</span><span class="w"> </span><span class="s">&quot; &quot;</span><span class="p">);</span><span class="w"></span>
<span class="n">sprintf</span><span class="p">(</span><span class="n">SPFPGAConfigFile</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;C:</span><span class="se">\\</span><span class="s">XIA</span><span class="se">\\</span><span class="s">Pixie16</span><span class="se">\\</span><span class="s">Firmware</span><span class="se">\\</span><span class="s">fippixie16.bin&quot;</span><span class="p">);</span><span class="w"></span>
<span class="n">sprintf</span><span class="p">(</span><span class="n">DSPCodeFile</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;C:</span><span class="se">\\</span><span class="s">XIA</span><span class="se">\\</span><span class="s">Pixie16</span><span class="se">\\</span><span class="s">DSP</span><span class="se">\\</span><span class="s">Pixie16DSP.ldr&quot;</span><span class="p">);</span><span class="w"></span>
<span class="n">sprintf</span><span class="p">(</span><span class="n">DSPParFile</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;C:</span><span class="se">\\</span><span class="s">XIA</span><span class="se">\\</span><span class="s">Pixie16</span><span class="se">\\</span><span class="s">Configuration</span><span class="se">\\</span><span class="s">default.set&quot;</span><span class="p">);</span><span class="w"></span>
<span class="n">sprintf</span><span class="p">(</span><span class="n">DSPVarFile</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;C:</span><span class="se">\\</span><span class="s">XIA</span><span class="se">\\</span><span class="s">Pixie16</span><span class="se">\\</span><span class="s">DSP</span><span class="se">\\</span><span class="s">Pixie16DSP.var&quot;</span><span class="p">);</span><span class="w"></span>

<span class="c1">// second, select the Pixie-16 module to boot. All modules in the system</span>
<span class="c1">// can be booted either one-by-one or all at once. The simplest way to</span>
<span class="c1">// boot all modules at once is to set ModNum to be equal to the total</span>
<span class="c1">// number of modules in the system. Here we assume there are total 5</span>
<span class="c1">// Pixie-16 modules.</span>
<span class="n">ModNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span><span class="w"></span>

<span class="c1">// third, specify the boot pattern. Normally, it should be 0x7F, i.e.</span>
<span class="c1">// all bits of the bit mask are selected.</span>
<span class="n">BootPattern</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x7F</span><span class="p">;</span><span class="w"></span>

<span class="c1">// finally, boot the selected modules</span>
<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16BootModule</span><span class="w"> </span><span class="p">(</span><span class="n">ComFPGAConfigFile</span><span class="p">,</span><span class="w"> </span><span class="n">SPFPGAConfigFile</span><span class="p">,</span><span class="w"></span>
<span class="n">TrigFPGAConfigFile</span><span class="p">,</span><span class="w"> </span><span class="n">DSPCodeFile</span><span class="p">,</span><span class="w"> </span><span class="n">DSPParFile</span><span class="p">,</span><span class="w"> </span><span class="n">DSPVarFile</span><span class="p">,</span><span class="w"> </span><span class="n">ModNum</span><span class="p">,</span><span class="w"></span>
<span class="n">BootPattern</span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// error handling</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="pixie16checkexternalfifostatus">
<h3>Pixie16CheckExternalFIFOStatus<a class="headerlink" href="#pixie16checkexternalfifostatus" title="永久链接至标题">¶</a></h3>
<p>Check status of external FIFO of a module</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Use this function to check the status of the external FIFO of a Pixie-16 module while a list mode data acquisition run is in progress. The function returns the number of words (32-bit) that the external FIFO currently has. If the number of words is greater than a user-set threshold, function Pixie16ReadDataFromExternalFIFO can then be used to read the data from the external FIFO.</span>
<span class="c1">// The threshold can be set by the user to either minimize reading overhead or to read data out of the FIFO as quickly as possible. The Pixie-16 API (pixie16app_defs.h) has defined a threshold with value of 1024 for external FIFO read out (EXTFIFO_READ_THRESH).</span>
<span class="c1">// *nFIFOWords returns the number of 32-bit words that the external FIFO currently has.</span>
<span class="c1">// ModNum is the module number which starts counting at 0.</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">Pixie16CheckExternalFIFOStatus</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">nFIFOWords</span><span class="p">,</span><span class="w">  </span><span class="c1">// returned number of words in the FIFO</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="w"> </span><span class="p">);</span><span class="w">   </span><span class="c1">// module number</span>
</pre></div>
</div>
<p><strong>Return values description and error handling</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>0 Success</dt><dd><ul>
<li><p>None</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-1 Invalid Pixie-16 module number</dt><dd><ul>
<li><p>Correct ModNum</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p><strong>Usage example</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">retval</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">nFIFOWords</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">;</span><span class="w"></span>

<span class="n">ModNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="c1">// the first module</span>
<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16CheckExternalFIFOStatus</span><span class="w"> </span><span class="p">(</span><span class="o">&amp;</span><span class="n">nFIFOWords</span><span class="p">,</span><span class="w"> </span><span class="n">ModNum</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="pixie16checkrunstatus">
<h3>Pixie16CheckRunStatus<a class="headerlink" href="#pixie16checkrunstatus" title="永久链接至标题">¶</a></h3>
<p>Check status of a data acquisition run</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Use this function to check the run status of a Pixie-16 module while a list mode data acquisition run is in progress. If the run is still in progress continue polling.</span>
<span class="c1">// If the return code of this function indicates the run has finished, there might still be some data in the external FIFO (Rev-B, C, D, F modules) that need to be read out to the host computer. In addition, final run statistics and histogram data are available for reading out too.</span>
<span class="c1">// In MCA histogram run mode, this function can also be called to check if the run is still in progress even though it is normally self-terminating.</span>
<span class="c1">// ModNum is the module number which starts counting at 0.</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">Pixie16CheckRunStatus</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="w"> </span><span class="p">);</span><span class="w"> </span><span class="c1">// module number</span>
</pre></div>
</div>
<p><strong>Return values description and error handling</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>0 No run is in progress</dt><dd><ul>
<li><p>None</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>1 Run is still in progress</dt><dd><ul>
<li><p>None</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-1 Invalid Pixie-16 module number</dt><dd><ul>
<li><p>Correct ModNum</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p><strong>Usage example</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">retval</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">;</span><span class="w"></span>

<span class="n">ModNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="c1">// the first module</span>
<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16CheckRunStatus</span><span class="p">(</span><span class="n">ModNum</span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// invalid module number</span>
<span class="p">}</span><span class="w"></span>
<span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// run is still in progress</span>
<span class="p">}</span><span class="w"></span>
<span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// run has finished</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="pixie16computefastfiltersoffline">
<h3>Pixie16ComputeFastFiltersOffline<a class="headerlink" href="#pixie16computefastfiltersoffline" title="永久链接至标题">¶</a></h3>
<p>Compute fast filter response for offline analysis</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Use this function to compute fast filter responses of each event in the list mode data file for offline analysis. The algorithm implemented in this offline analysis function is equivalent to the one implemented in the Pixie-16 hardware. So this function can be used to analyze how the leading edge fast trigger filter and the CFD filter implemented in the hardware respond to the shape of recorded traces. By analyzing the response of these filters, it is possible to optimize the performance of the leading edge trigger or CFD trigger by adjusting the fast filter and CFD parameters offline. Such optimized parameters can then be saved to a settings file to be used for online data acquisition.</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">Pixie16ComputeFastFiltersOffline</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">FileName</span><span class="p">,</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="n">mode</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="p">(</span><span class="n">with</span><span class="w"> </span><span class="n">complete</span><span class="w"> </span><span class="n">path</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModuleNumber</span><span class="p">,</span><span class="w"> </span><span class="c1">// the module to be analyzed</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ChannelNumber</span><span class="p">,</span><span class="w"> </span><span class="c1">// the channel to be analyzed</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">FileLocation</span><span class="p">,</span><span class="w"> </span><span class="c1">// the location of the trace in the file</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">RcdTraceLength</span><span class="p">,</span><span class="c1">// recorded trace length</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="o">*</span><span class="n">RcdTrace</span><span class="p">,</span><span class="w"> </span><span class="c1">// recorded trace</span>
<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">fastfilter</span><span class="p">,</span><span class="w"> </span><span class="c1">// fast filter response</span>
<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">cfd</span><span class="w"> </span><span class="p">);</span><span class="w"> </span><span class="c1">// cfd response</span>
</pre></div>
</div>
<p><strong>Return values description and error handling</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>0 Success</dt><dd><ul>
<li><p>None</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-1 Null pointer RcdTrace</dt><dd><ul>
<li><p>Make sure RcdTrace has been allocated enough memory (maximum possible length is 32768, but can be shorter to match the actual trace length)</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-2 Null pointer fastfilter</dt><dd><ul>
<li><p>Make sure fastfilter has been allocated enough memory (maximum possible length is 32768, but can be shorter to match the actual trace length)</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-3 Null pointer cfd</dt><dd><ul>
<li><p>Make sure cfd has been allocated enough memory (maximum possible length is 32768, but can be shorter to match the actual trace length)</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-4 Target module number is invalid</dt><dd><ul>
<li><p>Correct ModuleNumber</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-5 Trace length is too short</dt><dd><ul>
<li><p>The length of recorded trace is too short for the offline analysis using the fast filter length (fast filter rise time and flat top). Either a different settings file with shorter fast filter length has to be used, or new traces with longer trace length have to be acquired</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-6 Failed to open list mode data file</dt><dd><ul>
<li><p>Check the list mode file name and its path are correct</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p><strong>Usage example</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">retval</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModuleNumber</span><span class="p">,</span><span class="w"> </span><span class="n">ChannelNumber</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">FileLocation</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">RcdTraceLength</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">RcdTrace</span><span class="p">[</span><span class="mi">1000</span><span class="p">];</span><span class="w"></span>
<span class="kt">double</span><span class="w"> </span><span class="n">fastfilter</span><span class="p">[</span><span class="mi">1000</span><span class="p">];</span><span class="w"></span>
<span class="kt">double</span><span class="w"> </span><span class="n">cfd</span><span class="p">[</span><span class="mi">1000</span><span class="p">];</span><span class="w"></span>

<span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">FileName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;C:</span><span class="se">\\</span><span class="s">XIA</span><span class="se">\\</span><span class="s">Pixie16</span><span class="se">\\</span><span class="s">PulseShape</span><span class="se">\\</span><span class="s">listmodedata.bin&quot;</span><span class="p">};</span><span class="w"></span>
<span class="n">ModuleNumber</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">      </span><span class="c1">//the first module</span>
<span class="n">ChannelNumber</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">     </span><span class="c1">//the first channel</span>
<span class="n">FileLocation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">16</span><span class="p">;</span><span class="w">     </span><span class="c1">//the starting address of the trace in the list mode data file (32-bit word address)</span>
<span class="n">RcdTraceLength</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1000</span><span class="p">;</span><span class="w"> </span><span class="c1">//the length of the recorded trace</span>

<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16ComputeFastFiltersOffline</span><span class="w"> </span><span class="p">(</span><span class="n">FileName</span><span class="p">,</span><span class="w"> </span><span class="n">ModuleNumber</span><span class="p">,</span><span class="w"></span>
<span class="n">ChannelNumber</span><span class="p">,</span><span class="w"> </span><span class="n">FileLocation</span><span class="p">,</span><span class="w"> </span><span class="n">RcdTrace</span><span class="p">,</span><span class="w"> </span><span class="n">fastfilter</span><span class="p">,</span><span class="w"> </span><span class="n">cfd</span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// error handling</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="pixie16computeinputcountrate">
<h3>Pixie16ComputeInputCountRate<a class="headerlink" href="#pixie16computeinputcountrate" title="永久链接至标题">¶</a></h3>
<p>Compute input count rate of a channel</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Use this function to calculate the input count rate on one channel of a Pixie-16 module. This function does not communicate with Pixie-16 modules. Before calling this function, another function, Pixie16ReadStatisticsFromModule, should be called to read statistics data from the module.</span>
<span class="c1">// *Statistics is a pointer to an array whose size is exactly 448 unsigned integer words (32-bit). The *Statistics array is filled with data from a Pixie-16 module after calling function Pixie16ReadStatisticsFromModule. ModNum is the module number which starts counting at 0. ChanNum is the channel number which starts counting at 0.</span>
<span class="kt">double</span><span class="w"> </span><span class="nf">Pixie16ComputeInputCountRate</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">Statistics</span><span class="p">,</span><span class="c1">// run statistics data</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">,</span><span class="w">   </span><span class="c1">// module number</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ChanNum</span><span class="w"> </span><span class="p">);</span><span class="c1">// channel number</span>
</pre></div>
</div>
<p><strong>Return values description and error handling</strong></p>
<p>The return value is the input count rate in counts per second.</p>
<p><strong>Usage example</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">double</span><span class="w"> </span><span class="n">icr</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">Statistics</span><span class="p">[</span><span class="mi">448</span><span class="p">];</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">,</span><span class="w"> </span><span class="n">ChanNum</span><span class="p">;</span><span class="w"></span>
<span class="kt">int</span><span class="w"> </span><span class="n">retval</span><span class="p">;</span><span class="w"></span>

<span class="n">ModNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">  </span><span class="c1">// the first module</span>
<span class="n">ChanNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="c1">// the first channel</span>

<span class="c1">// first call Pixie16ReadStatisticsFromModule to get the statistics data</span>
<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16ReadStatisticsFromModule</span><span class="w"> </span><span class="p">(</span><span class="n">Statistics</span><span class="p">,</span><span class="w"> </span><span class="n">ModNum</span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// error handling</span>
<span class="p">}</span><span class="w"></span>

<span class="c1">// compute input count rate</span>
<span class="n">icr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16ComputeInputCountRate</span><span class="w"> </span><span class="p">(</span><span class="n">Statistics</span><span class="p">,</span><span class="w"> </span><span class="n">ModNum</span><span class="p">,</span><span class="w"> </span><span class="n">ChanNum</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="pixie16computelivetime">
<h3>Pixie16ComputeLiveTime<a class="headerlink" href="#pixie16computelivetime" title="永久链接至标题">¶</a></h3>
<p>Compute live time that a channel accumulated in a run</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Use this function to calculate the live time that one channel of a Pixie-16 module has spent on data acquisition. This function does not communicate with Pixie-16 modules. Before calling this function, another function, Pixie16ReadStatisticsFromModule, should be called to read statistics data from the module.</span>
<span class="c1">// *Statistics is a pointer to an array whose size is exactly 448 unsigned integer words (32-bit). The *Statistics array is filled with data from a Pixie-16 module after calling function Pixie16ReadStatisticsFromModule. ModNum is the module number which starts counting at 0. ChanNum is the channel number which starts counting at 0.</span>
<span class="kt">double</span><span class="w"> </span><span class="nf">Pixie16ComputeLiveTime</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">Statistics</span><span class="p">,</span><span class="w"> </span><span class="c1">// run statistics data</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">,</span><span class="w">    </span><span class="c1">// module number</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ChanNum</span><span class="w"> </span><span class="p">);</span><span class="w"> </span><span class="c1">// channel number</span>
</pre></div>
</div>
<p><strong>Return values description and error handling</strong></p>
<p>The return value is the live time in seconds.</p>
<p><strong>Usage example</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">double</span><span class="w"> </span><span class="n">livetime</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">Statistics</span><span class="p">[</span><span class="mi">448</span><span class="p">];</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">,</span><span class="w"> </span><span class="n">ChanNum</span><span class="p">;</span><span class="w"></span>
<span class="kt">int</span><span class="w"> </span><span class="n">retval</span><span class="p">;</span><span class="w"></span>

<span class="n">ModNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="c1">// the first module</span>
<span class="n">ChanNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="c1">// the first channel</span>

<span class="c1">// first call Pixie16ReadStatisticsFromModule to get the statistics data</span>
<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16ReadStatisticsFromModule</span><span class="w"> </span><span class="p">(</span><span class="n">Statistics</span><span class="p">,</span><span class="w"> </span><span class="n">ModNum</span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// error handling</span>
<span class="p">}</span><span class="w"></span>

<span class="c1">// compute live time</span>
<span class="n">livetime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16ComputeLiveTime</span><span class="w"> </span><span class="p">(</span><span class="n">Statistics</span><span class="p">,</span><span class="w"> </span><span class="n">ModNum</span><span class="p">,</span><span class="w"> </span><span class="n">ChanNum</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="pixie16computeoutputcountrate">
<h3>Pixie16ComputeOutputCountRate<a class="headerlink" href="#pixie16computeoutputcountrate" title="永久链接至标题">¶</a></h3>
<p>Compute output count rate of a channel</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Use this function to calculate the output count rate on one channel of a Pixie-16 module. This function does not communicate with Pixie-16 modules. Before calling this function, another function, Pixie16ReadStatisticsFromModule, should be called to read statistics data from the module.</span>
<span class="c1">// *Statistics is a pointer to an array whose size is exactly 448 unsigned integer words (32-bit). The *Statistics array is filled with data from a Pixie-16 module after calling function Pixie16ReadStatisticsFromModule. ModNum is the module number which starts counting at 0. ChanNum is the channel number which starts counting at 0.</span>
<span class="kt">double</span><span class="w"> </span><span class="nf">Pixie16ComputeOutputCountRate</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">Statistics</span><span class="p">,</span><span class="w"> </span><span class="c1">// run statistics data</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">,</span><span class="w">    </span><span class="c1">// module number</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ChanNum</span><span class="w"> </span><span class="p">);</span><span class="w"> </span><span class="c1">// channel number</span>
</pre></div>
</div>
<p><strong>Return values description and error handling</strong></p>
<p>The return value is the output count rate in counts per second.</p>
<p><strong>Usage example</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">double</span><span class="w"> </span><span class="n">ocr</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">Statistics</span><span class="p">[</span><span class="mi">448</span><span class="p">];</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">,</span><span class="w"> </span><span class="n">ChanNum</span><span class="p">;</span><span class="w"></span>
<span class="kt">int</span><span class="w"> </span><span class="n">retval</span><span class="p">;</span><span class="w"></span>

<span class="n">ModNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">  </span><span class="c1">// the first module</span>
<span class="n">ChanNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="c1">// the first channel</span>

<span class="c1">// first call Pixie16ReadStatisticsFromModule to get the statistics data</span>
<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16ReadStatisticsFromModule</span><span class="p">(</span><span class="n">Statistics</span><span class="p">,</span><span class="w"> </span><span class="n">ModNum</span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// error handling</span>
<span class="p">}</span><span class="w"></span>

<span class="c1">// compute output count rate</span>
<span class="n">ocr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16ComputeOutputCountRate</span><span class="p">(</span><span class="n">Statistics</span><span class="p">,</span><span class="w"> </span><span class="n">ModNum</span><span class="p">,</span><span class="w"> </span><span class="n">ChanNum</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="pixie16computeprocessedevents">
<h3>Pixie16ComputeProcessedEvents<a class="headerlink" href="#pixie16computeprocessedevents" title="永久链接至标题">¶</a></h3>
<p>Compute number of events processed by a module</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Use this function to calculate the number of events that have been processed by a Pixie-16 module during a data acquisition run. This function is only used by Rev-A modules. This function does not communicate with Pixie-16 modules. Before calling this function, another function, Pixie16ReadStatisticsFromModule, should be called to read statistics data from the module first.</span>
<span class="c1">// *Statistics is a pointer to an array whose size is exactly 448 unsigned integer words (32-bit). The *Statistics array is filled with data from a Pixie-16 module after calling function Pixie16ReadStatisticsFromModule. ModNum is the module number which starts counting at 0. ChanNum is the channel number which starts counting at 0.</span>
<span class="kt">double</span><span class="w"> </span><span class="nf">Pixie16ComputeProcessedEvents</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="o">*</span><span class="n">Statistics</span><span class="p">,</span><span class="c1">// run statistics data</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="w"> </span><span class="p">);</span><span class="w">  </span><span class="c1">// module number</span>
</pre></div>
</div>
<p><strong>Return values description and error handling</strong></p>
<p>The return value is the number of processed events.</p>
<p><strong>Usage example</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">double</span><span class="w"> </span><span class="n">NumEvents</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">Statistics</span><span class="p">[</span><span class="mi">448</span><span class="p">];</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">;</span><span class="w"></span>
<span class="kt">int</span><span class="w"> </span><span class="n">retval</span><span class="p">;</span><span class="w"></span>

<span class="n">ModNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="c1">// the first module</span>

<span class="c1">// first call Pixie16ReadStatisticsFromModule to get the statistics data</span>
<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16ReadStatisticsFromModule</span><span class="p">(</span><span class="n">Statistics</span><span class="p">,</span><span class="w"> </span><span class="n">ModNum</span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// error handling</span>
<span class="p">}</span><span class="w"></span>

<span class="c1">// compute number of processed events</span>
<span class="n">NumEvents</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16ComputeProcessedEvents</span><span class="p">(</span><span class="n">Statistics</span><span class="p">,</span><span class="w"> </span><span class="n">ModNum</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="pixie16computerealtime">
<h3>Pixie16ComputeRealTime<a class="headerlink" href="#pixie16computerealtime" title="永久链接至标题">¶</a></h3>
<p>Compute real time that a module accumulated in a run</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Use this function to calculate the real time that a Pixie-16 module has spent on data acquisition. This function does not communicate with Pixie-16 modules. Before calling this function, another function, Pixie16ReadStatisticsFromModule, should be called to read statistics data from the module.</span>
<span class="c1">// *Statistics is a pointer to an array whose size is exactly 448 unsigned integer words (32-bit). The *Statistics array is filled with data from a Pixie-16 module after calling function Pixie16ReadStatisticsFromModule. ModNum is the module number which starts counting at 0. ChanNum is the channel number which starts counting at 0.</span>
<span class="kt">double</span><span class="w"> </span><span class="nf">Pixie16ComputeRealTime</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">Statistics</span><span class="p">,</span><span class="c1">// run statistics data</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="w"> </span><span class="p">);</span><span class="w"> </span><span class="c1">// module number</span>
</pre></div>
</div>
<p><strong>Return values description and error handling</strong></p>
<p>The return value is the real time in seconds.</p>
<p><strong>Usage example</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">double</span><span class="w"> </span><span class="n">realtime</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">Statistics</span><span class="p">[</span><span class="mi">448</span><span class="p">];</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">;</span><span class="w"></span>
<span class="kt">int</span><span class="w"> </span><span class="n">retval</span><span class="p">;</span><span class="w"></span>
<span class="n">ModNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="c1">// the first module</span>

<span class="c1">// first call Pixie16ReadStatisticsFromModule to get the statistics data</span>
<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16ReadStatisticsFromModule</span><span class="p">(</span><span class="n">Statistics</span><span class="p">,</span><span class="w"> </span><span class="n">ModNum</span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// error handling</span>
<span class="p">}</span><span class="w"></span>

<span class="c1">// compute real time</span>
<span class="n">realtime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16ComputeRealTime</span><span class="p">(</span><span class="n">Statistics</span><span class="p">,</span><span class="w"> </span><span class="n">ModNum</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="pixie16computeslowfiltersoffline">
<h3>Pixie16ComputeSlowFiltersOffline<a class="headerlink" href="#pixie16computeslowfiltersoffline" title="永久链接至标题">¶</a></h3>
<p>Compute slow filter response for offline analysis</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Use this function to compute slow filter responses of each event in the list mode data file for offline analysis. The algorithm implemented in this offline analysis function is equivalent to the one implemented in the Pixie-16 hardware. So this function can be used to analyze how the slow filter implemented in the hardware for computing event energy responds to the shape of recorded traces. By analyzing the responses of these filters, it is possible to optimize the performance of the slow filter by adjusting its parameters offline. Such optimized parameters can then be saved to a settings file to be used for online data acquisition.</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">Pixie16ComputeSlowFiltersOffline</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">FileName</span><span class="p">,</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="n">mode</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="p">(</span><span class="n">with</span><span class="w"> </span><span class="n">complete</span><span class="w"> </span><span class="n">path</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModuleNumber</span><span class="p">,</span><span class="w"> </span><span class="c1">// the module to be analyzed</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ChannelNumber</span><span class="p">,</span><span class="w"> </span><span class="c1">// the channel to be analyzed</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">FileLocation</span><span class="p">,</span><span class="w"> </span><span class="c1">// the location of the trace in the file</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">RcdTraceLength</span><span class="p">,</span><span class="c1">// recorded trace length</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="o">*</span><span class="n">RcdTrace</span><span class="p">,</span><span class="c1">// recorded trace</span>
<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">slowfilter</span><span class="p">);</span><span class="c1">// slow filter response</span>
</pre></div>
</div>
<p><strong>Return values description and error handling</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>0 Success</dt><dd><ul>
<li><p>None</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-1 Null pointer RcdTrace</dt><dd><ul>
<li><p>Make sure RcdTrace has been allocated enough memory (maximum possible length is 32768, but can be shorter to match the actual trace length)</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-2 Null pointer slowfilter</dt><dd><ul>
<li><p>Make sure slowfilter has been allocated enough memory (maximum possible length is 32768, but can be shorter to match the actual trace length)</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-3 Target module number is invalid</dt><dd><ul>
<li><p>Correct ModuleNumber</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-4 Trace length is too short</dt><dd><ul>
<li><p>The length of recorded trace is too short for the offline analysis using the slow filter length (slow filter rise time and flat top). Either a different settings file with shorter slow filter length has to be used, or new traces with longer trace length have to be acquired</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-5 Failed to open list mode data file</dt><dd><ul>
<li><p>Check the list mode file name and its path are correct</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p><strong>Usage example</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">retval</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModuleNumber</span><span class="p">,</span><span class="w"> </span><span class="n">ChannelNumber</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">FileLocation</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">RcdTraceLength</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">RcdTrace</span><span class="p">[</span><span class="mi">1000</span><span class="p">];</span><span class="w"></span>
<span class="kt">double</span><span class="w"> </span><span class="n">slowfilter</span><span class="p">[</span><span class="mi">1000</span><span class="p">];</span><span class="w"></span>

<span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">FileName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;C:</span><span class="se">\\</span><span class="s">XIA</span><span class="se">\\</span><span class="s">Pixie16</span><span class="se">\\</span><span class="s">PulseShape</span><span class="se">\\</span><span class="s">listmodedata.bin&quot;</span><span class="p">};</span><span class="w"></span>

<span class="n">ModuleNumber</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">     </span><span class="c1">// the first module</span>
<span class="n">ChannelNumber</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">    </span><span class="c1">// the first channel</span>
<span class="n">FileLocation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">16</span><span class="p">;</span><span class="w">    </span><span class="c1">// the starting address of the trace in the list mode data file (32-bit word address)</span>
<span class="n">RcdTraceLength</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1000</span><span class="p">;</span><span class="c1">// the length of the recorded trace</span>

<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16ComputeSlowFiltersOffline</span><span class="w"> </span><span class="p">(</span><span class="n">FileName</span><span class="p">,</span><span class="w"> </span><span class="n">ModuleNumber</span><span class="p">,</span><span class="w"></span>
<span class="n">ChannelNumber</span><span class="p">,</span><span class="w"> </span><span class="n">FileLocation</span><span class="p">,</span><span class="w"> </span><span class="n">RcdTrace</span><span class="p">,</span><span class="w"> </span><span class="n">slowfilter</span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// error handling</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="pixie16controltaskrun">
<h3>Pixie16ControlTaskRun<a class="headerlink" href="#pixie16controltaskrun" title="永久链接至标题">¶</a></h3>
<p>Execute special control tasks</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Use this function to execute special control tasks. This may include programming the Fippi or setting the DACs after downloading DSP parameters.</span>
<span class="c1">// ModNum is the module number which starts counting at 0. ChanNum is the channel number which starts counting at 0.</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">Pixie16ControlTaskRun</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">,</span><span class="w">     </span><span class="c1">// module number</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ControlTask</span><span class="p">,</span><span class="c1">// control task run type</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">Max_Poll</span><span class="w"> </span><span class="p">);</span><span class="w">   </span><span class="c1">// Timeout control in unit of ms</span>
</pre></div>
</div>
<p><strong>Return values description and error handling</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>0 Success</dt><dd><ul>
<li><p>None</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-1 Invalid Pixie-16 module number</dt><dd><ul>
<li><p>Correct ModNum</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-2 The control task run failed</dt><dd><ul>
<li><p>Reboot the module</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p><strong>Usage example</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">retval</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ControlTask</span><span class="p">,</span><span class="w"> </span><span class="n">ModNum</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">Max_Poll</span><span class="p">;</span><span class="w"></span>

<span class="n">ModNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">            </span><span class="c1">// this is the first module</span>
<span class="n">ControlTask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SET_DACS</span><span class="p">;</span><span class="c1">// constant SET_DACS defined in header file</span>
<span class="n">Max_Poll</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10000</span><span class="p">;</span><span class="w">      </span><span class="c1">// give the run 10 seconds to finish</span>

<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16ControlTaskRun</span><span class="w"> </span><span class="p">(</span><span class="n">ControlTask</span><span class="p">,</span><span class="w"> </span><span class="n">ModNum</span><span class="p">,</span><span class="w"> </span><span class="n">Max_Poll</span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// Error handling</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="pixie16copydspparameters">
<h3>Pixie16CopyDSPParameters<a class="headerlink" href="#pixie16copydspparameters" title="永久链接至标题">¶</a></h3>
<p>Copy DSP parameters from a module to others</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Use this function to copy DSP parameters from one module to the others that are installed in the system.</span>
<span class="c1">// BitMask is bit pattern which designates which items should be copied from the source module to the destination module(s).</span>
<span class="c1">// Bit 0: Filter (energy and trigger)</span>
<span class="c1">// Bit 1: Analog signal conditioning (polarity, dc-offset, gain/attenuation)</span>
<span class="c1">// Bit 2: Histogram control (minimum energy, binning factor)</span>
<span class="c1">// Bit 3: Decay time</span>
<span class="c1">// Bit 4: Pulse shape analysis (trace length and trace delay)</span>
<span class="c1">// Bit 5: Baseline control (baseline cut, baseline percentage)</span>
<span class="c1">// Bit 7: Channel CSRA register (good channel, trigger enabled, etc.)</span>
<span class="c1">// Bit 8: CFD trigger (CFD delay, scaling factor)</span>
<span class="c1">// Bit 9: Trigger stretch lengths (veto, external trigger, etc.)</span>
<span class="c1">// Bit 10: FIFO delays (analog input delay, fast trigger output delay, etc.)</span>
<span class="c1">// Bit 11: Multiplicity (bit masks, thresholds, etc.)</span>
<span class="c1">// Bit 12: QDC (QDC sum lengths)</span>
<span class="c1">// SourceModule and SourceChannel is the module and channel number of the source of the DSP parameters which are to be copied to other modules and channels.</span>
<span class="c1">// DestinationMask is an array which indicates the channel and module whose settings will be copied from the source channel and module. For instance, if there are 5 modules (total 80 channels) in the system, DestinationMask would be defined as DestinationMask[80], where DestinationMask[0] to DestinationMask[15] would select channel 0 to 15 of module 0, DestinationMask[16] to DestinationMask[31] would select channel 0 to 15 of module 1, and so on. If a given channel i is to be copied, then DestinationMask[i] should be set to 1, otherwise, it should be set to 0.</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">Pixie16CopyDSPParameters</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">BitMask</span><span class="p">,</span><span class="w">           </span><span class="c1">// copy items bit mask</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">SourceModule</span><span class="p">,</span><span class="w">      </span><span class="c1">// source module</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">SourceChannel</span><span class="p">,</span><span class="w">     </span><span class="c1">// source channel</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="o">*</span><span class="n">DestinationMask</span><span class="w"> </span><span class="p">);</span><span class="c1">// destination bit mask</span>
</pre></div>
</div>
<p><strong>Return values description and error handling</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>0 Success</dt><dd><ul>
<li><p>None</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-1 Failed to program Fippi in a module</dt><dd><ul>
<li><p>Reboot the modules</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-2 Failed to set DACs in a module</dt><dd><ul>
<li><p>Reboot the modules</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p><strong>Usage example</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">retval</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">BitMask</span><span class="p">;</span><span class="w">             </span><span class="c1">//copy items bit mask</span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">SourceModule</span><span class="p">;</span><span class="w">        </span><span class="c1">//source module</span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">SourceChannel</span><span class="p">;</span><span class="w">       </span><span class="c1">//source channel</span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">DestinationMask</span><span class="p">[</span><span class="mi">384</span><span class="p">];</span><span class="c1">//destination bit mask</span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">k</span><span class="p">;</span><span class="w"></span>

<span class="n">BitMask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x1FF</span><span class="p">;</span><span class="w">  </span><span class="c1">// copy everything</span>
<span class="n">SourceModule</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="c1">// the first module</span>
<span class="n">SourceChannel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="c1">// the first channel</span>

<span class="c1">// assume there are 6 Pixie-16 modules in the system</span>
<span class="k">for</span><span class="p">(</span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="p">(</span><span class="mi">6</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">16</span><span class="p">);</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">++</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="n">DestinationMask</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="c1">// copy to all channels of all modules</span>
<span class="p">}</span><span class="w"></span>

<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16CopyDSPParameters</span><span class="w"> </span><span class="p">(</span><span class="n">BitMask</span><span class="p">,</span><span class="w"> </span><span class="n">SourceModule</span><span class="p">,</span><span class="w"> </span><span class="n">SourceChannel</span><span class="p">,</span><span class="w"></span>
<span class="n">DestinationMask</span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// error handling</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="pixie16embufferio">
<h3>Pixie16EMbufferIO<a class="headerlink" href="#pixie16embufferio" title="永久链接至标题">¶</a></h3>
<p>Transfer data between host and DSP external memory</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Use this function to directly read data from or write data to the on-board external memory of a Pixie-16 module. The valid memory address is from 0x0 to 0x7FFFF (32-bit wide). Use Direction = 1 for read and Direction = 0 for write.</span>
<span class="c1">// The external memory is used to store the histogram data accumulated for each of the 16 channels of a Pixie-16 module. Each channel has a fixed histogram length of 32768 words (32-bit wide), and the placement of the histogram data in the memory is in the same order of the channel number, i.e. channel 0 occupies memory address 0x0 to 0x7FFF, channel 1 occupies 0x8000 to 0xFFFF, and so on.</span>
<span class="c1">// NOTE: another function Pixie16ReadHistogramFromModule can also be used to read out the histograms except that it needs to be called channel by channel.</span>
<span class="c1">// ModNum is the module number which starts counting at 0.</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">Pixie16EMbufferIO</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">Buffer</span><span class="p">,</span><span class="c1">// buffer data</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">NumWords</span><span class="p">,</span><span class="w"> </span><span class="c1">// number of buffer words to read or write</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">Address</span><span class="p">,</span><span class="c1">// buffer address</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">Direction</span><span class="p">,</span><span class="w"> </span><span class="c1">// I/O direction</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="w"> </span><span class="p">);</span><span class="w"> </span><span class="c1">//module number</span>
</pre></div>
</div>
<p><strong>Return values description and error handling</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>0 Success</dt><dd><ul>
<li><p>None</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-1 null pointer for buffer data</dt><dd><ul>
<li><p>Correct pointer Buffer</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-2 number of buffer words exceeds the limit</dt><dd><ul>
<li><p>Reduce the number of buffer words</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-3 invalid DSP external memory address</dt><dd><ul>
<li><p>Use the valid address</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-4 invalid I/O direction</dt><dd><ul>
<li><p>Use the valid direction</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-5 invalid Pixie-16 module number</dt><dd><ul>
<li><p>Correct the ModNum</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-6 I/O Failure</dt><dd><ul>
<li><p>Reboot the module</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p><strong>Usage example</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">retval</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">Direction</span><span class="p">,</span><span class="w"> </span><span class="n">ModNum</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">MCAData</span><span class="p">[</span><span class="mi">32768</span><span class="p">],</span><span class="w"> </span><span class="n">NumWords</span><span class="p">,</span><span class="w"> </span><span class="n">Address</span><span class="p">;</span><span class="w"></span>
<span class="n">NumWords</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">32768</span><span class="p">;</span><span class="c1">//to read out the MCA data from channel 0</span>
<span class="n">ModNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">    </span><span class="c1">//the first module in the system</span>
<span class="n">Address</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x0</span><span class="p">;</span><span class="w">         </span><span class="c1">//the starting memory address</span>
<span class="n">Direction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w">         </span><span class="c1">//I/O direction is read</span>

<span class="c1">// read out the MCA data for Channel 0</span>
<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16EMbufferIO</span><span class="w"> </span><span class="p">(</span><span class="n">MCAData</span><span class="p">,</span><span class="w"> </span><span class="n">NumWords</span><span class="p">,</span><span class="w"> </span><span class="n">Address</span><span class="p">,</span><span class="w"> </span><span class="n">Direction</span><span class="p">,</span><span class="w"> </span><span class="n">ModNum</span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// Error handling</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="pixie16endrun">
<h3>Pixie16EndRun<a class="headerlink" href="#pixie16endrun" title="永久链接至标题">¶</a></h3>
<p>Stop a data acquisition run</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Use this function to end a histogram run, or to force the end of a list mode run. In a multi-module system, if all modules are running synchronously, only one module needs to be addressed this way. It will immediately stop the run in all other module in the system. ModNum is the module number which starts counting at 0.</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">Pixie16EndRun</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="w"> </span><span class="p">);</span><span class="c1">// module number</span>
</pre></div>
</div>
<p><strong>Return values description and error handling</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>0 Success</dt><dd><ul>
<li><p>None</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-1 Invalid Pixie-16 module number</dt><dd><ul>
<li><p>Correct ModNum</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-2 Failed to stop the run</dt><dd><ul>
<li><p>Reboot the module</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p><strong>Usage example</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">retval</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">;</span><span class="w"></span>
<span class="n">ModNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="c1">// the first module</span>
<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16EndRun</span><span class="w"> </span><span class="p">(</span><span class="n">ModNum</span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// error handling</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="pixie16exitsystem">
<h3>Pixie16ExitSystem<a class="headerlink" href="#pixie16exitsystem" title="永久链接至标题">¶</a></h3>
<p>Release user virtual addressees assigned to modules</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Use this function to release the user virtual addressees that are assigned to Pixie-16 modules when these modules are initialized by function Pixie16InitSystem. This function should be called before a user’s application exits.</span>
<span class="c1">// If ModNum is set to less than the total number of modules in the system, only the module specified by ModNum will be closed. But if ModNum is equal to the total number of modules in the system, e.g. there are 5 modules in the chassis and ModNum = 5, then all modules in the system will be closed altogether. Note that the modules are counted starting at 0.</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">Pixie16ExitSystem</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="w"> </span><span class="p">);</span><span class="w"> </span><span class="c1">// Pixie-16 module number</span>
</pre></div>
</div>
<p><strong>Return values description and error handling</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>0 Success</dt><dd><ul>
<li><p>None</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-1 Invalid Pixie-16 module number</dt><dd><ul>
<li><p>Correct ModNum (it should not be greater than the total number of modules in the system)</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-2 Failed to close Pixie-16 modules</dt><dd><ul>
<li><p>Check error message log file Pixie16msg.txt</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p><strong>Usage example</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">retval</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="p">;</span><span class="w"></span>

<span class="c1">// assume there are totally 5 modules in the system</span>
<span class="c1">// so close all 5 modules</span>
<span class="n">ModNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span><span class="w"></span>
<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16ExitSystem</span><span class="w"> </span><span class="p">(</span><span class="n">ModNum</span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// error handling</span>
<span class="p">}</span><span class="w"></span>

<span class="c1">// or module by module</span>
<span class="k">for</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">k</span><span class="o">&lt;</span><span class="mi">5</span><span class="p">;</span><span class="w"> </span><span class="n">k</span><span class="o">++</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16ExitSystem</span><span class="w"> </span><span class="p">(</span><span class="n">k</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="c1">// error handling</span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="pixie16geteventsinfo">
<h3>Pixie16GetEventsInfo<a class="headerlink" href="#pixie16geteventsinfo" title="永久链接至标题">¶</a></h3>
<p>Get detailed events information from a data file</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Use this function to retrieve the detailed information (except waveforms) of each event in the list mode data file for the designated module. ModNum is the module number which starts counting at 0. ChanNum is the channel number which starts counting at 0.</span>
<span class="c1">// Before calling this function to get the individual events information, another function Pixie16GetModuleEvents should be called first to determine the number of events that have been recorded for each module. If the number of events for a given module is nEvents, a memory block *EventInformation should be allocated with a length of (nEvents*68):</span>
<span class="c1">// EventInformation = (unsigned int *)malloc(sizeof(unsigned int) * nEvents * 68);</span>
<span class="c1">// where 68 is the length of the information records of each event (energy, timestamps, etc.) and has the following structure.</span>
<span class="c1">// EventInformation [0] Event number</span>
<span class="c1">// EventInformation [1] Channel number</span>
<span class="c1">// EventInformation [2] Slot number</span>
<span class="c1">// EventInformation [3] Crate number</span>
<span class="c1">// EventInformation [4] Header length</span>
<span class="c1">// EventInformation [5] Event length</span>
<span class="c1">// EventInformation [6] Finish code</span>
<span class="c1">// EventInformation [7] Event timestamp (lower 32-bit)</span>
<span class="c1">// EventInformation [8] Event timestamp (upper 16-bit)</span>
<span class="c1">// EventInformation [9] Event energy</span>
<span class="c1">// EventInformation [10] Trace length</span>
<span class="c1">// EventInformation [11] Trace location</span>
<span class="c1">// EventInformation [67:12] Not used</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">Pixie16GetEventsInfo</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">FileName</span><span class="p">,</span><span class="o">//</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="n">mode</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="p">(</span><span class="n">with</span><span class="w"> </span><span class="n">complete</span><span class="w"> </span><span class="n">path</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">EventsInformation</span><span class="p">,</span><span class="c1">// to hold event information</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModuleNumber</span><span class="w"> </span><span class="p">);</span><span class="c1">// module to get events from</span>
</pre></div>
</div>
<p><strong>Return values description and error handling</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>0 Success</dt><dd><ul>
<li><p>None</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-1 Null pointer EventInformation</dt><dd><ul>
<li><p>Correct EventInformation</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-2 Invalid Pixie-16 module number</dt><dd><ul>
<li><p>Correct ModuleNumber</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-3 Failed to open list mode data file</dt><dd><ul>
<li><p>Correct file name and path</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p><strong>Usage example</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">retval</span><span class="p">;</span><span class="w"></span>
<span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">FileName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;C:</span><span class="se">\\</span><span class="s">XIA</span><span class="se">\\</span><span class="s">Pixie16</span><span class="se">\\</span><span class="s">PulseShape</span><span class="se">\\</span><span class="s">listmodedata.bin&quot;</span><span class="p">};</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModuleNumber</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">EventInformation</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">ModuleEvents</span><span class="p">[</span><span class="mi">7</span><span class="p">];</span><span class="w"> </span><span class="c1">// assume maximum number of modules is 7</span>

<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16GetModuleEvents</span><span class="w"> </span><span class="p">(</span><span class="n">FileName</span><span class="p">,</span><span class="w"> </span><span class="n">ModuleEvents</span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// error handling</span>
<span class="p">}</span><span class="w"></span>

<span class="n">ModuleNumber</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="c1">// the first module</span>
<span class="n">EventInformation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"></span>
<span class="w">                   </span><span class="n">ModuleEvents</span><span class="p">[</span><span class="n">ModuleNumber</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">68</span><span class="p">);</span><span class="w"></span>
<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16GetEventsInfo</span><span class="p">(</span><span class="n">FileName</span><span class="p">,</span><span class="w"> </span><span class="n">EventInformation</span><span class="p">,</span><span class="w"> </span><span class="n">ModuleNumber</span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// error handling</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="pixie16getmoduleevents">
<h3>Pixie16GetModuleEvents<a class="headerlink" href="#pixie16getmoduleevents" title="永久链接至标题">¶</a></h3>
<p>Parse a list mode data file to get events information</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Use this function to parse the list mode events in the list mode data file. The number of events for each module will be reported.</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">Pixie16GetModuleEvents</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">FileName</span><span class="p">,</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="n">mode</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="p">(</span><span class="n">with</span><span class="w"> </span><span class="n">complete</span><span class="w"> </span><span class="n">path</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">ModuleEvents</span><span class="w"> </span><span class="p">);</span><span class="w"> </span><span class="c1">// receives number of events for modules</span>
</pre></div>
</div>
<p><strong>Return values description and error handling</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>0 Success</dt><dd><ul>
<li><p>None</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-1 Null pointer ModuleEvents</dt><dd><ul>
<li><p>Correct ModuleEvents</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-2 Failed to open list mode data file</dt><dd><ul>
<li><p>Correct file name and path</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p><strong>Usage example</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">retval</span><span class="p">;</span><span class="w"></span>
<span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">FileName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;C:</span><span class="se">\\</span><span class="s">XIA</span><span class="se">\\</span><span class="s">Pixie16</span><span class="se">\\</span><span class="s">PulseShape</span><span class="se">\\</span><span class="s">listmodedata.bin&quot;</span><span class="p">};</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">ModuleEvents</span><span class="p">[</span><span class="mi">7</span><span class="p">];</span><span class="c1">// assume maximum number of modules is 7</span>

<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16GetModuleEvents</span><span class="w"> </span><span class="p">(</span><span class="n">FileName</span><span class="p">,</span><span class="w"> </span><span class="n">ModuleEvents</span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// error handling</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="pixie16imbufferio">
<h3>Pixie16IMbufferIO<a class="headerlink" href="#pixie16imbufferio" title="永久链接至标题">¶</a></h3>
<p>Transfer data between host and DSP internal memory</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Use this function to directly transfer data between the host and the DSP internal memory of a Pixie-16 module. ModNum is the module number which starts counting at 0.</span>
<span class="c1">// The DSP internal memory is split into two blocks with address range 0x40000 to 0x4FFFF for the first block and address range 0x50000 to 0x5FFFF for the second block. Within the first block, address range 0x40000 to 0x49FFF is reserved for program memory and shouldn’t be accessed directly by the host computer. Address range 0x4A000 to 0x4A4FF is used by the DSP I/O parameters which are stored in the configuration files (.set files) in the host. Within this range, 0x4A000 to 0x4A33F can be both read and written, but 0x4A340 to 0x4A4FF can only be read but not written. The remaining address range (0x4A500 to 4FFFF) in the first block and the entire second block (0x50000 to 0x5FFFF) should only be read but not written by the host. Use Direction = 1 for read and Direction = 0 for write.</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">Pixie16IMbufferIO</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">Buffer</span><span class="p">,</span><span class="w">    </span><span class="c1">//buffer data</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">NumWords</span><span class="p">,</span><span class="w">   </span><span class="c1">//number of buffer words to transfer</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">Address</span><span class="p">,</span><span class="w">    </span><span class="c1">//buffer address</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">Direction</span><span class="p">,</span><span class="c1">//I/O direction</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="w"> </span><span class="p">);</span><span class="w"> </span><span class="c1">//module number</span>
</pre></div>
</div>
<p><strong>Return values description and error handling</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>0 Success</dt><dd><ul>
<li><p>None</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-1 Null pointer for buffer data</dt><dd><ul>
<li><p>Correct pointer Buffer</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-2 Number of buffer words exceeds the limit</dt><dd><ul>
<li><p>Reduce the number of buffer words</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-3 Invalid DSP internal memory address</dt><dd><ul>
<li><p>Use the valid address</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-4 Invalid I/O direction</dt><dd><ul>
<li><p>Use the valid direction</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-5 Invalid Pixie-16 module number</dt><dd><ul>
<li><p>Correct the ModNum</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-6 I/O Failure</dt><dd><ul>
<li><p>Reboot the module</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p><strong>Usage example</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">retval</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">Direction</span><span class="p">,</span><span class="w"> </span><span class="n">ModNum</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">DSPMemBlock1</span><span class="p">[</span><span class="mi">65536</span><span class="p">],</span><span class="w"> </span><span class="n">NumWords</span><span class="p">,</span><span class="w"> </span><span class="n">Address</span><span class="p">;</span><span class="w"></span>

<span class="n">NumWords</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">65536</span><span class="p">;</span><span class="w"> </span><span class="c1">//to read out block 1 of the DSP internal memory</span>
<span class="n">ModNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">     </span><span class="c1">//the first module in the system</span>
<span class="n">Address</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x50000</span><span class="p">;</span><span class="c1">//the starting address for block 1</span>
<span class="n">Direction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w">          </span><span class="c1">//I/O direction is read</span>

<span class="c1">// read out the whole block 1 of the DSP internal memory</span>
<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16IMbufferIO</span><span class="w"> </span><span class="p">(</span><span class="n">DSPMemBlock1</span><span class="p">,</span><span class="w"> </span><span class="n">NumWords</span><span class="p">,</span><span class="w"> </span><span class="n">Address</span><span class="p">,</span><span class="w"> </span><span class="n">Direction</span><span class="p">,</span><span class="w"> </span><span class="n">ModNum</span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// Error handling</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="pixie16initsystem">
<h3>Pixie16InitSystem<a class="headerlink" href="#pixie16initsystem" title="永久链接至标题">¶</a></h3>
<p>Configure modules for communication in PXI chassis</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Use this function to configure the Pixie-16 modules in the PXI chassis.</span>
<span class="c1">// NumModules is the total number of Pixie-16 modules installed in the system. PXISlotMap is the pointer to an array that must have at least as many entries as there are Pixie-16 modules in the chassis.</span>
<span class="c1">// PXISlotMap serves as a simple mapping of the logical module number and the physical slot number that the modules reside in. The logical module number runs from 0. For instance, in a system with 5 Pixie-16 modules, these 5 modules may occupy slots 3 through 7. The user must fill PXISlotMap as follows: PXISlotMap = {3, 4, 5, 6, 7 ...} since module number 0 resides in slot number 3, etc. To find out in which slot a module is located, any piece of subsequent code can use the expression PXISlotMap[ModNum], where ModNum is the logic module number.</span>
<span class="c1">// OfflineMode is used to indicate to the API whether the system is running in OFFLINE mode (1) or ONLINE mode (0). OFFLINE mode is useful for situations where no Pixie-16 modules are present but users can still test their calls to the API functions in their application software.</span>
<span class="c1">// This function must be called as the first step in the boot process. It makes the modules known to the system and “opens” each module for communication.</span>
<span class="c1">// The function relies on an initialization file (pxisys.ini) that contains information about the Host PC’s PCI buses, including the slot enumeration scheme. XIA’s software distribution normally puts this file under the same folder as Pixie-16 software installation folder. However, the user has the flexibility of putting it in other folders by simply changing the definition of the string PCISysIniFile in the header part of the file pixie16sys.c.</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">Pixie16InitSystem</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">NumModules</span><span class="p">,</span><span class="w">   </span><span class="c1">//total number of Pixie-16 modules</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="o">*</span><span class="n">PXISlotMap</span><span class="p">,</span><span class="w">  </span><span class="c1">//an array containing the slot number of each Pixie-16 module</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">OfflineMode</span><span class="w"> </span><span class="p">);</span><span class="c1">//specify if using offline mode</span>
</pre></div>
</div>
<p><strong>Return values description and error handling</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>0 Success</dt><dd><ul>
<li><p>None</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-1 Invalid total number of Pixie-16 modules</dt><dd><ul>
<li><p>Check if NumModules &lt;= PRESET_MAX_MODULES(defined in pixie16app_defs.h)</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-2 Null pointer PXISlotMap</dt><dd><ul>
<li><p>Correct PXISlotMap</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-3 Failed to initialize system</dt><dd><ul>
<li><p>Check error message log file Pixie16msg.txt</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p><strong>Usage example</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">retval</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">NumModules</span><span class="p">,</span><span class="w"> </span><span class="n">PXISlotMap</span><span class="p">[</span><span class="mi">8</span><span class="p">],</span><span class="w"> </span><span class="n">OfflineMode</span><span class="p">;</span><span class="w"></span>

<span class="c1">// there are 5 modules in the system</span>
<span class="n">NumModules</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span><span class="w"></span>

<span class="c1">// specify the slot number for each module</span>
<span class="n">PXISlotMap</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"></span>
<span class="n">PXISlotMap</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w"></span>
<span class="n">PXISlotMap</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span><span class="w"></span>
<span class="n">PXISlotMap</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span><span class="w"></span>
<span class="n">PXISlotMap</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">6</span><span class="p">;</span><span class="w"></span>

<span class="c1">// running in online mode</span>
<span class="n">OfflineMode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>

<span class="c1">// configure the PXI slots in the chassis</span>
<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16InitSystem</span><span class="w"> </span><span class="p">(</span><span class="n">NumModules</span><span class="p">,</span><span class="w"> </span><span class="n">PXISlotMap</span><span class="p">,</span><span class="w"> </span><span class="n">OfflineMode</span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// error handling</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="pixie16loaddspparametersfromfile">
<h3>Pixie16LoadDSPParametersFromFile<a class="headerlink" href="#pixie16loaddspparametersfromfile" title="永久链接至标题">¶</a></h3>
<p>Load DSP parameters to modules from a file</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Use this function to read DSP parameters from a settings file and then download the settings to Pixie-16 modules that are installed in the system. Each module has exactly 1280 DSP parameter values (32-bit unsigned integers), and depending on the value of PRESET_MAX_MODULES (defined in pixie16app_defs.h), the settings file should have exactly (1280 * PRESET_MAX_MODULES * 4) bytes when stored on the computer hard drive.</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">Pixie16LoadDSPParametersFromFile</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">FileName</span><span class="w"> </span><span class="p">);</span><span class="w"> </span><span class="c1">// DSP parameters file name (with complete path)</span>
</pre></div>
</div>
<p><strong>Return values description and error handling</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>0 Success</dt><dd><ul>
<li><p>None</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-1 Size of DSPParFile is invalid</dt><dd><ul>
<li><p>Correct DSPParFile</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-2 Failed to program Fippi in a module</dt><dd><ul>
<li><p>Reboot the modules</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-3 Failed to set DACs in a module</dt><dd><ul>
<li><p>Reboot the modules</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-4 Failed to open the DSP parameters file</dt><dd><ul>
<li><p>Correct the DSP parameters file name</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p><strong>Usage example</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">retval</span><span class="p">;</span><span class="w"></span>
<span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">FileName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;C:</span><span class="se">\\</span><span class="s">XIA</span><span class="se">\\</span><span class="s">Pixie16</span><span class="se">\\</span><span class="s">Configuration</span><span class="se">\\</span><span class="s">test.set&quot;</span><span class="p">};</span><span class="w"></span>

<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16LoadDSPParametersFromFile</span><span class="w"> </span><span class="p">(</span><span class="n">FileName</span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// error handling</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="pixie16programfippi">
<h3>Pixie16ProgramFippi<a class="headerlink" href="#pixie16programfippi" title="永久链接至标题">¶</a></h3>
<p>Program on-board signal processing FPGAs</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Use this function to program the on-board signal processing FPGAs of the Pixie-16 modules. After the host computer has written the DSP parameters to the DSP memory, the DSP needs to write some of these parameters to the FPGAs. This function makes the DSP perform that action. ModNum is the module number which starts counting at 0.</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">Pixie16ProgramFippi</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">);</span><span class="c1">// module number</span>
</pre></div>
</div>
<p><strong>Return values description and error handling</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>0 Success</dt><dd><ul>
<li><p>None</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-1 Invalid Pixie-16 module number</dt><dd><ul>
<li><p>Correct ModNum</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-2 Failed to start the PROGRAM_FIPPI run</dt><dd><ul>
<li><p>Reboot the module</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-3 PROGRAM_FIPPI run timed out</dt><dd><ul>
<li><p>Reboot the module</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p><strong>Usage example</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">retval</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">;</span><span class="w"></span>
<span class="n">ModNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="c1">// the first module</span>

<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16ProgramFippi</span><span class="w"> </span><span class="p">(</span><span class="n">ModNum</span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// error handling</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="pixie16readcsr">
<h3>Pixie16ReadCSR<a class="headerlink" href="#pixie16readcsr" title="永久链接至标题">¶</a></h3>
<p>Read Control &amp; Status Register value from a module</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Use this function to read the host Control &amp; Status Register (CSR) value. This register is unrelated to the DSP parameters ModCSRA/B, ChanCSRA/B. It is used to control the operation of the module and read directly by the host. Direct reading or writing by the host is not recommended, for example use functions like Pixie16CheckRunStatus to poll the active bit.</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">Pixie16ReadCSR</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">,</span><span class="c1">// module number</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">CSR</span><span class="w"> </span><span class="p">);</span><span class="w">  </span><span class="c1">// returned CSR value</span>
</pre></div>
</div>
<p><strong>Return values description and error handling</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>0 Success</dt><dd><ul>
<li><p>None</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-1 Invalid Pixie-16 module number</dt><dd><ul>
<li><p>Correct ModNum</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p><strong>Usage example</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">CSR</span><span class="p">;</span><span class="w"></span>
<span class="n">ModNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="c1">// the first module</span>
<span class="n">Pixie16ReadCSR</span><span class="w"> </span><span class="p">(</span><span class="n">ModNum</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">CSR</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="pixie16readdatafromexternalfifo">
<h3>Pixie16ReadDataFromExternalFIFO<a class="headerlink" href="#pixie16readdatafromexternalfifo" title="永久链接至标题">¶</a></h3>
<p>Read data from external FIFO of a module</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Use this function to read data from the external FIFO of a module.</span>
<span class="c1">// This function reads list mode data from the external FIFO of a Pixie-16 module. The data are 32-bit unsigned integers. Normally, function Pixie16CheckExternalFIFOStatus is called first to see how many words the external FIFO currently has, and then this function is called to read the data from the FIFO. ModNum is the module number which starts counting at 0.</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">Pixie16ReadDataFromExternalFIFO</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">ExtFIFO_Data</span><span class="p">,</span><span class="c1">// to receive the external FIFO data</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">nFIFOWords</span><span class="p">,</span><span class="c1">// number of words to read from FIFO</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="w"> </span><span class="p">);</span><span class="c1">// module number</span>
</pre></div>
</div>
<p><strong>Return values description and error handling</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>0 Success</dt><dd><ul>
<li><p>None</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-1 Invalid Pixie-16 module number</dt><dd><ul>
<li><p>Check ModNum</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-2 Failed to read data from the external FIFO</dt><dd><ul>
<li><p>Check error message log file Pixie16msg.txt</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p><strong>Usage example</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">retval</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">nFIFOWords</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">ExtFIFO_Data</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">;</span><span class="w"></span>

<span class="n">ModNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="c1">// the first module in the system</span>
<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16CheckExternalFIFOStatus</span><span class="w"> </span><span class="p">(</span><span class="o">&amp;</span><span class="n">nFIFOWords</span><span class="p">,</span><span class="w"> </span><span class="n">ModNum</span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// Error handling</span>
<span class="p">}</span><span class="w"></span>

<span class="k">if</span><span class="p">(</span><span class="n">nFIFOWords</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="c1">// Check if there is data in the external FIFO</span>
<span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">ExtFIFO_Data</span><span class="w"> </span><span class="o">=</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">nFIFOWords</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16ReadDataFromExternalFIFO</span><span class="p">(</span><span class="n">ExtFIFO_Data</span><span class="p">,</span><span class="n">nFIFOWords</span><span class="p">,</span><span class="n">ModNum</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="c1">// Error handling</span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="pixie16readhistogramfromfile">
<h3>Pixie16ReadHistogramFromFile<a class="headerlink" href="#pixie16readhistogramfromfile" title="永久链接至标题">¶</a></h3>
<p>Read histogram data from a histogram data file</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Use this function to read histogram data from a histogram data file. Before calling this function, the host code should allocate appropriate amount of memory to store the histogram data. The default histogram length is 32768. Histogram data are 32-bit unsigned integers.</span>
<span class="c1">// Specify the module using ModNum and the channel on the module using ChanNum. Note that both the modules and channels are counted starting at 0.</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">Pixie16ReadHistogramFromFile</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">FileName</span><span class="p">,</span><span class="o">//</span><span class="w"> </span><span class="n">histogram</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="p">(</span><span class="n">with</span><span class="w"> </span><span class="n">complete</span><span class="w"> </span><span class="n">path</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">Histogram</span><span class="p">,</span><span class="c1">// histogram data</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">NumWords</span><span class="p">,</span><span class="c1">// number of words to be read out</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">,</span><span class="c1">// module number</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ChanNum</span><span class="p">);</span><span class="c1">// channel number</span>
</pre></div>
</div>
<p><strong>Return values description and error handling</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>0 Success</dt><dd><ul>
<li><p>None</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-1 Failed to open the histogram data file</dt><dd><ul>
<li><p>Correct the histogram data file name</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-2 No histogram data is available for this channel</dt><dd><ul>
<li><p>Change the ModNum and ChanNum</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p><strong>Usage example</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">retval</span><span class="p">;</span><span class="w"></span>
<span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">FileName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;C:</span><span class="se">\\</span><span class="s">XIA</span><span class="se">\\</span><span class="s">Pixie16</span><span class="se">\\</span><span class="s">MCA</span><span class="se">\\</span><span class="s">histogramdata.bin&quot;</span><span class="p">};</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">,</span><span class="w"> </span><span class="n">ChanNum</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">NumWords</span><span class="p">,</span><span class="w"> </span><span class="n">Histogram</span><span class="p">[</span><span class="mi">32768</span><span class="p">];</span><span class="w"></span>
<span class="n">ModNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">  </span><span class="c1">// the first module</span>
<span class="n">ChanNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="c1">// the first channel</span>
<span class="n">NumWords</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">32768</span><span class="p">;</span><span class="w"></span>

<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16ReadHistogramFromFile</span><span class="w"> </span><span class="p">(</span><span class="n">FileName</span><span class="p">,</span><span class="w"> </span><span class="n">Histogram</span><span class="p">,</span><span class="w"> </span><span class="n">NumWords</span><span class="p">,</span><span class="w"></span>
<span class="n">ModNum</span><span class="p">,</span><span class="w"> </span><span class="n">ChanNum</span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// error handling</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="pixie16readhistogramfrommodule">
<h3>Pixie16ReadHistogramFromModule<a class="headerlink" href="#pixie16readhistogramfrommodule" title="永久链接至标题">¶</a></h3>
<p>Read histogram data from a module</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Use this function to read out the histogram data from a Pixie-16 module’s histogram memory. Before calling this function, the host code should allocate appropriate amount of memory to store the histogram data. The default histogram length is 32768. Histogram data are 32-bit unsigned integers.</span>
<span class="c1">// Specify the module using ModNum and the channel on the module using ChanNum. Note that both the modules and channels are counted starting at 0.</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">Pixie16ReadHistogramFromModule</span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">Histogram</span><span class="p">,</span><span class="c1">//histogram data</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">NumWords</span><span class="p">,</span><span class="c1">//number of words to be read out</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">,</span><span class="c1">//module number</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ChanNum</span><span class="p">);</span><span class="c1">//channel number</span>
</pre></div>
</div>
<p><strong>Return values description and error handling</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>0 Success</dt><dd><ul>
<li><p>None</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-1 Invalid Pixie-16 module number</dt><dd><ul>
<li><p>Correct ModNum</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-2 Invalid Pixie-16 channel number</dt><dd><ul>
<li><p>Correct ChanNum</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-3 Failed to get the histogram data</dt><dd><ul>
<li><p>Reboot the module</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p><strong>Usage example</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">retval</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">,</span><span class="w"> </span><span class="n">ChanNum</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">NumWords</span><span class="p">,</span><span class="w"> </span><span class="n">Histogram</span><span class="p">[</span><span class="mi">32768</span><span class="p">];</span><span class="w"></span>

<span class="n">ModNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="c1">// the first module</span>
<span class="n">ChanNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="c1">// the first channel</span>
<span class="n">NumWords</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">32768</span><span class="p">;</span><span class="w"></span>

<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16ReadHistogramFromModule</span><span class="w"> </span><span class="p">(</span><span class="n">Histogram</span><span class="p">,</span><span class="w"> </span><span class="n">NumWords</span><span class="p">,</span><span class="w"> </span><span class="n">ModNum</span><span class="p">,</span><span class="w"> </span><span class="n">ChanNum</span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// error handling</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="pixie16readlistmodetrace">
<h3>Pixie16ReadListModeTrace<a class="headerlink" href="#pixie16readlistmodetrace" title="永久链接至标题">¶</a></h3>
<p>Read trace data from a list mode data file</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Use this function to retrieve list mode trace from a list mode data file. It uses the trace length and file location information obtained from function Pixie16GetEventsInfo for the selected event.</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">Pixie16ReadListModeTrace</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">FileName</span><span class="p">,</span><span class="w">            </span><span class="c1">//list mode data file name</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="o">*</span><span class="n">Trace_Data</span><span class="p">,</span><span class="o">//</span><span class="n">list</span><span class="w"> </span><span class="n">mode</span><span class="w"> </span><span class="n">trace</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="p">(</span><span class="mi">16</span><span class="o">-</span><span class="n">bit</span><span class="w"> </span><span class="n">words</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">NumWords</span><span class="p">,</span><span class="w">   </span><span class="c1">//number of 16-bit words to be read out</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">FileLocation</span><span class="p">);</span><span class="c1">//the location of the trace in the file</span>
</pre></div>
</div>
<p><strong>Return values description and error handling</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>0 Success</dt><dd><ul>
<li><p>None</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-1 Failed to open list mode data file</dt><dd><ul>
<li><p>Correct file name and path</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p><strong>Usage example</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">retval</span><span class="p">;</span><span class="w"></span>
<span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">FileName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;C:</span><span class="se">\\</span><span class="s">XIA</span><span class="se">\\</span><span class="s">Pixie16</span><span class="se">\\</span><span class="s">PulseShape</span><span class="se">\\</span><span class="s">listmodedata.bin&quot;</span><span class="p">};</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModuleNumber</span><span class="p">,</span><span class="w"> </span><span class="n">ChannelNumber</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">EventInformation</span><span class="p">,</span><span class="w"> </span><span class="n">FileLocation</span><span class="p">,</span><span class="w"> </span><span class="n">EventNumber</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="o">*</span><span class="n">Trace_Data</span><span class="p">,</span><span class="w"> </span><span class="n">NumWords</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">ModuleEvents</span><span class="p">[</span><span class="mi">7</span><span class="p">];</span><span class="w"> </span><span class="c1">// assume maximum number of modules is 7</span>

<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16GetModuleEvents</span><span class="w"> </span><span class="p">(</span><span class="n">FileName</span><span class="p">,</span><span class="w"> </span><span class="n">ModuleEvents</span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// error handling</span>
<span class="p">}</span><span class="w"></span>
<span class="n">ModuleNumber</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="c1">// the first module</span>
<span class="n">EventInformation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">ModuleEvents</span><span class="p">[</span><span class="n">ModuleNumber</span><span class="p">]</span><span class="o">*</span><span class="mi">68</span><span class="p">);</span><span class="w"></span>

<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16GetEventsInfo</span><span class="w"> </span><span class="p">(</span><span class="n">FileName</span><span class="p">,</span><span class="w"> </span><span class="n">EventInformation</span><span class="p">,</span><span class="w"> </span><span class="n">ModuleNumber</span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// error handling</span>
<span class="p">}</span><span class="w"></span>

<span class="n">ChannelNumber</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="c1">// the first channel</span>
<span class="n">EventNumber</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">  </span><span class="c1">// the first event</span>

<span class="n">NumWords</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="p">)</span><span class="n">EventInformation</span><span class="p">[</span><span class="n">EventNumber</span><span class="o">*</span><span class="mi">68</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">10</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"></span>

<span class="n">FileLocation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">EventInformation</span><span class="p">[</span><span class="n">EventNumber</span><span class="o">*</span><span class="mi">68</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">11</span><span class="p">];</span><span class="w"></span>
<span class="n">Trace_Data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">NumWords</span><span class="p">);</span><span class="w"></span>
<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16ReadListModeTrace</span><span class="w"> </span><span class="p">(</span><span class="n">FileName</span><span class="p">,</span><span class="n">Trace_Data</span><span class="p">,</span><span class="n">NumWords</span><span class="p">,</span><span class="n">FileLocation</span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// error handling</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="pixie16readmoduleinfo">
<h3>Pixie16ReadModuleInfo<a class="headerlink" href="#pixie16readmoduleinfo" title="永久链接至标题">¶</a></h3>
<p>Read information about a module stored in the EEPROM</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Use this function to read information stored on each module, including its revision, serial number, ADC bits and sampling rate. This should be done after initializing the PCI communication. Information from the module can be used to select the appropriate firmware, DSP, and configuration parameters files before booting the module. ModNum is the module number which starts counting at 0.</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">Pixie16ReadModuleInfo</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">,</span><span class="w">       </span><span class="c1">//module number</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="o">*</span><span class="n">ModRev</span><span class="p">,</span><span class="w">      </span><span class="c1">//returned module revision</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">ModSerNum</span><span class="p">,</span><span class="w">     </span><span class="c1">//returned module serial number</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="o">*</span><span class="n">ModADCBits</span><span class="p">,</span><span class="w">  </span><span class="c1">//returned module ADC bits</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="o">*</span><span class="n">ModADCMSPS</span><span class="w"> </span><span class="p">);</span><span class="c1">//returned module ADC sampling rate</span>
</pre></div>
</div>
<p><strong>Return values description and error handling</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>0 Success</dt><dd><ul>
<li><p>None</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-1 Invalid Pixie module number</dt><dd><ul>
<li><p>Check ModNum</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-2 Failed to read from I2C serial EEPROM</dt><dd><ul>
<li><p>Check error message log file Pixie16msg.txt</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p><strong>Usage example</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">retval</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModuleNumber</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModRev</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">ModSerNum</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModADCBits</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModADCMSPS</span><span class="p">;</span><span class="w"></span>

<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16ReadModuleInfo</span><span class="w"> </span><span class="p">(</span><span class="n">ModuleNumber</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ModRev</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ModSerNum</span><span class="p">,</span><span class="w"></span>
<span class="o">&amp;</span><span class="n">ModADCBits</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ModADCMSPS</span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// error handling</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="pixie16readsglchanadctrace">
<h3>Pixie16ReadSglChanADCTrace<a class="headerlink" href="#pixie16readsglchanadctrace" title="永久链接至标题">¶</a></h3>
<p>Read ADC trace data from a channel in a module</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Use this function to read ADC trace data from a Pixie-16 module. Before calling this function, another function Pixie16AcquireADCTrace should be called to fill the DSP internal memory first. Also, the host code should allocate appropriate amount of memory to store the trace data. The ADC trace data length for each channel is 8192. Since the trace data are 16-bit unsigned integers (for hardware variants with less than 16-bit ADCs only the lower 12-bit or 14-bit contain real data), two consecutive 16-bit words are packed into one 32-bit word in the DSP internal memory. So for each channel, 4096 32-bit words are read out first from the DSP, and then each 32-bit word is unpacked to form two 16-bit words.</span>
<span class="c1">// Specify the module using ModNum and the channel on the module using ChanNum. Note that both the modules and channels are counted starting at 0.</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">Pixie16ReadSglChanADCTrace</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="o">*</span><span class="n">Trace_Buffer</span><span class="p">,</span><span class="w"> </span><span class="c1">//trace data</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">Trace_Length</span><span class="p">,</span><span class="c1">//number of trace data words to read</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">,</span><span class="c1">//module number</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ChanNum</span><span class="w"> </span><span class="p">);</span><span class="c1">//channel number</span>
</pre></div>
</div>
<p><strong>Return values description and error handling</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>0 Success</dt><dd><ul>
<li><p>None</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-1 Invalid Pixie-16 module number</dt><dd><ul>
<li><p>Correct ModNum</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-2 Invalid Pixie-16 channel number</dt><dd><ul>
<li><p>Correct ChanNum</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-3 Invalid trace length</dt><dd><ul>
<li><p>Correct Trace_Length</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-4 Failed to allocate memory to store ADC traces</dt><dd><ul>
<li><p>Close other programs or reboot the computer</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-5 Failed to read ADC traces</dt><dd><ul>
<li><p>Reboot the module</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p><strong>Usage example</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">NumWords</span><span class="p">,</span><span class="w"> </span><span class="n">ModNum</span><span class="p">,</span><span class="w"> </span><span class="n">ChanNum</span><span class="p">;</span><span class="w"></span>
<span class="kt">int</span><span class="w"> </span><span class="n">retval</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ADCTrace</span><span class="p">[</span><span class="mi">8192</span><span class="p">];</span><span class="w"></span>
<span class="c1">// assume we want to acquire ADC trace from channel 0 of module 0</span>
<span class="n">ModNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="n">ChanNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>

<span class="c1">// number of ADC trace words is 8192</span>
<span class="n">NumWords</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">8192</span><span class="p">;</span><span class="w"></span>

<span class="c1">// acquire the trace</span>
<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16AcquireADCTrace</span><span class="p">(</span><span class="n">ModNum</span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// error handling</span>
<span class="p">}</span><span class="w"></span>

<span class="c1">// read out the trace</span>
<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16ReadSglChanADCTrace</span><span class="p">(</span><span class="n">ADCTrace</span><span class="p">,</span><span class="w"> </span><span class="n">NumWords</span><span class="p">,</span><span class="w"> </span><span class="n">ModNum</span><span class="p">,</span><span class="w"> </span><span class="n">ChanNum</span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// error handling</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="pixie16readsglchanbaselines">
<h3>Pixie16ReadSglChanBaselines<a class="headerlink" href="#pixie16readsglchanbaselines" title="永久链接至标题">¶</a></h3>
<p>Read baselines from a channel in a module</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Use this function to read baseline data from a Pixie-16 module. Before calling this function, another function Pixie16AcquireBaselines should be called to fill the DSP internal memory first. Also, the host code should allocate appropriate amount of memory to store the baseline data. The number of baselines for each channel is 3640. In the DSP internal memory, each baseline is a 32-bit IEEE floating point number. After being read out to the host, this function will convert each baseline data to a decimal number. In addition to baseline values, timestamps corresponding to each baseline are also returned after this function call.</span>
<span class="c1">// Specify the module using ModNum and the channel on the module using ChanNum. Note that the modules and channels are counted starting at 0.</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">Pixie16ReadSglChanBaselines</span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">Baselines</span><span class="p">,</span><span class="w">       </span><span class="c1">//returned baseline values</span>
<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">TimeStamps</span><span class="p">,</span><span class="w">      </span><span class="c1">//timestamps for each baseline value</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">NumBases</span><span class="p">,</span><span class="w"> </span><span class="c1">//number of baseline data words to read</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">,</span><span class="w">   </span><span class="c1">//module number</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ChanNum</span><span class="w"> </span><span class="p">);</span><span class="c1">//channel number</span>
</pre></div>
</div>
<p><strong>Return values description and error handling</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>0 Success</dt><dd><ul>
<li><p>None</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-1 Invalid Pixie-16 module number</dt><dd><ul>
<li><p>Correct ModNum</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-2 Requested number of baselines exceeded the limit</dt><dd><ul>
<li><p>Correct NumBases</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-3 Failed to allocate memory to store baselines</dt><dd><ul>
<li><p>Close other programs or reboot computer</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-4 Failed to read baselines</dt><dd><ul>
<li><p>Reboot the module</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p><strong>Usage example</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">NumWords</span><span class="p">,</span><span class="w"> </span><span class="n">ModNum</span><span class="p">,</span><span class="w"> </span><span class="n">ChanNum</span><span class="p">;</span><span class="w"></span>
<span class="kt">int</span><span class="w"> </span><span class="n">retval</span><span class="p">;</span><span class="w"></span>
<span class="kt">double</span><span class="w"> </span><span class="n">Baselines</span><span class="p">[</span><span class="mi">3640</span><span class="p">],</span><span class="w"> </span><span class="n">TimeStamps</span><span class="p">[</span><span class="mi">3640</span><span class="p">];</span><span class="w"></span>

<span class="c1">// assume we want to acquire baselines for channel 0 of module 0</span>
<span class="n">ModNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="n">ChanNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>

<span class="c1">// number of baseline words is 3640</span>
<span class="n">NumWords</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3640</span><span class="p">;</span><span class="w"></span>

<span class="c1">// acquire the baselines</span>
<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16AcquireBaselines</span><span class="w"> </span><span class="p">(</span><span class="n">ModNum</span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// error handling</span>
<span class="p">}</span><span class="w"></span>

<span class="c1">// read out the baselines</span>
<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16ReadSglChanBaselines</span><span class="w"> </span><span class="p">(</span><span class="n">Baselines</span><span class="p">,</span><span class="w"> </span><span class="n">TimeStamps</span><span class="p">,</span><span class="w"> </span><span class="n">NumWords</span><span class="p">,</span><span class="w"> </span><span class="n">ModNum</span><span class="p">,</span><span class="w"> </span><span class="n">ChanNum</span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// error handling</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="pixie16readsglchanpar">
<h3>Pixie16ReadSglChanPar<a class="headerlink" href="#pixie16readsglchanpar" title="永久链接至标题">¶</a></h3>
<p>Read a CHANNEL level parameter from a module</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Use this function to read a channel parameter from a Pixie-16 module. ModNum is the module number which starts counting at 0. ChanNum is the channel number which starts counting at 0.</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">Pixie16ReadSglChanPar</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">ChanParName</span><span class="p">,</span><span class="w">       </span><span class="c1">// channel parameter name</span>
<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">ChanParData</span><span class="p">,</span><span class="w">     </span><span class="c1">// channel parameter value</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">,</span><span class="w">   </span><span class="c1">// channel number</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ChanNum</span><span class="w"> </span><span class="p">);</span><span class="c1">// module number</span>
</pre></div>
</div>
<p><strong>Return values description and error handling</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>0 Success</dt><dd><ul>
<li><p>None</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-1 Invalid Pixie-16 module number</dt><dd><ul>
<li><p>Correct ModNum</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-2 Invalid Pixie-16 channel number</dt><dd><ul>
<li><p>Correct ChanNum</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-3 Invalid channel parameter name</dt><dd><ul>
<li><p>Correct ChanParName</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p><strong>Usage example</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">retval</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">,</span><span class="w"> </span><span class="n">ChanNum</span><span class="p">;</span><span class="w"></span>
<span class="kt">double</span><span class="w"> </span><span class="n">ChanParData</span><span class="p">;</span><span class="w"></span>

<span class="c1">// read energy filter rise time from module 0 channel 0</span>
<span class="n">ModNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="c1">// this is the first module</span>
<span class="n">ChanNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="c1">// the first channel</span>

<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16ReadSglChanPar</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;ENERGY_RISETIME”, &amp;ChanParData, ModNum, ChanNum);</span>
<span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// Error handling</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="pixie16readsglmodpar">
<h3>Pixie16ReadSglModPar<a class="headerlink" href="#pixie16readsglmodpar" title="永久链接至标题">¶</a></h3>
<p>Read a MODULE level parameter from a module</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Use this function to read a module parameter from a Pixie-16 module. ModNum is the module number which starts counting at 0.</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">Pixie16ReadSglModPar</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">ModParName</span><span class="p">,</span><span class="w">        </span><span class="c1">// module parameter name</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">ModParData</span><span class="p">,</span><span class="c1">// module parameter value</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="w"> </span><span class="p">);</span><span class="w"> </span><span class="c1">// module number</span>
</pre></div>
</div>
<p><strong>Return values description and error handling</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>0 Success</dt><dd><ul>
<li><p>None</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-1 Invalid Pixie-16 module number</dt><dd><ul>
<li><p>Correct ModNum</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-2 Invalid module parameter name</dt><dd><ul>
<li><p>Correct ModParName</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p><strong>Usage example</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">retval</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">ModParData</span><span class="p">;</span><span class="w"></span>

<span class="c1">// Read SlowFilterRange in module 0</span>
<span class="n">ModNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="c1">// this is the first module</span>

<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16ReadSglModPar</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;SLOW_FILTER_RANGE”, &amp;ModParData, ModNum);</span>
<span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// Error handling</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="pixie16readstatisticsfrommodule">
<h3>Pixie16ReadStatisticsFromModule<a class="headerlink" href="#pixie16readstatisticsfrommodule" title="永久链接至标题">¶</a></h3>
<p>Read run statistics data from a module</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Use this function to read out statistics data from a Pixie-16 module. Before calling this function, the host code should allocate appropriate amount of memory to store the statistics data. The number of statistics data for each module is fixed at 448. Statistics data are 32-bit unsigned integers.</span>
<span class="c1">// Specify the module using ModNum. Note that the modules are counted starting at 0.</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">Pixie16ReadStatisticsFromModule</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">Statistics</span><span class="p">,</span><span class="c1">// statistics data</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="w"> </span><span class="p">);</span><span class="w"> </span><span class="c1">// module number</span>
</pre></div>
</div>
<p><strong>Return values description and error handling</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>0 Success</dt><dd><ul>
<li><p>None</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-1 Invalid Pixie-16 module number</dt><dd><ul>
<li><p>Correct ModNum</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-2 Failed to get the statistics data</dt><dd><ul>
<li><p>Reboot the module</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p><strong>Usage example</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">retval</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">,</span><span class="w"> </span><span class="n">ChanNum</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">Statistics</span><span class="p">[</span><span class="mi">448</span><span class="p">];</span><span class="w"></span>

<span class="n">ModNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="c1">// the first module</span>
<span class="n">ChanNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="c1">// the first channel</span>

<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16ReadStatisticsFromModule</span><span class="w"> </span><span class="p">(</span><span class="n">Statistics</span><span class="p">,</span><span class="w"> </span><span class="n">ModNum</span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// error handling</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="pixie16registerio">
<h3>Pixie16RegisterIO<a class="headerlink" href="#pixie16registerio" title="永久链接至标题">¶</a></h3>
<p>Read from or write to registers on a module</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Use this function to read data from or write data to a register in a Pixie-16 module.</span>
<span class="c1">// Specify the module using ModNum. Note that the modules are counted starting at 0.</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">Pixie16RegisterIO</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">,</span><span class="w">   </span><span class="c1">//module number</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">address</span><span class="p">,</span><span class="w">    </span><span class="c1">//register address</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">direction</span><span class="p">,</span><span class="c1">//read or write</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">value</span><span class="w"> </span><span class="p">);</span><span class="w">   </span><span class="c1">//holds or receives the data</span>
</pre></div>
</div>
<p><strong>Return values description and error handling</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>0 Success</dt><dd><ul>
<li><p>None</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-1 Invalid Pixie-16 module number</dt><dd><ul>
<li><p>Correct ModNum</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p><strong>Usage example</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">retval</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">address</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">;</span><span class="w"></span>
<span class="n">ModNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="c1">// the first module</span>
<span class="n">address</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PCI_STOPRUN_REGADDR</span><span class="p">;</span><span class="c1">// address of the register for ending run</span>
<span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>

<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16RegisterIO</span><span class="p">(</span><span class="n">ModNum</span><span class="p">,</span><span class="w"> </span><span class="n">address</span><span class="p">,</span><span class="w"> </span><span class="n">MOD_WRITE</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">value</span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// error handling</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="pixie16savedspparameterstofile">
<h3>Pixie16SaveDSPParametersToFile<a class="headerlink" href="#pixie16savedspparameterstofile" title="永久链接至标题">¶</a></h3>
<p>Read DSP parameters from modules and save to a file</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Use this function to save DSP parameters to a settings file. It will first read the values of DSP parameters on each Pixie-16 module and then write them to the settings file. Each module has exactly 1280 DSP parameter values (32-bit unsigned integers), and depending on the value of PRESET_MAX_MODULES (defined in pixie16app_defs.h), the settings file should have exactly (1280 * PRESET_MAX_MODULES * 4) bytes when stored on the computer hard drive.</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">Pixie16SaveDSPParametersToFile</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">FileName</span><span class="w"> </span><span class="p">);</span><span class="w"> </span><span class="c1">// DSP parameters file name (with complete path)</span>
</pre></div>
</div>
<p><strong>Return values description and error handling</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>0 Success</dt><dd><ul>
<li><p>None</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-1 Failed to read DSP parameter values from the Pixie-16 modules</dt><dd><ul>
<li><p>Reboot the modules</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-2 Failed to open the DSP parameters file</dt><dd><ul>
<li><p>Correct the DSP parameters file name</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p><strong>Usage example</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">retval</span><span class="p">;</span><span class="w"></span>
<span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">FileName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;C:</span><span class="se">\\</span><span class="s">XIA</span><span class="se">\\</span><span class="s">Pixie16</span><span class="se">\\</span><span class="s">Configuration</span><span class="se">\\</span><span class="s">test.set&quot;</span><span class="p">};</span><span class="w"></span>

<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16SaveDSPParametersToFile</span><span class="w"> </span><span class="p">(</span><span class="n">FileName</span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// error handling</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="pixie16saveexternalfifodatatofile">
<h3>Pixie16SaveExternalFIFODataToFile<a class="headerlink" href="#pixie16saveexternalfifodatatofile" title="永久链接至标题">¶</a></h3>
<p>Read data from external FIFO and save to a file</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Use this function to read data from the external FIFO of a module. ModNum is the module number which starts counting at 0.</span>
<span class="c1">// This function first checks the status of the external FIFO of a Pixie-16 module, and if there are data in the external FIFO, this function then reads list mode data (32-bit unsigned integers) from the external FIFO. So this function essentially encapsulates both functions Pixie16CheckExternalFIFOStatus and Pixie16ReadDataFromExternalFIFO within one function. The number of words that are read from the external FIFO is recorded in variable *FIFOWords. The function also expects setting the value of a variable called “EndOfRunRead” to indicate whether this read is at the end of a run (1) or during the run (0). This is necessary since the external FIFO needs special treatment when the host reads the last few words from the external FIFO due to its pipelined structure.</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">Pixie16SaveExternalFIFODataToFile</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">FileName</span><span class="p">,</span><span class="c1">// list mode data file name</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">nFIFOWords</span><span class="p">,</span><span class="c1">// number of words read from ext. FIFO</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">,</span><span class="c1">// module number</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">EndOfRunRead</span><span class="w"> </span><span class="p">);</span><span class="w"> </span><span class="c1">// indicator if this is end of run read</span>
</pre></div>
</div>
<p><strong>Return values description and error handling</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>0 Success</dt><dd><ul>
<li><p>None</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-1 Invalid Pixie-16 module number</dt><dd><ul>
<li><p>Check ModNum</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-2 Failed to allocate memory to store list mode data</dt><dd><ul>
<li><p>Check computer resources</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-3 Failed to open list mode data file</dt><dd><ul>
<li><p>Check if file is protected</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-4 Failed to read external FIFO status</dt><dd><ul>
<li><p>Check error message log file Pixie16msg.txt</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-5 Failed to read data from external FIFO</dt><dd><ul>
<li><p>Check error message log file Pixie16msg.txt</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p><strong>Usage example</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">retval</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">nFIFOWords</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">,</span><span class="w"> </span><span class="n">EndOfRunRead</span><span class="p">;</span><span class="w"></span>
<span class="n">ModNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="c1">// the first module in the system</span>
<span class="n">EndOfRunRead</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="c1">// this is a read during the run</span>

<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16SaveExternalFIFODataToFile</span><span class="p">(</span><span class="s">&quot;listmodedata_mod0.bin&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">nFIFOWords</span><span class="p">,</span><span class="w"> </span><span class="n">ModNum</span><span class="p">,</span><span class="w"> </span><span class="n">EndOfRunRead</span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// Error handling</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="pixie16savehistogramtofile">
<h3>Pixie16SaveHistogramToFile<a class="headerlink" href="#pixie16savehistogramtofile" title="永久链接至标题">¶</a></h3>
<p>Read histogram data from a module and save to a file</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Use this function to read histogram data from a Pixie-16 module and save the histogram data to a file with file name specified by the user: First this function saves the histogram data to a binary file, and it then saves the histogram data to an ASCII file with run statistics data appended to the end of the ASCII file. Existing files will be overwritten. ModNum is the module number which starts counting at 0.</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">Pixie16SaveHistogramToFile</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">FileName</span><span class="p">,</span><span class="o">//</span><span class="w"> </span><span class="n">histogram</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="p">(</span><span class="n">with</span><span class="w"> </span><span class="n">complete</span><span class="w"> </span><span class="n">path</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">);</span><span class="w"> </span><span class="c1">// module number</span>
</pre></div>
</div>
<p><strong>Return values description and error handling</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>0 Success</dt><dd><ul>
<li><p>None</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-1 Invalid Pixie-16 module number</dt><dd><ul>
<li><p>Correct ModNum</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-2 Failed to get histogram data from module</dt><dd><ul>
<li><p>Reboot the module</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-3 Failed to allocate memory to store histogram data</dt><dd><ul>
<li><p>Close other programs or reboot computer</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-4 Failed to open histogram data file</dt><dd><ul>
<li><p>Correct file name and path</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-5 Failed to open mca ascii output file</dt><dd><ul>
<li><p>Correct file name and path</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-6 Failed to allocate memory to store histogram data for ascii text file</dt><dd><ul>
<li><p>Close other programs or reboot computer</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-7 Failed to read histogram data from file</dt><dd><ul>
<li><p>Check file name and path</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-8 Failed to read run statistics data from module</dt><dd><ul>
<li><p>Reboot the module</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p><strong>Usage example</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">retval</span><span class="p">;</span><span class="w"></span>
<span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">FileName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;C:</span><span class="se">\\</span><span class="s">XIA</span><span class="se">\\</span><span class="s">Pixie16</span><span class="se">\\</span><span class="s">MCA</span><span class="se">\\</span><span class="s">histogramdata.bin&quot;</span><span class="p">};</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">;</span><span class="w"></span>
<span class="n">ModNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="c1">// the first module</span>

<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16SaveHistogramToFile</span><span class="w"> </span><span class="p">(</span><span class="n">FileName</span><span class="p">,</span><span class="w"> </span><span class="n">ModNum</span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// error handling</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="pixie16setdacs">
<h3>Pixie16SetDACs<a class="headerlink" href="#pixie16setdacs" title="永久链接至标题">¶</a></h3>
<p>Program on-board DACs</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Use this function to reprogram the on-board digital to analog converters (DAC) of the Pixie-16 modules. In this operation the DSP uses data from the DSP parameters that were previously downloaded. ModNum is the module number which starts counting at 0.</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">Pixie16SetDACs</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">);</span><span class="c1">// module number</span>
</pre></div>
</div>
<p><strong>Return values description and error handling</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>0 Success</dt><dd><ul>
<li><p>None</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-1 Invalid Pixie-16 module number</dt><dd><ul>
<li><p>Correct ModNum</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-2 Failed to start the SET_DACS run</dt><dd><ul>
<li><p>Reboot the module</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-3 SET_DACS run timed out</dt><dd><ul>
<li><p>Reboot the module</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p><strong>Usage example</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">retval</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">;</span><span class="w"></span>
<span class="n">ModNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="c1">// the first module</span>

<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16SetDACs</span><span class="w"> </span><span class="p">(</span><span class="n">ModNum</span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// error handling</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="pixie16starthistogramrun">
<h3>Pixie16StartHistogramRun<a class="headerlink" href="#pixie16starthistogramrun" title="永久链接至标题">¶</a></h3>
<p>Start a MCA histogram mode data acquisition run</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Use this function to begin a data acquisition run that accumulates energy histograms, one for each channel. It launches a data acquisition run in which only energy information is preserved and histogrammed locally to each channel.</span>
<span class="c1">// Call this function for each Pixie-16 module in the system to initialize the run in each module. Actual data acquisition will start synchronously in all modules when the last module finished the initialization(requires the synchronization parameter to be set). Histogram runs can be self-terminating when the elapsed run time exceeds the preset run time, or the user can prematurely terminate the run by calling Pixie16EndRun. On completion, final histogram and statistics data will be available.</span>
<span class="c1">// Use mode=NEW_RUN (=1) to erase histograms and statistics information before launching the new run. Use mode=RESUME_RUN (=0) to resume an earlier run.</span>
<span class="c1">// ModNum is the module number which starts counting at 0. If ModNum is set to be less than the total number of modules in the system, only the module specified by ModNum will have its histogram run started. But if ModNum is set to be equal to the total number of modules in the system, then all modules in the system will have their runs started together.</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">Pixie16StartHistogramRun</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">,</span><span class="c1">// module number</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">mode</span><span class="w"> </span><span class="p">);</span><span class="c1">// run mode</span>
</pre></div>
</div>
<p><strong>Return values description and error handling</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>0 Success</dt><dd><ul>
<li><p>None</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-1 Invalid Pixie-16 module number</dt><dd><ul>
<li><p>Correct the ModNum</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-2 Invalid run mode</dt><dd><ul>
<li><p>Correct the run mode</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-3 Failed to start histogram run</dt><dd><ul>
<li><p>Reboot the module</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p><strong>Usage example</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">retval</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">mode</span><span class="p">,</span><span class="w"> </span><span class="n">ModNum</span><span class="p">;</span><span class="w"></span>
<span class="kt">double</span><span class="w"> </span><span class="n">preset_run_time</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">ieee_preset_run_time</span><span class="p">;</span><span class="w"></span>

<span class="n">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NEW_RUN</span><span class="p">;</span><span class="c1">// to start a new run</span>
<span class="c1">// Assume there are 5 modules in the system</span>
<span class="n">ModNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span><span class="c1">// start histogram run in all 5 modules</span>

<span class="c1">// Assume preset run time is 10 seconds</span>
<span class="n">preset_run_time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">10.0</span><span class="p">;</span><span class="w"></span>

<span class="c1">// Convert preset run time to IEEE 32-bit floating point number</span>
<span class="n">ieee_preset_run_time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Decimal2IEEEFloating</span><span class="w"> </span><span class="p">(</span><span class="n">preset_run_time</span><span class="p">);</span><span class="w"></span>

<span class="c1">// Download the preset run time to the DSP</span>
<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16WriteSglModPar</span><span class="p">(</span><span class="s">&quot;HOST_RT_PRESET&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ieee_preset_run_time</span><span class="p">,</span><span class="w"> </span><span class="n">ModNum</span><span class="p">)</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// Error handling</span>
<span class="p">}</span><span class="w"></span>

<span class="c1">// Start the histogram run</span>
<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16StartHistogramRun</span><span class="w"> </span><span class="p">(</span><span class="n">ModNum</span><span class="p">,</span><span class="w"> </span><span class="n">mode</span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// Error handling</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="pixie16startlistmoderun">
<h3>Pixie16StartListModeRun<a class="headerlink" href="#pixie16startlistmoderun" title="永久链接至标题">¶</a></h3>
<p>Start a list mode data acquisition run</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Use this function to start a list mode data acquisition run in Pixie-16 modules. List mode runs are used to collect data on an event-by-event basis, gathering energies, timestamps, pulse shape analysis values, and waveforms for each event. Runs will continue until the user terminates the run by calling function Pixie16EndRun. To start the data acquisition this function has to be called for every Pixie-16 module in the system. If all modules are to run synchronously, the last module addressed will release all others and the acquisition starts then. The first module to end the run will immediately stop the run in all other modules if run synchronization has been set up among these modules.</span>
<span class="c1">// Use mode=NEW_RUN (=1) to erase histograms and statistics information before launching the new run. Note that this will cause a startup delay of up to 1 millisecond. Use mode=RESUME_RUN (=0) to resume an earlier run. This mode has a startup delay of only a few microseconds.</span>
<span class="c1">// There is only one list mode run type supported, that is, 0x100. However, different output data options can be chosen by enabling or disabling different CHANCSRA bits.</span>
<span class="c1">// ModNum is the module number which starts counting at 0. If ModNum is set to be less than the total number of modules in the system, only the module specified by ModNum will have its list mode run started. But if ModNum is set to equal to the total number of modules in the system, then all modules in the system will have their runs started together.</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">Pixie16StartListModeRun</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">,</span><span class="w"> </span><span class="c1">// module number</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">RunType</span><span class="p">,</span><span class="c1">// run type</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">mode</span><span class="w"> </span><span class="p">);</span><span class="w"> </span><span class="c1">// run mode</span>
</pre></div>
</div>
<p><strong>Return values description and error handling</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>0 Success</dt><dd><ul>
<li><p>None</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-1 Invalid Pixie-16 module number</dt><dd><ul>
<li><p>Correct the ModNum</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-2 Invalid run mode</dt><dd><ul>
<li><p>Correct the run mode</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-3 Failed to start list mode run</dt><dd><ul>
<li><p>Reboot the module</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-4 Invalid run type</dt><dd><ul>
<li><p>Correct RunType</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p><strong>Usage example</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">retval</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">mode</span><span class="p">,</span><span class="w"> </span><span class="n">ModNum</span><span class="p">,</span><span class="w"> </span><span class="n">RunType</span><span class="p">;</span><span class="w"></span>

<span class="n">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NEW_RUN</span><span class="p">;</span><span class="c1">// to start a new run</span>
<span class="n">RunType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x100</span><span class="p">;</span><span class="c1">// general purpose list mode run</span>

<span class="c1">// Assume there are 5 modules in the system</span>
<span class="n">ModNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span><span class="w"></span>

<span class="c1">// start list mode run in all 5 modules</span>
<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16StartListModeRun</span><span class="w"> </span><span class="p">(</span><span class="n">ModNum</span><span class="p">,</span><span class="w"> </span><span class="n">RunType</span><span class="p">,</span><span class="w"> </span><span class="n">mode</span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// Error handling</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="pixie16taufinder">
<h3>Pixie16TauFinder<a class="headerlink" href="#pixie16taufinder" title="永久链接至标题">¶</a></h3>
<p>Find the exponential decay time of a channel</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Use this function to find the exponential decay time constants (Tau value) of the detector or preamplifier signal that is connected to each of the 16 channels of a Pixie-16 module. The 16 found Tau values are returned via pointer *Tau. A &#39;-1.0&#39; Tau value for a channel means the Tau_Finder was not successful for such a channel. ModNum is the module number which starts counting at 0.</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">Pixie16TauFinder</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">,</span><span class="c1">// module number</span>
<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">Tau</span><span class="w"> </span><span class="p">);</span><span class="c1">// Tau value</span>
</pre></div>
</div>
<p><strong>Return values description and error handling</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>0 Success</dt><dd><ul>
<li><p>None</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-1 Invalid Pixie-16 module number</dt><dd><ul>
<li><p>Correct the ModNum</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-2 Invalid Pixie-16 channel number</dt><dd><ul>
<li><p>Correct the ChanNum</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-3 Failed to acquire ADC traces</dt><dd><ul>
<li><p>Reboot the module</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-4 Failed to read ADC traces</dt><dd><ul>
<li><p>Reboot the module</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-5 Failed to find sufficient number of pulses</dt><dd><ul>
<li><p>Increase input count rate</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p><strong>Usage example</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">retval</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">;</span><span class="w"></span>
<span class="kt">double</span><span class="w"> </span><span class="n">Tau</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span><span class="w"></span>
<span class="n">ModNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="c1">// the first module</span>

<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16TauFinder</span><span class="p">(</span><span class="n">ModNum</span><span class="p">,</span><span class="w"> </span><span class="n">Tau</span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// Error handling</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="pixie16writecsr">
<h3>Pixie16WriteCSR<a class="headerlink" href="#pixie16writecsr" title="永久链接至标题">¶</a></h3>
<p>Write to Control &amp; Status Register in a module</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Use this function to write a value to the host Control &amp; Status Register (CSR). This register is unrelated to the DSP parameters ModCSRA/B, ChanCSRA/B. It is used to control the operation of the module and read directly by the host. Direct reading or writing by the host is not recommended, for example use functions like Pixie16CheckRunStatus to poll the active bit. ModNum is the module number which starts counting at 0.</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">Pixie16WriteCSR</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">,</span><span class="c1">// module number</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">CSR</span><span class="w"> </span><span class="p">);</span><span class="w">   </span><span class="c1">// CSR value to write</span>
</pre></div>
</div>
<p><strong>Return values description and error handling</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>0 Success</dt><dd><ul>
<li><p>None</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-1 Invalid Pixie-16 module number</dt><dd><ul>
<li><p>Correct the ModNum</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p><strong>Usage example</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">retval</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">CSR</span><span class="p">;</span><span class="w"></span>

<span class="n">ModNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="c1">// the first module</span>
<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16ReadCSR</span><span class="p">(</span><span class="n">ModNum</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">CSR</span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// Error handling</span>
<span class="p">}</span><span class="w"></span>

<span class="n">CSR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">APP32_ClrBit</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">CSR</span><span class="p">);</span><span class="w"></span>
<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16WriteCSR</span><span class="w"> </span><span class="p">(</span><span class="n">ModNum</span><span class="p">,</span><span class="w"> </span><span class="n">CSR</span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// Error handling</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="pixie16writesglchanpar">
<h3>Pixie16WriteSglChanPar<a class="headerlink" href="#pixie16writesglchanpar" title="永久链接至标题">¶</a></h3>
<p>Write a CHANNEL level parameter to a module</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Use this function to write a channel parameter to a Pixie-16 module. ModNum is the module number which starts counting at 0. ChanNum is the channel number which starts counting at 0.</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">Pixie16WriteSglChanPar</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">ChanParName</span><span class="p">,</span><span class="w">       </span><span class="c1">//channel parameter name</span>
<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="n">ChanParData</span><span class="p">,</span><span class="w">      </span><span class="c1">//channel parameter value</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">,</span><span class="w">   </span><span class="c1">//channel number</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ChanNum</span><span class="w"> </span><span class="p">);</span><span class="c1">//module number</span>
</pre></div>
</div>
<p><strong>Return values description and error handling</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>0 Success</dt><dd><ul>
<li><p>None</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-1 Invalid Pixie-16 module number</dt><dd><ul>
<li><p>Correct ModNum</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-2 Invalid Pixie-16 channel number</dt><dd><ul>
<li><p>Correct ChanNum</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-3 Invalid channel parameter name</dt><dd><ul>
<li><p>Correct ChanParName</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-4 Programing Fippi failed downloading channel parameter</dt><dd><ul>
<li><p>Reboot the module</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-5 Failed to find BLcut after downloading channel parameter</dt><dd><ul>
<li><p>Reboot the module</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-6 SetDACs failed downloading channel parameter</dt><dd><ul>
<li><p>Reboot the module</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p><strong>Usage example</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">retval</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">,</span><span class="w"> </span><span class="n">ChanNum</span><span class="p">;</span><span class="w"></span>
<span class="kt">double</span><span class="w"> </span><span class="n">ChanParData</span><span class="p">;</span><span class="w"></span>
<span class="c1">// Set energy filter rise time to 6.08 us for module 0 channel 0</span>
<span class="n">ModNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="c1">// this is the first module</span>
<span class="n">ChanNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="c1">// the first channel</span>
<span class="n">ChanParData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">6.08</span><span class="p">;</span><span class="w"> </span><span class="c1">// energy filter rise time = 6.08 us</span>

<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16WriteSglChanPar</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;ENERGY_RISETIME&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ChanParData</span><span class="p">,</span><span class="w"> </span><span class="n">ModNum</span><span class="p">,</span><span class="w"> </span><span class="n">ChanNum</span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// Error handling</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="pixie16writesglmodpar">
<h3>Pixie16WriteSglModPar<a class="headerlink" href="#pixie16writesglmodpar" title="永久链接至标题">¶</a></h3>
<p>Write a MODULE level parameter to a module</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Use this function to write a module parameter to a Pixie-16 module. ModNum is the module number which starts counting at 0.</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">Pixie16WriteSglModPar</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">ModParName</span><span class="p">,</span><span class="w">       </span><span class="c1">// module parameter name</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">ModParData</span><span class="p">,</span><span class="c1">// module parameter value</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="w"> </span><span class="p">);</span><span class="c1">// module number</span>
</pre></div>
</div>
<p><strong>Return values description and error handling</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>0 Success</dt><dd><ul>
<li><p>None</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-1 Invalid Pixie-16 module number</dt><dd><ul>
<li><p>Correct ModNum</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-2 Invalid module parameter name</dt><dd><ul>
<li><p>Correct ModParName</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-3 Failed to program Fippi after downloading module parameter</dt><dd><ul>
<li><p>Reboot the module</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>-4 Failed to find BLcut after downloading module parameter</dt><dd><ul>
<li><p>Reboot the module</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p><strong>Usage example</strong></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">retval</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModNum</span><span class="p">;</span><span class="w"></span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">ModParData</span><span class="p">;</span><span class="w"></span>
<span class="c1">// Set SlowFilterRange in module 0 to 4</span>
<span class="n">ModNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="c1">// this is the first module</span>
<span class="n">ModParData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span><span class="c1">// SlowFilterRange = 4</span>

<span class="n">retval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pixie16WriteSglModPar</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;SLOW_FILTER_RANGE&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ModParData</span><span class="p">,</span><span class="w"> </span><span class="n">ModNum</span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="n">retval</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="c1">// Error handling</span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
</section>
<section id="pku-api">
<h2>PKU API<a class="headerlink" href="#pku-api" title="永久链接至标题">¶</a></h2>
<p>Add by Hongyi Wu</p>
<section id="hongyiwupixie16computefastfiltersoffline">
<h3>HongyiWuPixie16ComputeFastFiltersOffline<a class="headerlink" href="#hongyiwupixie16computefastfiltersoffline" title="永久链接至标题">¶</a></h3>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="nf">HongyiWuPixie16ComputeFastFiltersOffline</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="kt">char</span><span class="w">           </span><span class="o">*</span><span class="n">FileName</span><span class="p">,</span><span class="w">          </span><span class="o">//</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="n">mode</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="p">(</span><span class="n">with</span><span class="w"> </span><span class="n">complete</span><span class="w"> </span><span class="n">path</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModuleNumber</span><span class="p">,</span><span class="w">       </span><span class="c1">// the module whose events are to be analyzed</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ChannelNumber</span><span class="p">,</span><span class="w">      </span><span class="c1">// the channel whose events are to be analyzed</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w">   </span><span class="n">FileLocation</span><span class="p">,</span><span class="w">       </span><span class="c1">// the location of the trace in the file</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">RcdTraceLength</span><span class="p">,</span><span class="w">     </span><span class="c1">// recorded trace length</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="o">*</span><span class="n">RcdTrace</span><span class="p">,</span><span class="w">          </span><span class="c1">// recorded trace</span>
<span class="w">      </span><span class="kt">double</span><span class="w">         </span><span class="o">*</span><span class="n">fastfilter</span><span class="p">,</span><span class="w">        </span><span class="c1">// fast filter response, the same scale as the trigger threshold</span>
<span class="w">      </span><span class="kt">double</span><span class="w">         </span><span class="o">*</span><span class="n">cfd</span><span class="p">,</span><span class="w">               </span><span class="c1">// cfd response, the same scale as the CFD threshold</span>
<span class="w">      </span><span class="kt">double</span><span class="w">         </span><span class="o">*</span><span class="n">cfds</span><span class="w"> </span><span class="p">);</span><span class="w">            </span><span class="c1">// cfd response, the same scale as the fast filter</span>
</pre></div>
</div>
</section>
<section id="hongyiwupixie16computeslowfiltersoffline">
<h3>HongyiWuPixie16ComputeSlowFiltersOffline<a class="headerlink" href="#hongyiwupixie16computeslowfiltersoffline" title="永久链接至标题">¶</a></h3>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="nf">HongyiWuPixie16ComputeSlowFiltersOffline</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="kt">char</span><span class="w">           </span><span class="o">*</span><span class="n">FileName</span><span class="p">,</span><span class="w">          </span><span class="o">//</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="n">mode</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="p">(</span><span class="n">with</span><span class="w"> </span><span class="n">complete</span><span class="w"> </span><span class="n">path</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModuleNumber</span><span class="p">,</span><span class="w">       </span><span class="c1">// the module whose events are to be analyzed</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ChannelNumber</span><span class="p">,</span><span class="w">      </span><span class="c1">// the channel whose events are to be analyzed</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w">   </span><span class="n">FileLocation</span><span class="p">,</span><span class="w">       </span><span class="c1">// the location of the trace in the file</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">RcdTraceLength</span><span class="p">,</span><span class="w">     </span><span class="c1">// recorded trace length</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="o">*</span><span class="n">RcdTrace</span><span class="p">,</span><span class="w">          </span><span class="c1">// recorded trace</span>
<span class="w">      </span><span class="kt">double</span><span class="w">         </span><span class="o">*</span><span class="n">slowfilter</span><span class="w"> </span><span class="p">);</span><span class="w">      </span><span class="c1">// slow filter response</span>
</pre></div>
</div>
</section>
<section id="hongyiwupixie16computeslowfiltersofflineaveragebaseline">
<h3>HongyiWuPixie16ComputeSlowFiltersOfflineAverageBaseline<a class="headerlink" href="#hongyiwupixie16computeslowfiltersofflineaveragebaseline" title="永久链接至标题">¶</a></h3>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w">  </span><span class="nf">HongyiWuPixie16ComputeSlowFiltersOfflineAverageBaseline</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="kt">char</span><span class="w">           </span><span class="o">*</span><span class="n">FileName</span><span class="p">,</span><span class="w">          </span><span class="o">//</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="n">mode</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="p">(</span><span class="n">with</span><span class="w"> </span><span class="n">complete</span><span class="w"> </span><span class="n">path</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModuleNumber</span><span class="p">,</span><span class="w">       </span><span class="c1">// the module whose events are to be analyzed</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ChannelNumber</span><span class="p">,</span><span class="w">      </span><span class="c1">// the channel whose events are to be analyzed</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w">   </span><span class="n">FileLocation</span><span class="p">,</span><span class="w">       </span><span class="c1">// the location of the trace in the file</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">RcdTraceLength</span><span class="p">,</span><span class="w">     </span><span class="c1">// recorded trace length</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="o">*</span><span class="n">RcdTrace</span><span class="p">,</span><span class="w">          </span><span class="c1">// recorded trace</span>
<span class="w">      </span><span class="kt">double</span><span class="w">         </span><span class="o">*</span><span class="n">slowfilter</span><span class="p">,</span><span class="w">        </span><span class="c1">// slow filter response</span>
<span class="w">      </span><span class="kt">int</span><span class="w">            </span><span class="n">pointtobl</span><span class="w"> </span><span class="p">);</span><span class="w">        </span><span class="c1">// Average number of estimated waveform baselines</span>
</pre></div>
</div>
</section>
<section id="hongyiwupixie16computeslowfiltersofflineextendbaseline">
<h3>HongyiWuPixie16ComputeSlowFiltersOfflineExtendBaseline<a class="headerlink" href="#hongyiwupixie16computeslowfiltersofflineextendbaseline" title="永久链接至标题">¶</a></h3>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="nf">HongyiWuPixie16ComputeSlowFiltersOfflineExtendBaseline</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="kt">char</span><span class="w">           </span><span class="o">*</span><span class="n">FileName</span><span class="p">,</span><span class="w">          </span><span class="o">//</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="n">mode</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="p">(</span><span class="n">with</span><span class="w"> </span><span class="n">complete</span><span class="w"> </span><span class="n">path</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ModuleNumber</span><span class="p">,</span><span class="w">       </span><span class="c1">// the module whose events are to be analyzed</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">ChannelNumber</span><span class="p">,</span><span class="w">      </span><span class="c1">// the channel whose events are to be analyzed</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w">   </span><span class="n">FileLocation</span><span class="p">,</span><span class="w">       </span><span class="c1">// the location of the trace in the file</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">RcdTraceLength</span><span class="p">,</span><span class="w">     </span><span class="c1">// recorded trace length</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="o">*</span><span class="n">RcdTrace</span><span class="p">,</span><span class="w">          </span><span class="c1">// recorded trace</span>
<span class="w">      </span><span class="kt">double</span><span class="w">         </span><span class="o">*</span><span class="n">slowfilter</span><span class="p">,</span><span class="w">        </span><span class="c1">// slow filter response</span>
<span class="w">      </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w">   </span><span class="n">bl</span><span class="p">,</span><span class="w">                 </span><span class="c1">// The baseline calculated in the firmware</span>
<span class="w">      </span><span class="kt">double</span><span class="w">         </span><span class="n">sl</span><span class="p">,</span><span class="w">                 </span><span class="c1">// SL used to calculate the baseline in the firmware</span>
<span class="w">      </span><span class="kt">double</span><span class="w">         </span><span class="n">sg</span><span class="p">,</span><span class="w">                 </span><span class="c1">// SG used to calculate the baseline in the firmware</span>
<span class="w">      </span><span class="kt">double</span><span class="w">         </span><span class="n">tau</span><span class="p">,</span><span class="w">                </span><span class="c1">// TAU used to calculate the baseline in the firmware</span>
<span class="w">      </span><span class="kt">int</span><span class="w">            </span><span class="n">sfr</span><span class="p">,</span><span class="w">                </span><span class="c1">// SlowFilterRange used to calculate the baseline in the firmware</span>
<span class="w">      </span><span class="kt">int</span><span class="w">            </span><span class="n">pointtobl</span><span class="w"> </span><span class="p">);</span><span class="w">        </span><span class="c1">// Average number of estimated waveform baselines</span>
</pre></div>
</div>
</section>
<section id="hongyiwupixie16setofflinevariant">
<h3>HongyiWuPixie16SetOfflineVariant<a class="headerlink" href="#hongyiwupixie16setofflinevariant" title="永久链接至标题">¶</a></h3>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="nf">HongyiWuPixie16SetOfflineVariant</span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">mod</span><span class="p">,</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">variant</span><span class="p">,</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">bits</span><span class="p">,</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="n">samplerate</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
</section>
</section>
</section>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="PKUCode.html" class="btn btn-neutral float-right" title="PKU Code" accesskey="n" rel="next">下一页 <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="README.html" class="btn btn-neutral float-left" title="Developer’s Guide" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> 上一页</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; 版权所有 2020, Hongyi Wu(吴鸿毅).

    </p>
  </div>
    
    
    
    利用 <a href="https://www.sphinx-doc.org/">Sphinx</a> 构建，使用了 
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">主题</a>
    
    由 <a href="https://readthedocs.org">Read the Docs</a>开发. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>